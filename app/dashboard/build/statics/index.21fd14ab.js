import{i as er,B as fs,a as bs,b as xs,j as Tr,d as ce,U as Ur,z as ys,r as Ss,f as ws,Q as Cs,e as ks,$ as vs,c as Yt,g as z,h as _s,C as zs,k as or,u as lr,l as te,m as t,H as b,n as e,T as p,o as Sn,p as W,s as Is,q as f,t as vt,J as Rs,v as _,w as Ar,A as qt,x as Ds,y as Es,M as xe,D as ye,E as Se,F as we,G as Ce,I as Me,K as rt,L as Zt,N as Ts,O as jt,P as ke,R as D,S as U,V as kr,W as de,X as ee,Y as Oe,Z as q,_ as pe,a0 as Ne,a1 as Q,a2 as Xe,a3 as Nt,a4 as Us,a5 as it,a6 as Pe,a7 as Pr,a8 as ir,a9 as wn,aa as zt,ab as at,ac as Tt,ad as Z,ae as ct,af as Yr,ag as As,ah as Cn,ai as kn,aj as vn,ak as Qe,al as Ps,am as Ls,an as Lr,ao as Fs,ap as Ms,aq as ar,ar as _n,as as zn,at as Fr,au as Ge,av as qr,aw as Ns,ax as Os,ay as Ws,az as vr,aA as $s,aB as js,aC as Bs,aD as Hs,aE as Vs,aF as Gs,aG as $e,aH as Ys,aI as In,aJ as qs,aK as Zs,aL as Mr,aM as bt,aN as Ut,aO as xt,aP as B,aQ as Nr,aR as Qs,aS as dt,aT as ht,aU as Dt,aV as ut,aW as Xs,aX as Ee,aY as Te,aZ as st,a_ as Ue,a$ as Ae,b0 as ot,b1 as Zr,b2 as Js,b3 as We,b4 as $t,b5 as Or,b6 as Ks,b7 as eo,b8 as Rn,b9 as Dn,ba as Qt,bb as pt,bc as ft,bd as En,be as to,bf as ro,bg as _r,bh as wt,bi as no,bj as Tn,bk as so,bl as kt,bm as gr,bn as Qr,bo as Un,bp as An,bq as Pn,br as It,bs as Ln,bt as Rt,bu as Fn,bv as oo,bw as zr,bx as lo,by as io,bz as Wr,bA as ao,bB as co,bC as Mn,bD as Nn,bE as On,bF as Ie,bG as ho,bH as At,bI as St,bJ as Wn,bK as uo,bL as $n,bM as jn,bN as Bn,bO as Hn,bP as Vn,bQ as Gn,bR as Yn,bS as qn,bT as po,bU as mo,bV as go,bW as fo,bX as Zn,bY as Qn,bZ as Bt,b_ as Ht,b$ as Ve,c0 as ue,c1 as Vt,c2 as ae,c3 as Xr,c4 as bo,c5 as xo,c6 as yo,c7 as Et,c8 as Xn,c9 as Jn,ca as Kn,cb as So,cc as wo,cd as Co,ce as ko,cf as vo,cg as _o,ch as zo,ci as Io,cj as Ro,ck as Do,cl as Eo,cm as To,cn as Uo,co as Ao,cp as Po,cq as Lo,cr as Fo,cs as Mo,ct as No}from"./vendor.47bd54f6.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerpolicy&&(i.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?i.credentials="include":l.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}})();er.use(fs).use(bs).use(xs).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:Tr(["/","statics/locales/{{lng}}.json"])}},function(r,s){ce.locale(er.language)});er.on("languageChanged",r=>{ce.locale(r)});Ur("zh-cn",ys);Ur("ru",Ss);Ur("fa",ws);const Ir=new Cs,es=r=>{const s=document.querySelector('meta[name="theme-color"]');s==null||s.setAttribute("content",r=="dark"?"#1A202C":"#3B81F6")},Oo=ks({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",primary:{50:"#9cb7f2",100:"#88a9ef",200:"#749aec",300:"#618ce9",400:"#4d7de7",500:"#396fe4",600:"#3364cd",700:"#2e59b6",800:"#284ea0",900:"#224389"},gray:{750:"#222C3B"}},components:{Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}}}});const tr=()=>localStorage.getItem("token"),Wo=r=>{localStorage.setItem("token",r)},$o=()=>{localStorage.removeItem("token")},jo=vs.create({baseURL:"/api/"}),Bo=(r,s={})=>(tr()&&(s.headers={...(s==null?void 0:s.headers)||{},Authorization:`Bearer ${tr()}`}),jo(r,s)),V=Bo,Ho=Yt(r=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:"",fetchCoreSettings:()=>{r({isLoading:!0}),Promise.all([V("/core").then(({version:s,started:n,logs_websocket:o})=>r({version:s,started:n,logs_websocket:o})),V("/core/config").then(s=>r({config:s}))]).finally(()=>r({isLoading:!1}))},updateConfig:s=>(r({isPostLoading:!0}),V("/core/config",{method:"PUT",body:s}).finally(()=>{r({isPostLoading:!1})})),restartCore:()=>V("/core/restart",{method:"POST"})}));function Fe(r,s=2,n=!1){if(!+r)return"0 B";const o=1024,l=s<0?0:s,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(r)/Math.log(o));return n?[parseFloat((r/Math.pow(o,a)).toFixed(l)),i[a]]:`${parseFloat((r/Math.pow(o,a)).toFixed(l))} ${i[a]}`}const Jr=r=>{if(r!==null)return r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Vo=z(_s,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Go=z(zs,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Yo=z(or,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),fr=({title:r,content:s,icon:n})=>t(Sn,{p:6,borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{borderColor:"gray.600",bg:"gray.750"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[t(b,{alignItems:"center",columnGap:"4",children:[e(W,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:n}),e(p,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:r})]}),e(W,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:s})]}),Rr="statistics-query-key",qo=r=>{const{version:s}=$(),{data:n}=lr({queryKey:Rr,queryFn:()=>V("/system"),refetchInterval:5e3,onSuccess:({version:l})=>{s!==l&&$.setState({version:l})}}),{t:o}=te();return t(b,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...r,children:[e(fr,{title:o("activeUsers"),content:n&&t(b,{alignItems:"flex-end",children:[e(p,{children:Jr(n.users_active)}),t(p,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",Jr(n.total_user)]})]}),icon:e(Vo,{})}),e(fr,{title:o("dataUsage"),content:n&&Fe(n.incoming_bandwidth+n.outgoing_bandwidth),icon:e(Go,{})}),e(fr,{title:o("memoryUsage"),content:n&&t(b,{alignItems:"flex-end",children:[e(p,{children:Fe(n.mem_used,1,!0)[0]}),t(p,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:[Fe(n.mem_used,1,!0)[1]," /"," ",Fe(n.mem_total,1)]})]}),icon:e(Yo,{})})]})},ts="marzban-num-users-per-page",Kr=10,Zo=()=>{const r=localStorage.getItem(ts)||Kr.toString();return parseInt(r)||Kr},Qo=r=>localStorage.setItem(ts,r),Xo=r=>{for(const s in r)r[s]||delete r[s];return $.setState({loading:!0}),V("/users",{query:r}).then(s=>($.setState({users:s}),s)).finally(()=>{$.setState({loading:!1})})},Jo=()=>V("/inbounds").then(r=>{$.setState({inbounds:new Map(Object.entries(r))})}).finally(()=>{$.setState({loading:!1})}),$=Yt(Is((r,s)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0},loading:!0,isResetingAllUsage:!1,isEditingHosts:!1,isEditingNodes:!1,isEditingSubscription:!1,isShowingNodesUsage:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:Zo(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:()=>{Xo(s().filters)},resetAllUsage:async()=>{await V("/nodes/reset",{method:"POST"}),s().onResetAllUsage(!1),s().refetchUsers()},onResetAllUsage:n=>r({isResetingAllUsage:n}),onCreateUser:n=>r({isCreatingNewUser:n}),onEditingUser:n=>{r({editingUser:n})},onDeletingUser:n=>{r({deletingUser:n})},onFilterChange:n=>{r({filters:{...s().filters,...n}}),s().refetchUsers()},setQRCode:n=>{r({QRcodeLinks:n})},deleteUser:n=>(r({editingUser:null}),V(`/user/${n.username}`,{method:"DELETE"}).then(()=>{r({deletingUser:null}),s().refetchUsers(),Ir.invalidateQueries(Rr)})),createUser:n=>V("/user",{method:"POST",body:n}).then(()=>{r({editingUser:null}),s().refetchUsers(),Ir.invalidateQueries(Rr)}),editUser:n=>V(`/user/${n.username}`,{method:"PUT",body:n}).then(()=>{s().onEditingUser(null),s().refetchUsers()}),fetchUserUsage:(n,o)=>{for(const l in o)o[l]||delete o[l];return V(`/user/${n.username}/usage`,{method:"GET",query:o})},fetchUserUsageTop10(n){return V("/user/usage/top10",{query:n})},onEditingHosts:n=>{r({isEditingHosts:n})},onEditingNodes:n=>{r({isEditingNodes:n})},onEditingSubscription:n=>{r({isEditingSubscription:n})},onShowingNodesUsage:n=>{r({isShowingNodesUsage:n})},setSubLink:n=>{r({subscribeUrl:n})},resetDataUsage:n=>V(`/user/${n.username}/reset`,{method:"POST"}).then(()=>{r({resetUsageUser:null}),s().refetchUsers()}),revokeSubscription:n=>V(`/user/${n.username}/revoke_sub`,{method:"POST"}).then(o=>{r({revokeSubscriptionUser:null,editingUser:o}),s().refetchUsers()})}))),ve=({children:r,color:s})=>e(W,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${s}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${s}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${s}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${s}.400`}},children:e(p,{color:`${s}.500`,_dark:{color:`${s}.900`},position:"relative",zIndex:"2",children:r})});window.ace.define("ace/theme/nord_dark",["require","exports","module","ace/lib/dom"],(r,s,n)=>{s.isDark=!0,s.cssClass="ace-nord-dark",r("../lib/dom").importCssString(s.cssText,s.cssClass)});window.ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],(r,s,n)=>{s.isDark=!1,s.cssClass="ace-dawn",r("../lib/dom").importCssString(s.cssText,s.cssClass)});const Ko=f.exports.forwardRef(({json:r,onChange:s,mode:n="code"},o)=>{const{colorMode:l}=vt(),i={mode:n,onChangeText:s,statusBar:!1,mainMenuBar:!1,theme:l==="dark"?"ace/theme/nord_dark":"ace/theme/dawn"},a=f.exports.useRef(null),x=f.exports.useRef(null);return f.exports.useEffect(()=>(x.current=new Rs(a.current,i),()=>{x.current&&x.current.destroy()}),[]),f.exports.useEffect(()=>{x.current&&x.current.update(r)},[r]),e(W,{ref:o,border:"1px solid",borderColor:"gray.300",_dark:{borderColor:"gray.500"},borderRadius:5,h:"full",children:e(W,{height:"full",ref:a})})}),rs=_.object({name:_.string().min(1),address:_.string().min(1),port:_.number().min(1).or(_.string().transform(r=>parseFloat(r))),api_port:_.number().min(1).or(_.string().transform(r=>parseFloat(r))),xray_version:_.string().nullable().optional(),id:_.number().nullable().optional(),status:_.enum(["connected","connecting","error","disabled"]).nullable().optional(),message:_.string().nullable().optional(),add_as_new_host:_.boolean().optional(),usage_coefficient:_.number().or(_.string().transform(r=>parseFloat(r)))}),el=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",usage_coefficient:1}),Gt="fetch-nodes-query-key",ns=()=>{const{isEditingNodes:r}=$();return lr({queryKey:Gt,queryFn:Xt.getState().fetchNodes,refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1})},Xt=Yt((r,s)=>({nodes:[],addNode(n){return V("/node",{method:"POST",body:n})},fetchNodes(){return V("/nodes")},fetchNodesUsage(n){return V("/nodes/usage",{query:n})},updateNode(n){return V(`/node/${n.id}`,{method:"PUT",body:n})},setDeletingNode(n){r({deletingNode:n})},reconnectNode(n){return V(`/node/${n.id}/reconnect`,{method:"POST"})},deleteNode:()=>{var n;return V(`/node/${(n=s().deletingNode)==null?void 0:n.id}`,{method:"DELETE"})}})),en=500,tl=z(Ar,{baseStyle:{w:5,h:5}}),rl=z(qt,{baseStyle:{w:4,h:4}}),nl=z(Ds,{baseStyle:{w:4,h:4}}),sl=z(Es,{baseStyle:{w:3,h:3}}),ol=r=>({[Nt.ReadyState.CONNECTING]:"connecting",[Nt.ReadyState.OPEN]:"connected",[Nt.ReadyState.CLOSING]:"closed",[Nt.ReadyState.CLOSED]:"closed",[Nt.ReadyState.UNINSTANTIATED]:"closed"})[r],ll=r=>{try{let s=new URL("/api/".startsWith("/")?window.location.origin+"/api/":"/api/");return(s.protocol==="https:"?"wss://":"ws://")+Tr([s.host+s.pathname,r?`/node/${r}/logs`:"/core/logs"])+"?interval=1&token="+tr()}catch(s){return console.error("Unable to generate websocket url"),console.error(s),null}};let yt=[];const il=()=>{const{colorMode:r}=vt(),{data:s}=ns(),n=!1,[o,l]=f.exports.useState(""),i=(O,G)=>{O!==o&&(O==="host"?(l(""),h([])):(l(O),h([])))},{isEditingCore:a}=$(),{fetchCoreSettings:x,updateConfig:y,isLoading:I,config:S,isPostLoading:C,version:d,restartCore:g}=Ho(),E=f.exports.useRef(null),[P,h]=f.exports.useState([]),{t:c}=te(),u=Me(),w=rt({defaultValues:{config:S||{}}});f.exports.useEffect(()=>{S&&w.setValue("config",S)},[S]),f.exports.useEffect(()=>{a&&x()},[a]);const F=f.exports.useRef(!0),L=f.exports.useCallback(Zt(O=>{var oe,he,K;const G=Math.abs((((oe=E.current)==null?void 0:oe.scrollTop)||0)-(((he=E.current)==null?void 0:he.scrollHeight)||0)+(((K=E.current)==null?void 0:K.offsetHeight)||0))<10;E.current&&G?F.current=!0:F.current=!1,O.length<40&&h(O)},300),[]),{readyState:k}=Ts(ll(o),{onMessage:O=>{yt.push(O.data),yt.length>en&&(yt=yt.splice(0,yt.length-en)),L([...yt])},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});f.exports.useEffect(()=>{var O;E.current&&F.current&&(E.current.scrollTop=(O=E.current)==null?void 0:O.scrollHeight)},[P]),f.exports.useEffect(()=>()=>{yt=[]},[]);const m=ol(k.toString()),{mutate:v,isLoading:N}=jt(g),ie=({config:O})=>{y(O).then(()=>{u({title:c("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(G=>{let oe=c("core.generalErrorMessage");typeof G.response._data.detail=="object"&&(oe=G.response._data.detail[Object.keys(G.response._data.detail)[0]]),typeof G.response._data.detail=="string"&&(oe=G.response._data.detail),u({title:oe,status:"error",isClosable:!0,position:"top",duration:3e3})})},J=f.exports.useRef(null),[R,X]=f.exports.useState(!1),j=()=>{var O;document.fullscreenElement?(document.exitFullscreen(),X(!1)):((O=J.current)==null||O.requestFullscreen(),X(!0))};return t("form",{onSubmit:w.handleSubmit(ie),children:[t(ke,{children:[t(D,{children:[t(b,{justifyContent:"space-between",alignItems:"flex-start",children:[t(U,{children:[c("core.configuration")," ",I&&e(kr,{isIndeterminate:!0,size:"15px"})]}),e(b,{gap:0,children:e(de,{label:"Xray Version",placement:"top",children:e(ee,{height:"100%",textTransform:"lowercase",children:d&&`v${d}`})})})]}),t(W,{position:"relative",ref:J,minHeight:"300px",children:[e(Oe,{control:w.control,name:"config",render:({field:O})=>e(Ko,{json:S,onChange:O.onChange})}),e(q,{size:"xs","aria-label":"full screen",variant:"ghost",position:"absolute",top:"2",right:"4",onClick:j,children:R?e(sl,{}):e(nl,{})})]})]}),t(D,{mt:"4",children:[t(b,{justifyContent:"space-between",style:{paddingBottom:"1rem"},children:[t(b,{children:[(s==null?void 0:s[0])&&t(pe,{size:"sm",style:{width:"auto"},disabled:n,bg:"transparent",_dark:{bg:"transparent"},sx:{option:{backgroundColor:r==="dark"?"#222C3B":"white"}},onChange:O=>i(O.currentTarget.value,O.currentTarget.selectedOptions[0].text),children:[e("option",{value:"host",defaultChecked:!0,children:"Master"},"host"),s&&s.map(O=>e("option",{value:String(O.id),children:c(O.name)},O.address))]}),e(U,{className:"w-au",children:c("core.logs")})]}),e(p,{as:U,children:c(`core.socket.${m}`)})]}),e(W,{border:"1px solid",borderColor:"gray.300",bg:"#F9F9F9",_dark:{borderColor:"gray.500",bg:"#2e3440"},borderRadius:5,minHeight:"200px",maxHeight:"250px",p:2,overflowY:"auto",ref:E,children:P.map((O,G)=>e(p,{fontSize:"xs",opacity:.8,whiteSpace:"pre-line",children:O},G))})]})]}),e(Ne,{children:t(b,{w:"full",justifyContent:"space-between",children:[e(b,{children:e(W,{children:e(Q,{size:"sm",leftIcon:e(rl,{className:Xe({"animate-spin":N})}),onClick:()=>v(),children:c(N?"core.restarting":"core.restartCore")})})}),e(b,{children:e(Q,{size:"sm",variant:"solid",colorScheme:"primary",px:"5",type:"submit",isDisabled:I||C,isLoading:C,children:c("core.save")})})]})})]})},al=()=>{const{isEditingCore:r}=$(),s=$.setState.bind(null,{isEditingCore:!1}),{t:n}=te();return t(xe,{isOpen:r,onClose:s,size:"3xl",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",w:"full",children:[e(we,{pt:6,children:t(b,{gap:2,children:[e(ve,{color:"primary",children:e(tl,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:n("core.title")})]})}),e(Ce,{mt:3}),e(il,{})]})]})},mt=z(Us,{baseStyle:{w:5,h:5}}),cl=()=>{const[r,s]=f.exports.useState(!1),{deletingUser:n,onDeletingUser:o,deleteUser:l}=$(),{t:i}=te(),a=Me(),x=()=>{o(null)},y=()=>{n&&(s(!0),l(n).then(()=>{a({title:i("deleteUser.deleteSuccess",{username:n.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(x).finally(s.bind(null,!1)))};return t(xe,{isCentered:!0,isOpen:!!n,onClose:x,size:"sm",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",children:[e(we,{pt:6,children:e(ve,{color:"red",children:e(mt,{})})}),e(Ce,{mt:3}),t(ke,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:i("deleteUser.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(it,{components:{b:e("b",{})},children:i("deleteUser.prompt",{username:n.username})})})]}),t(Ne,{display:"flex",children:[e(Q,{size:"sm",onClick:x,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(Q,{size:"sm",w:"full",colorScheme:"red",onClick:y,leftIcon:r?e(Pe,{size:"xs"}):void 0,children:i("delete")})]})]})]})},$r={baseStyle:{w:4,h:4}},dl=z(Pr,$r),hl=z(ir,$r),jr=z(qt,$r),ul=Zt(r=>{$.getState().onFilterChange({...$.getState().filters,offset:0,search:r})},300),pl=({...r})=>{const{loading:s,filters:n,onFilterChange:o,refetchUsers:l,onCreateUser:i}=$(),{t:a}=te(),[x,y]=f.exports.useState(""),I=C=>{y(C.target.value),ul(C.target.value)},S=()=>{y(""),o({...n,offset:0,search:""})};return t(wn,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},position:"sticky",top:0,mx:"-6",px:"6",rowGap:4,gap:{lg:4,base:0},bg:"var(--chakra-colors-chakra-body-bg)",py:4,zIndex:"docked",...r,children:[e(zt,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:t(at,{children:[e(Tt,{pointerEvents:"none",children:e(dl,{})}),e(Z,{placeholder:a("search"),value:x,borderColor:"light-border",onChange:I}),t(ct,{children:[s&&e(Pe,{size:"xs"}),n.search&&n.search.length>0&&e(q,{onClick:S,"aria-label":"clear",size:"xs",variant:"ghost",children:e(hl,{})})]})]})}),e(zt,{colSpan:2,order:{base:1,md:2},children:t(b,{justifyContent:"flex-end",alignItems:"center",h:"full",children:[e(q,{"aria-label":"refresh users",disabled:s,onClick:l,size:"sm",variant:"outline",children:e(jr,{className:Xe({"animate-spin":s})})}),e(Q,{colorScheme:"primary",size:"sm",onClick:()=>i(!0),px:5,children:a("createUser")})]})})]})},ss="https://github.com/Gozargah/Marzban",ml="https://github.com/Gozargah",gl="https://github.com/Gozargah/Marzban#donation",os=r=>{const{version:s}=$();return e(b,{w:"full",py:"0",position:"relative",...r,children:t(p,{display:"inline-block",flexGrow:1,textAlign:"center",color:"gray.500",fontSize:"xs",children:[e(Yr,{color:"blue.400",href:ss,children:"Marzban"}),s?` (v${s}), `:", ","Made with \u2764\uFE0F in"," ",e(Yr,{color:"blue.400",href:ml,children:"Gozargah"})]})})},fl=z(As,{baseStyle:{w:4,h:4}}),ls=({actions:r})=>{const{i18n:s}=te();var n=o=>{s.changeLanguage(o)};return t(Cn,{placement:"bottom-end",children:[e(kn,{as:q,size:"sm",variant:"outline",icon:e(fl,{}),position:"relative"}),t(vn,{minW:"100px",className:"menuList",zIndex:99999,children:[e(Qe,{maxW:"100px",fontSize:"sm",onClick:()=>n("en"),children:"English"}),e(Qe,{maxW:"100px",fontSize:"sm",onClick:()=>n("fa"),children:"\u0641\u0627\u0631\u0633\u06CC"}),e(Qe,{maxW:"100px",fontSize:"sm",onClick:()=>n("zh-cn"),children:"\u7B80\u4F53\u4E2D\u6587"}),e(Qe,{maxW:"100px",fontSize:"sm",onClick:()=>n("ru"),children:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439"})]})]})},bl=async()=>await V("/admin"),xl=()=>{const{data:r,isError:s,isLoading:n,isSuccess:o,error:l}=lr({queryFn:()=>bl()});return{userData:r||{discord_webook:"",is_sudo:!1,telegram_id:"",username:""},getUserIsPending:n,getUserIsSuccess:o,getUserIsError:s,getUserError:l}},Je={baseStyle:{w:4,h:4}},yl=z(Ps,Je),Sl=z(Ls,Je),wl=z(Ar,Je),Cl=z(Lr,Je),kl=z(Fs,Je),vl=z(Ms,Je),_l=z(ar,Je),zl=z(_n,Je),Il=z(or,Je),Rl=z(zn,Je),Dl=z(Fr,Je),tn=z(W,{baseStyle:{bg:"yellow.500",w:"2",h:"2",rounded:"full",position:"absolute"}}),is="marzban-menu-notification",El=()=>{const r=localStorage.getItem(is);if(!r)return!0;try{return r&&Os(parseInt(r))?Ws(new Date,new Date(parseInt(r)))>=7:!0}catch{return!0}},Tl=({actions:r})=>{const{userData:s,getUserIsSuccess:n,getUserIsPending:o}=xl(),l=()=>!o&&n?s.is_sudo:!1,{onEditingHosts:i,onResetAllUsage:a,onEditingNodes:x,onShowingNodesUsage:y,onEditingSubscription:I}=$(),{t:S}=te(),{colorMode:C,toggleColorMode:d}=vt(),[g,E]=f.exports.useState(El()),P=C==="dark"?"dark_dimmed":C,h=()=>{localStorage.setItem(is,new Date().getTime().toString()),E(!1)};return t(b,{gap:2,justifyContent:"space-between",__css:{"& .menuList":{direction:"ltr"}},position:"relative",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:S("users")}),g&&e(tn,{top:"0",right:"0",zIndex:9999}),e(W,{overflow:"auto",css:{direction:"rtl"},children:t(b,{alignItems:"center",children:[t(Cn,{children:[e(kn,{as:q,size:"sm",variant:"outline",icon:e(Ge,{children:e(Cl,{})}),position:"relative"}),t(vn,{minW:"170px",zIndex:99999,className:"menuList",children:[l()&&t(Ge,{children:[e(Qe,{maxW:"170px",fontSize:"sm",icon:e(_l,{}),onClick:i.bind(null,!0),children:S("header.hostSettings")}),e(Qe,{maxW:"170px",fontSize:"sm",icon:e(zl,{}),onClick:x.bind(null,!0),children:S("header.nodeSettings")}),e(Qe,{maxW:"210px",fontSize:"sm",icon:e(Dl,{}),onClick:I.bind(null,!0),children:S("header.subscriptionSetting")}),e(Qe,{maxW:"210px",fontSize:"sm",icon:e(Il,{}),onClick:y.bind(null,!0),children:S("header.nodesUsage")}),e(Qe,{maxW:"170px",fontSize:"sm",icon:e(Rl,{}),onClick:a.bind(null,!0),children:S("resetAllUsage")})]}),e(qr,{to:gl,target:"_blank",children:t(Qe,{maxW:"170px",fontSize:"sm",icon:e(vl,{}),position:"relative",onClick:h,children:[S("header.donation")," ",g&&e(tn,{top:"3",right:"2"})]})}),e(qr,{to:"/login",children:e(Qe,{maxW:"170px",fontSize:"sm",icon:e(kl,{}),children:S("header.logout")})})]})]}),l()&&e(q,{size:"sm",variant:"outline","aria-label":"core settings",onClick:()=>{$.setState({isEditingCore:!0})},children:e(wl,{})}),e(ls,{}),e(q,{size:"sm",variant:"outline","aria-label":"switch theme",onClick:()=>{es(C=="dark"?"light":"dark"),d()},children:C==="light"?e(yl,{}):e(Sl,{})}),e(W,{css:{direction:"ltr"},display:"flex",alignItems:"center",pr:"2",__css:{"&  span":{display:"inline-flex"}},children:e(Ns,{href:ss,"data-color-scheme":`no-preference: ${P}; light: ${P}; dark: ${P};`,"data-size":"large","data-show-count":"true","aria-label":"Star Marzban on GitHub",children:"Star"})})]})})]})},Ul=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],as=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],cs=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(r=>({title:r,value:r}))],Al=[{title:"none",value:""},{title:"xtls-rprx-vision",value:"xtls-rprx-vision"}],Pl=["aes-128-gcm","aes-256-gcm","chacha20-ietf-poly1305"],Ll=Yt(r=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{r({isLoading:!0}),V("/hosts").then(s=>r({hosts:s})).finally(()=>r({isLoading:!1}))},setHosts:s=>(r({isPostLoading:!0}),V("/hosts",{method:"PUT",body:s}).finally(()=>{r({isPostLoading:!1})}))}));const Fl=z(ir,{baseStyle:{w:4,h:4}}),tt=vr.forwardRef(({disabled:r,step:s,label:n,className:o,startAdornment:l,endAdornment:i,type:a="text",placeholder:x,onChange:y,onBlur:I,name:S,value:C,onClick:d,error:g,clearable:E=!1,...P},h)=>{const c=()=>{y&&y({target:{value:"",name:S}})},{size:u="md"}=P,w=a=="number"?Ys:Z,F=a=="number"?$s:vr.Fragment,L=a=="number"?{keepWithinRange:!0,precision:5,format:k=>isNaN(parseFloat(String(k)))||Number(parseFloat(String(k)).toFixed(5))===0?k:Number(parseFloat(String(k)).toFixed(5)),min:0,step:s,name:S,type:a,placeholder:x,onChange:k=>{y&&y(k)},onBlur:I,value:C,onClick:d,disabled:r,flexGrow:1,size:u}:{};return t(D,{isInvalid:!!g,children:[n&&e(U,{children:n}),t(at,{size:u,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:r?"gray.100":"transparent",_dark:{bg:r?"gray.600":"transparent"},children:[l&&e(js,{children:l}),t(F,{...L,children:[e(w,{name:S,ref:h,step:s,className:Xe(o),type:a,placeholder:x,onChange:y,onBlur:I,value:C,onClick:d,disabled:r,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...P,roundedLeft:l?"0":"md",roundedRight:i?"0":"md"}),a=="number"&&e(Ge,{children:t(Bs,{children:[e(Hs,{}),e(Vs,{})]})})]}),i&&e(Gs,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),E&&C&&C.length&&e(ct,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:c,cursor:"pointer",children:e(Fl,{})})]}),!!g&&e($e,{children:g})]})}),Ml=z(In,{baseStyle:{w:5,h:5}}),Nl=z(qs,{baseStyle:{w:5,h:5}}),Ol=z(Zs,{baseStyle:{w:5,h:5}}),br=z(pe,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),gt=z(tt,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),Wl=z(ar,{baseStyle:{w:5,h:5}}),lt=z(Mr,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),$l=_.record(_.string().min(1),_.array(_.object({remark:_.string().min(1,"Remark is required"),address:_.string().min(1,"Address is required"),port:_.string().or(_.number()).nullable().transform(r=>typeof r=="number"?r:r!==null&&!isNaN(parseInt(r))?Number(parseInt(r)):null),path:_.string().nullable(),sni:_.string().nullable(),host:_.string().nullable(),mux_enable:_.boolean().default(!1),allowinsecure:_.boolean().nullable().default(!1),is_disabled:_.boolean().default(!0),fragment_setting:_.string().nullable(),noise_setting:_.string().nullable(),random_user_agent:_.boolean().default(!1),security:_.string(),alpn:_.string(),fingerprint:_.string()}))),et=z($e,{baseStyle:{color:"red.400",display:"block",textAlign:"left",w:"100%"}}),jl=({hostKey:r,isOpen:s,toggleAccordion:n})=>{const{inbounds:o}=$(),l=[...o.values()].flat().filter(c=>c.tag===r)[0],i=Nr(),{fields:a,append:x,remove:y,insert:I,move:S}=Qs({control:i.control,name:r}),{errors:C}=i.formState,{t:d}=te(),g=C[r],E=()=>{x({host:"",sni:"",port:null,path:null,address:"",remark:"",mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:""})},P=c=>{if(c<0||c>=a.length)return;const u=a[c];I(c+1,u)};f.exports.useEffect(()=>{g&&!s&&n()},[g]);const h=(c,u)=>{u==="up"&&c>0?S(c,c-1):u==="down"&&c<a.length-1&&S(c,c+1)};return t(dt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[t(ht,{px:2,borderRadius:"3px",onClick:n,children:[e(p,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:r}),e(Dt,{})]}),e(ut,{px:2,pb:2,children:t(B,{gap:3,children:[a.map((c,u)=>{var w,F,L,k,m,v,N,ie,J,R,X,j,O,G,oe,he,K,_e,M,T,re,H,le,Y,ne,ze,Be,Ye,qe,Ze,De,ge,A,se,Le,He,Ke,nt,me,Lt,Ft;return e(Xs.div,{layout:!0,initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{layout:{type:"spring",stiffness:500,damping:30},opacity:{duration:.1}},id:c.id,whileDrag:{scale:1.05,zIndex:10},style:{width:"100%"},children:t(B,{id:c.id,border:"1px solid",_dark:{borderColor:"gray.600",bg:"#273142"},_light:{borderColor:"gray.200",bg:"#fcfbfb"},p:2,w:"full",borderRadius:"4px",children:[e(b,{w:"100%",alignItems:"flex-start",children:t(D,{position:"relative",zIndex:10,isInvalid:!!(g&&((w=g[u])==null?void 0:w.remark)),children:[t(at,{children:[e(gt,{...i.register(r+"."+u+".remark"),size:"sm",borderRadius:"4px",placeholder:"Remark"}),e(ct,{children:t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(W,{mt:"-8px",children:e(lt,{})})}),e(st,{children:t(Ue,{children:[e(Ae,{}),e(ot,{}),e(Zr,{children:t(W,{fontSize:"xs",children:[e(p,{pr:"20px",children:d("hostsDialog.desc")}),t(p,{children:[t(ee,{children:["{","SERVER_IP","}"]})," ",d("hostsDialog.currentServer")]}),t(p,{mt:1,children:[t(ee,{children:["{","SERVER_IPV6","}"]})," ",d("hostsDialog.currentServerv6")]}),t(p,{mt:1,children:[t(ee,{children:["{","USERNAME","}"]})," ",d("hostsDialog.username")]}),t(p,{mt:1,children:[t(ee,{children:["{","DATA_USAGE","}"]})," ",d("hostsDialog.dataUsage")]}),t(p,{mt:1,children:[t(ee,{children:["{","DATA_LEFT","}"]})," ",d("hostsDialog.remainingData")]}),t(p,{mt:1,children:[t(ee,{children:["{","DATA_LIMIT","}"]})," ",d("hostsDialog.dataLimit")]}),t(p,{mt:1,children:[t(ee,{children:["{","DAYS_LEFT","}"]})," ",d("hostsDialog.remainingDays")]}),t(p,{mt:1,children:[t(ee,{children:["{","EXPIRE_DATE","}"]})," ",d("hostsDialog.expireDate")]}),t(p,{mt:1,children:[t(ee,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",d("hostsDialog.jalaliExpireDate")]}),t(p,{mt:1,children:[t(ee,{children:["{","TIME_LEFT","}"]})," ",d("hostsDialog.remainingTime")]}),t(p,{mt:1,children:[t(ee,{children:["{","STATUS_TEXT","}"]})," ",d("hostsDialog.statusText")]}),t(p,{mt:1,children:[t(ee,{children:["{","STATUS_EMOJI","}"]})," ",d("hostsDialog.statusEmoji")]}),t(p,{mt:1,children:[t(ee,{children:["{","PROTOCOL","}"]})," ",d("hostsDialog.proxyProtocol")]}),t(p,{mt:1,children:[t(ee,{children:["{","TRANSPORT","}"]})," ",d("hostsDialog.proxyMethod")]})]})})]})})]})})]}),g&&((F=g[u])==null?void 0:F.remark)&&e(et,{children:(k=(L=g[u])==null?void 0:L.remark)==null?void 0:k.message})]})}),t(D,{isInvalid:!!(g&&((m=g[u])==null?void 0:m.address)),children:[t(at,{children:[e(gt,{size:"sm",borderRadius:"4px",placeholder:"Address (e.g. example.com)",...i.register(r+"."+u+".address")}),e(ct,{children:t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(W,{mt:"-8px",children:e(lt,{})})}),e(st,{children:t(Ue,{children:[e(Ae,{}),e(ot,{}),e(Zr,{children:t(W,{fontSize:"xs",children:[e(p,{pr:"20px",children:d("hostsDialog.desc")}),t(p,{children:[t(ee,{children:["{","SERVER_IP","}"]})," ",d("hostsDialog.currentServer")]}),t(p,{mt:1,children:[t(ee,{children:["{","SERVER_IPV6","}"]})," ",d("hostsDialog.currentServerv6")]}),t(p,{mt:1,children:[t(ee,{children:["{","USERNAME","}"]})," ",d("hostsDialog.username")]}),t(p,{mt:1,children:[t(ee,{children:["{","DATA_USAGE","}"]})," ",d("hostsDialog.dataUsage")]}),t(p,{mt:1,children:[t(ee,{children:["{","DATA_LEFT","}"]})," ",d("hostsDialog.remainingData")]}),t(p,{mt:1,children:[t(ee,{children:["{","DATA_LIMIT","}"]})," ",d("hostsDialog.dataLimit")]}),t(p,{mt:1,children:[t(ee,{children:["{","DAYS_LEFT","}"]})," ",d("hostsDialog.remainingDays")]}),t(p,{mt:1,children:[t(ee,{children:["{","EXPIRE_DATE","}"]})," ",d("hostsDialog.expireDate")]}),t(p,{mt:1,children:[t(ee,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",d("hostsDialog.jalaliExpireDate")]}),t(p,{mt:1,children:[t(ee,{children:["{","TIME_LEFT","}"]})," ",d("hostsDialog.remainingTime")]}),t(p,{mt:1,children:[t(ee,{children:["{","STATUS_TEXT","}"]})," ",d("hostsDialog.statusText")]}),t(p,{mt:1,children:[t(ee,{children:["{","STATUS_EMOJI","}"]})," ",d("hostsDialog.statusEmoji")]}),t(p,{mt:1,children:[t(ee,{children:["{","PROTOCOL","}"]})," ",d("hostsDialog.proxyProtocol")]}),t(p,{mt:1,children:[t(ee,{children:["{","TRANSPORT","}"]})," ",d("hostsDialog.proxyMethod")]})]})})]})})]})})]}),g&&((v=g[u])==null?void 0:v.address)&&e(et,{children:(ie=(N=g[u])==null?void 0:N.address)==null?void 0:ie.message})]}),e(xt,{w:"full",allowToggle:!0,children:t(dt,{border:"0",children:[t("div",{style:{display:"flex",alignItems:"center"},children:[t(ht,{display:"flex",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:[t(p,{flex:"3",align:"start",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[d("hostsDialog.advancedOptions"),e(Dt,{fontSize:"sm",ml:1})]}),t(Js,{flex:"1",px:"0",display:"contents",children:[e(Oe,{control:i.control,name:`${r}.${u}.is_disabled`,render:({field:be})=>e(We,{mx:"1.5",colorScheme:"primary",...be,value:void 0,isChecked:!be.value,onChange:Mt=>{console.log(Mt.target.checked),be.onChange(!Mt.target.checked)}})}),e(de,{label:"Delete",placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",colorScheme:"red",variant:"ghost",onClick:y.bind(null,u),children:e(mt,{})})})]})]}),e(de,{label:"Duplicate",placement:"top",children:e(q,{"aria-label":"Duplicate",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>P(u),children:e(Ml,{})})}),u<a.length-1&&e(de,{label:"Move Down",placement:"top",children:e(q,{"aria-label":"DownIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>h(u,"down"),children:e(Ol,{})})}),u>0&&e(de,{label:"Move Up",placement:"top",children:e(q,{"aria-label":"UpIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>h(u,"up"),children:e(Nl,{})})})]}),e(ut,{w:"full",p:1,children:t(B,{w:"full",borderRadius:"4px",children:[t(D,{isInvalid:!!(g&&((J=g[u])==null?void 0:J.port)),children:[t(U,{display:"flex",pb:1,alignItems:"center",justifyContent:"space-between",gap:1,m:"0",children:[e("span",{children:d("hostsDialog.port")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(lt,{})}),e(st,{children:t(Ue,{p:2,children:[e(Ae,{}),e(ot,{}),e(p,{fontSize:"xs",pr:5,children:d("hostsDialog.port.info")})]})})]})]}),e(gt,{size:"sm",borderRadius:"4px",placeholder:String(l.port||"8080"),type:"number",...i.register(r+"."+u+".port")})]}),t(D,{isInvalid:!!(g&&((R=g[u])==null?void 0:R.sni)),children:[t(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:d("hostsDialog.sni")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(lt,{})}),e(st,{children:t(Ue,{p:2,children:[e(Ae,{}),e(ot,{}),e(p,{fontSize:"xs",pr:5,children:d("hostsDialog.sni.info")}),e(p,{fontSize:"xs",mt:"2",children:e(it,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(ee,{})}})}),e(p,{fontSize:"xs",children:e(it,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(ee,{})}})})]})})]})]}),e(gt,{size:"sm",borderRadius:"4px",placeholder:"SNI (e.g. example.com)",...i.register(r+"."+u+".sni")}),g&&((X=g[u])==null?void 0:X.sni)&&e(et,{children:(O=(j=g[u])==null?void 0:j.sni)==null?void 0:O.message})]}),t(D,{isInvalid:!!(g&&((G=g[u])==null?void 0:G.host)),children:[t(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:d("hostsDialog.host")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(lt,{})}),e(st,{children:t(Ue,{p:2,children:[e(Ae,{}),e(ot,{}),e(p,{fontSize:"xs",pr:5,children:d("hostsDialog.host.info")}),e(p,{fontSize:"xs",mt:"2",children:e(it,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(ee,{})}})}),e(p,{fontSize:"xs",children:e(it,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(ee,{})}})})]})})]})]}),e(gt,{size:"sm",borderRadius:"4px",placeholder:"Host (e.g. example.com)",...i.register(r+"."+u+".host")}),g&&((oe=g[u])==null?void 0:oe.host)&&e(et,{children:(K=(he=g[u])==null?void 0:he.host)==null?void 0:K.message})]}),t(D,{isInvalid:!!(g&&((_e=g[u])==null?void 0:_e.path)),children:[t(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:d("hostsDialog.path")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(lt,{})}),e(st,{children:t(Ue,{p:2,children:[e(Ae,{}),e(ot,{}),e(p,{fontSize:"xs",pr:5,children:d("hostsDialog.path.info")})]})})]})]}),e(gt,{size:"sm",borderRadius:"4px",placeholder:"path (e.g. /vless)",...i.register(r+"."+u+".path")}),g&&((M=g[u])==null?void 0:M.path)&&e(et,{children:(re=(T=g[u])==null?void 0:T.path)==null?void 0:re.message})]}),t(D,{height:"66px",children:[t(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:d("hostsDialog.security")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(lt,{})}),e(st,{children:t(Ue,{p:2,children:[e(Ae,{}),e(ot,{}),e(p,{fontSize:"xs",pr:5,children:d("hostsDialog.security.info")})]})})]})]}),e(br,{size:"sm",...i.register(r+"."+u+".security"),children:Ul.map(be=>e("option",{value:be.value,children:be.title},be.value))})]}),t(D,{height:"66px",children:[e(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:d("hostsDialog.alpn")})}),e(br,{size:"sm",...i.register(r+"."+u+".alpn"),children:as.map(be=>e("option",{value:be.value,children:be.title},be.value))})]}),t(D,{height:"66px",children:[e(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:d("hostsDialog.fingerprint")})}),e(br,{size:"sm",...i.register(r+"."+u+".fingerprint"),children:cs.map(be=>e("option",{value:be.value,children:be.title},be.value))})]}),t(D,{isInvalid:!!(g&&((H=g[u])==null?void 0:H.fragment_setting)),children:[t(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:d("hostsDialog.fragment")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(lt,{})}),e(st,{children:t(Ue,{p:2,children:[e(Ae,{}),e(ot,{}),e(p,{fontSize:"xs",pr:5,children:d("hostsDialog.fragment.info")}),e(p,{fontSize:"xs",pr:5,pt:2,pb:1,children:d("hostsDialog.fragment.info.examples")}),e(p,{fontSize:"xs",pr:5,children:"100-200,10-20,tlshello"}),e(p,{fontSize:"xs",pr:5,children:"100-200,10-20,1-3"}),e(p,{fontSize:"xs",pr:5,pt:"3",children:d("hostsDialog.fragment.info.attention")})]})})]})]}),e(gt,{size:"sm",borderRadius:"4px",placeholder:"Fragment settings by pattern",...i.register(r+"."+u+".fragment_setting")}),g&&((le=g[u])==null?void 0:le.fragment_setting)&&e(et,{children:(ne=(Y=g[u])==null?void 0:Y.fragment_setting)==null?void 0:ne.message})]}),t(D,{isInvalid:!!(g&&((ze=g[u])==null?void 0:ze.noise_setting)),children:[t(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:d("hostsDialog.noise")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(lt,{})}),e(st,{children:t(Ue,{p:2,children:[e(Ae,{}),e(ot,{}),e(p,{fontSize:"xs",pr:5,children:d("hostsDialog.noise.info")}),e(p,{fontSize:"xs",pr:5,pt:2,pb:1,children:d("hostsDialog.noise.info.examples")}),e(p,{fontSize:"xs",pr:5,children:"rand:10-20,10-20"}),e(p,{fontSize:"xs",pr:5,children:"rand:10-20,10-20&base64:7nQBAAABAAAAAAAABnQtcmluZwZtc2VkZ2UDbmV0AAABAAE=,10-25"}),e(p,{fontSize:"xs",pr:5,pt:"3",children:d("hostsDialog.noise.info.attention")})]})})]})]}),e(gt,{size:"sm",borderRadius:"4px",placeholder:"Noise settings by pattern",...i.register(r+"."+u+".noise_setting")}),g&&((Be=g[u])==null?void 0:Be.noise_setting)&&e(et,{children:(qe=(Ye=g[u])==null?void 0:Ye.noise_setting)==null?void 0:qe.message})]}),e(D,{isInvalid:!!(g&&((Ze=g[u])==null?void 0:Ze.allowinsecure)),children:t($t,{...i.register(r+"."+u+".allowinsecure"),name:r+"."+u+".allowinsecure",children:[e(U,{children:d("hostsDialog.allowinsecure")}),g&&((De=g[u])==null?void 0:De.allowinsecure)&&e(et,{children:(A=(ge=g[u])==null?void 0:ge.allowinsecure)==null?void 0:A.message})]})}),t(D,{isInvalid:!!(g&&((se=g[u])==null?void 0:se.mux_enable)),children:[e($t,{...i.register(r+"."+u+".mux_enable"),children:e(U,{children:d("hostsDialog.muxEnable")})}),g&&((Le=g[u])==null?void 0:Le.mux_enable)&&e(et,{children:(Ke=(He=g[u])==null?void 0:He.mux_enable)==null?void 0:Ke.message})]}),t(D,{isInvalid:!!(g&&((nt=g[u])==null?void 0:nt.random_user_agent)),children:[e($t,{...i.register(r+"."+u+".random_user_agent"),children:e(U,{children:d("hostsDialog.randomUserAgent")})}),g&&((me=g[u])==null?void 0:me.random_user_agent)&&e(et,{children:(Ft=(Lt=g[u])==null?void 0:Lt.random_user_agent)==null?void 0:Ft.message})]})]},u)})]})})]},c.id)},c.id)}),e(Q,{variant:"outline",w:"full",size:"sm",color:"",fontWeight:"normal",onClick:E,children:d("hostsDialog.addHost")})]})})]})},Bl=()=>{const{isEditingHosts:r,onEditingHosts:s,refetchUsers:n,inbounds:o}=$(),{isLoading:l,hosts:i,fetchHosts:a,isPostLoading:x,setHosts:y}=Ll(),I=Me(),{t:S}=te(),[C,d]=f.exports.useState({});f.exports.useEffect(()=>{r&&a()},[r]);const g=rt({resolver:bt($l)});f.exports.useEffect(()=>{i&&r&&g.reset(i)},[i]);const E=()=>{d({}),s(!1)},P=c=>{y(c).then(()=>{I({title:S("hostsDialog.savedSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3}),n()}).catch(u=>{var w,F,L,k,m;(((w=u==null?void 0:u.response)==null?void 0:w.status)===409||((F=u==null?void 0:u.response)==null?void 0:F.status)===400)&&I({title:(k=(L=u.response)==null?void 0:L._data)==null?void 0:k.detail,status:"error",isClosable:!0,position:"top",duration:3e3}),((m=u==null?void 0:u.response)==null?void 0:m.status)===422&&Object.keys(u.response._data.detail).forEach(v=>{I({title:u.response._data.detail[v]+" ("+v+")",status:"error",isClosable:!0,position:"top",duration:3e3})})})},h=c=>{C[String(c)]?delete C[String(c)]:C[String(c)]={},d({...C})};return t(xe,{isOpen:r,onClose:E,children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(we,{pt:6,children:e(ve,{color:"primary",children:e(Wl,{color:"white"})})}),e(Ce,{mt:3}),e(ke,{w:"440px",pb:3,pt:3,children:e(Ut,{...g,children:t("form",{onSubmit:g.handleSubmit(P),children:[e(p,{mb:3,opacity:.8,fontSize:"sm",children:S("hostsDialog.title")}),l&&S("hostsDialog.loading"),!l&&i&&(Object.keys(i).length>0?e(xt,{w:"full",allowToggle:!0,allowMultiple:!0,index:Object.keys(C).map(c=>parseInt(c)),children:e(B,{w:"full",children:Object.keys(i).map((c,u)=>e(jl,{toggleAccordion:()=>h(u),isOpen:C[String(u)],hostKey:c},c))})}):"No inbound found. Please check your Xray config file."),e(b,{justifyContent:"flex-end",py:2,children:e(Q,{variant:"solid",mt:"2",type:"submit",colorScheme:"primary",size:"sm",px:5,isLoading:x,disabled:x,children:S("hostsDialog.apply")})})]})})})]})]})},Br=(r,s,n)=>{if(r.response&&r.response._data){if(typeof r.response._data.detail=="string")return s({title:r.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof r.response._data.detail=="object"&&n){Object.keys(r.response._data.detail).forEach(o=>n.setError(o,{message:r.response._data.detail[o]}));return}}return s({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Hr=(r,s)=>s({title:r,status:"success",isClosable:!0,position:"top",duration:3e3}),Hl=({deleteCallback:r})=>{const{deleteNode:s,deletingNode:n,setDeletingNode:o}=Xt(),{t:l}=te(),i=Me(),a=Or(),x=()=>{o(null)},{isLoading:y,mutate:I}=jt(s,{onSuccess:()=>{Hr(l("deleteNode.deleteSuccess",{name:n&&n.name}),i),o(null),a.invalidateQueries(Gt),r&&r()},onError:S=>{Br(S,i)}});return t(xe,{isCentered:!0,isOpen:!!n,onClose:x,size:"sm",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",children:[e(we,{pt:6,children:e(ve,{color:"red",children:e(mt,{})})}),e(Ce,{mt:3}),t(ke,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:l("deleteNode.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(it,{components:{b:e("b",{})},children:l("deleteNode.prompt",{name:n.name})})})]}),t(Ne,{display:"flex",children:[e(Q,{size:"sm",onClick:x,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Q,{size:"sm",w:"full",colorScheme:"red",onClick:()=>I(),leftIcon:y?e(Pe,{size:"xs"}):void 0,children:l("delete")})]})]})]})},Jt={baseStyle:{strokeWidth:"2px",w:4,h:4}},rn=z(Ks,Jt),Vl=z(eo,Jt),nn=z(Rn,Jt),sn=z(Dn,Jt),Gl=z(Dn,Jt),Dr=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],Ct={active:{statusColor:"green",bandWidthColor:"primary",icon:rn},connected:{statusColor:"green",bandWidthColor:"primary",icon:rn},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:Vl},expired:{statusColor:"orange",bandWidthColor:"orange",icon:sn},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Gl},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:sn},limited:{statusColor:"red",bandWidthColor:"red",icon:nn},error:{statusColor:"red",bandWidthColor:"red",icon:nn}},cr=r=>{let s={status:"",time:""};if(r){ce(r*1e3).utc().isAfter(ce().utc())?s.status="expires":s.status="expired";const n=[],o=ce.duration(ce(r*1e3).utc().diff(ce()));o.years()!=0&&n.push(Math.abs(o.years())+" year"+(Math.abs(o.years())!=1?"s":"")),o.months()!=0&&n.push(Math.abs(o.months())+" month"+(Math.abs(o.months())!=1?"s":"")),o.days()!=0&&n.push(Math.abs(o.days())+" day"+(Math.abs(o.days())!=1?"s":"")),n.length===0&&(o.hours()!=0&&n.push(Math.abs(o.hours())+" hour"+(Math.abs(o.hours())!=1?"s":"")),o.minutes()!=0&&n.push(Math.abs(o.minutes())+" min"+(Math.abs(o.minutes())!=1?"s":""))),s.time=n.join(", "),er.language.toLocaleLowerCase()==="zh-cn"&&(s.time=s.time.replace(/year[s]?/,"\u5E74"),s.time=s.time.replace(/month[s]?/,"\u4E2A\u6708"),s.time=s.time.replace(/day[s]?/,"\u5929"),s.time=s.time.replace(/hour[s]?/,"\u5C0F\u65F6"),s.time=s.time.replace(/min[s]?/,"\u5206\u949F"),s.time=s.time.replace(/,/g,""),s.status=="expires"?s.time+="\u5185":s.time+="\u524D")}return s},Yl=({expiryDate:r,status:s,compact:n=!1,showDetail:o=!0,extraText:l})=>{const{t:i}=te(),a=cr(r),x=Ct[s].icon;return t(Ge,{children:[t(ee,{colorScheme:Ct[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:n?1:2,alignItems:"center",children:[e(x,{w:n?3:4}),o&&t(p,{textTransform:"capitalize",fontSize:n?".7rem":".875rem",lineHeight:n?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&i(`nodeModal.status.${s}`),l&&`: ${l}`]})]}),o&&r&&e(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},Ot=z(tt,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),ql=z(_n,{baseStyle:{w:5,h:5}}),Zl=z(Qt,{baseStyle:{w:5,h:5,strokeWidth:2}}),Ql=({toggleAccordion:r,node:s})=>{const{updateNode:n,reconnectNode:o,setDeletingNode:l}=Xt(),{t:i}=te(),a=Or(),x=Me(),y=rt({defaultValues:s,resolver:bt(rs)}),I=l.bind(null,s),{isLoading:S,mutate:C}=jt(n,{onSuccess:()=>{Hr("Node updated successfully",x),a.invalidateQueries(Gt)},onError:P=>{Br(P,x,y)}}),{isLoading:d,mutate:g}=jt(o.bind(null,s),{onSuccess:()=>{a.invalidateQueries(Gt)}}),E=d?"connecting":s.status?s.status:"error";return t(dt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[t(ht,{px:2,borderRadius:"3px",onClick:r,children:[t(b,{w:"full",justifyContent:"space-between",pr:2,children:[e(p,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:s.name}),t(b,{children:[s.xray_version&&e(ee,{colorScheme:"blue",rounded:"full",display:"inline-flex",px:3,py:1,children:t(p,{textTransform:"capitalize",fontSize:"0.7rem",fontWeight:"medium",letterSpacing:"tighter",children:["Xray ",s.xray_version]})}),s.status&&e(Yl,{status:E,compact:!0})]})]}),e(Dt,{})]}),t(ut,{px:2,pb:2,children:[e(B,{pb:3,alignItems:"flex-start",children:E==="error"&&e(pt,{status:"error",size:"xs",children:t(W,{children:[t(b,{w:"full",children:[e(ft,{w:4}),e(p,{marginInlineEnd:0,children:s.message})]}),e(b,{justifyContent:"flex-end",w:"full",children:e(Q,{size:"sm","aria-label":"reconnect node",leftIcon:e(jr,{}),onClick:()=>g(),disabled:d,children:i(d?"nodes.reconnecting":"nodes.reconnect")})})]})})}),e(ds,{form:y,mutate:C,isLoading:S,submitBtnText:i("nodes.editNode"),btnLeftAdornment:e(de,{label:i("delete"),placement:"top",children:e(q,{colorScheme:"red",variant:"ghost",size:"sm","aria-label":"delete node",onClick:I,children:e(mt,{})})})})]})]})},Xl=({toggleAccordion:r,resetAccordions:s})=>{const n=Me(),{t:o}=te(),l=Or(),{addNode:i}=Xt(),a=rt({resolver:bt(rs),defaultValues:{...el(),add_as_new_host:!1}}),{isLoading:x,mutate:y}=jt(i,{onSuccess:()=>{Hr(o("nodes.addNodeSuccess",{name:a.getValues("name")}),n),l.invalidateQueries(Gt),a.reset(),s()},onError:I=>{Br(I,n,a)}});return t(dt,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[e(ht,{px:2,borderRadius:"3px",onClick:r,children:t(p,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},display:"flex",gap:1,children:[e(Zl,{display:"inline-block"})," ",e("span",{children:o("nodes.addNewMarzbanNode")})]})}),e(ut,{px:2,py:4,children:e(ds,{form:a,mutate:y,isLoading:x,submitBtnText:o("nodes.addNode"),btnProps:{variant:"solid"},addAsHost:!0})})]})},ds=({form:r,mutate:s,isLoading:n,submitBtnText:o,btnProps:l={},btnLeftAdornment:i,addAsHost:a=!1})=>{var g,E,P,h,c,u,w,F,L,k,m,v,N,ie,J;const{t:x}=te(),[y,I]=f.exports.useState(!1),{data:S,isLoading:C}=lr({queryKey:"node-settings",queryFn:()=>V("/node/settings")});function d(R){if(document.body.createTextRange){const X=document.body.createTextRange();X.moveToElementText(R),X.select()}else if(window.getSelection){const X=window.getSelection(),j=document.createRange();j.selectNodeContents(R),X.removeAllRanges(),X.addRange(j)}else console.warn("Could not select text in node: Unsupported browser.")}return e("form",{onSubmit:r.handleSubmit(R=>s(R)),children:t(B,{children:[S&&S.certificate&&e(pt,{status:"info",alignItems:"start",children:t(En,{display:"flex",flexDirection:"column",overflow:"hidden",children:[e("span",{children:x("nodes.connection-hint")}),t(b,{justify:"end",py:2,children:[e(Q,{as:"a",colorScheme:"primary",size:"xs",download:"ssl_client_cert.pem",href:URL.createObjectURL(new Blob([S.certificate],{type:"text/plain"})),children:x("nodes.download-certificate")}),e(de,{placement:"top",label:x("nodes.show-certificate"),children:e(q,{"aria-label":x("nodes.show-certificate"),onClick:I.bind(null,!y),colorScheme:"whiteAlpha",color:"primary",size:"xs",children:y?e(ro,{width:"15px"}):e(to,{width:"15px"})})})]}),e(_r,{in:y,animateOpacity:!0,children:e(p,{bg:"rgba(255,255,255,.5)",_dark:{bg:"rgba(255,255,255,.2)"},rounded:"md",p:"2",lineHeight:"1.2",fontSize:"10px",fontFamily:"Courier",whiteSpace:"pre",overflow:"auto",onClick:R=>{d(R.target)},children:S.certificate})})]})}),t(b,{w:"full",children:[e(D,{children:e(Ot,{label:x("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...r.register("name"),error:(P=(E=(g=r.formState)==null?void 0:g.errors)==null?void 0:E.name)==null?void 0:P.message})}),e(b,{px:1,children:e(Oe,{name:"status",control:r.control,render:({field:R})=>e(de,{placement:"top",label:`${x("usersTable.status")}: `+(R.value!=="disabled"?x("active"):x("disabled")),textTransform:"capitalize",children:e(W,{mt:"6",children:e(We,{colorScheme:"primary",isChecked:R.value!=="disabled",onChange:X=>{X.target.checked?R.onChange("connecting"):R.onChange("disabled")}})})},R.value)})})]}),e(b,{alignItems:"flex-start",w:"100%",children:e(W,{w:"100%",children:e(Ot,{label:x("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...r.register("address"),error:(u=(c=(h=r.formState)==null?void 0:h.errors)==null?void 0:c.address)==null?void 0:u.message})})}),t(b,{alignItems:"flex-start",w:"100%",children:[e(W,{children:e(Ot,{label:x("nodes.nodePort"),size:"sm",placeholder:"62050",...r.register("port"),error:(L=(F=(w=r.formState)==null?void 0:w.errors)==null?void 0:F.port)==null?void 0:L.message})}),e(W,{children:e(Ot,{label:x("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...r.register("api_port"),error:(v=(m=(k=r.formState)==null?void 0:k.errors)==null?void 0:m.api_port)==null?void 0:v.message})}),e(W,{children:e(Ot,{label:x("nodes.usageCoefficient"),size:"sm",placeholder:"1",...r.register("usage_coefficient"),error:(J=(ie=(N=r.formState)==null?void 0:N.errors)==null?void 0:ie.usage_coefficient)==null?void 0:J.message})})]}),a&&e(D,{py:1,children:e($t,{...r.register("add_as_new_host"),children:e(U,{m:0,children:x("nodes.addHostForEveryInbound")})})}),t(b,{w:"full",children:[i,e(Q,{flexGrow:1,type:"submit",colorScheme:"primary",size:"sm",px:5,w:"full",isLoading:n,...l,children:o})]})]})})},Jl=()=>{const{isEditingNodes:r,onEditingNodes:s}=$(),{t:n}=te(),[o,l]=f.exports.useState({}),{data:i,isLoading:a}=ns(),x=()=>{l({}),s(!1)},y=I=>{o[String(I)]?delete o[String(I)]:o[String(I)]={},l({...o})};return t(Ge,{children:[t(xe,{isOpen:r,onClose:x,children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(we,{pt:6,children:e(ve,{color:"primary",children:e(ql,{color:"white"})})}),e(Ce,{mt:3}),t(ke,{w:"440px",pb:6,pt:3,children:[e(p,{mb:3,opacity:.8,fontSize:"sm",children:n("nodes.title")}),a&&"loading...",e(xt,{w:"full",allowToggle:!0,index:Object.keys(o).map(I=>parseInt(I)),children:t(B,{w:"full",children:[!a&&i&&i.map((I,S)=>e(Ql,{toggleAccordion:()=>y(S),node:I},I.name)),e(Xl,{toggleAccordion:()=>y((i||[]).length),resetAccordions:()=>l({})})]})})]})]})]}),e(Hl,{deleteCallback:()=>l({})})]})};function Kl(r){const s=360/r,n=90,o=47,l=[];for(let i=0;i<r;i++){const a=i*s%360+140,x=ei(a,n,o);l.push(x)}return l}function ei(r,s,n){r/=360,s/=100,n/=100;let o,l,i;if(s===0)o=l=i=n;else{const x=(S,C,d)=>(d<0&&(d+=1),d>1&&(d-=1),d<.16666666666666666?S+(C-S)*6*d:d<.5?C:d<.6666666666666666?S+(C-S)*(.6666666666666666-d)*6:S),y=n<.5?n*(1+s):n+s-n*s,I=2*n-y;o=Math.round(x(I,y,r+1/3)*255),l=Math.round(x(I,y,r)*255),i=Math.round(x(I,y,r-1/3)*255)}const a=x=>{const y=x.toString(16);return y.length===1?"0"+y:y};return`#${a(o)}${a(l)}${a(i)}`}const on=({border:r,...s})=>{const{getInputProps:n,getRadioProps:o}=oo(s),l=wt({base:"xs",md:"sm"});return t(W,{as:"label",children:[e("input",{...n()}),e(W,{...o(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:l,borderWidth:r?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:s.children})]})},hs=({onChange:r,defaultValue:s,...n})=>{const{t:o,i18n:l}=te();vt();const i=wt({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),a={h:"hour",d:"day",w:"week",m:"month",y:"year"},x=wt({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:y,getRadioProps:I,setValue:S}=no({name:"filter",defaultValue:s,onChange:R=>{if(R==="custom")return;g(),i.indexOf(R)>=0?(h(o("userDialog.custom")),u(!1)):(h(o("userDialog.custom")+` (${R})`),u(!0));const X=Number(R.substring(0,R.length-1)),j=a[R[R.length-1]];r(R,{start:ce().utc().subtract(X,j).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:C,onOpen:d,onClose:g}=Tn(),E=f.exports.useRef(null);so({ref:E,handler:g});const[P,h]=f.exports.useState(o("userDialog.custom")),[c,u]=f.exports.useState(!1),[w,F]=f.exports.useState(0),L=wt({base:1,md:2}),k=wt({base:"xs",md:"sm"}),[m,v]=f.exports.useState(null),[N,ie]=f.exports.useState(null),J=R=>{const[X,j]=R;N&&!j?(v(null),ie(null)):(v(X),ie(j),X&&j&&(g(),r("custom",{start:ce(X).format("YYYY-MM-DDT00:00:00"),end:ce(j).format("YYYY-MM-DDT23:59:59")})))};return t(B,{...n,children:[w==0&&t(kt,{...y(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[i.map(R=>e(on,{...I({value:R}),children:R},R)),e(W,{onClick:()=>{v(null),ie(null),d()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:k,px:3,py:1,bg:c?"primary.500":"unset",color:c?"white":"unset",borderColor:c?"primary.500":"unset",children:t(b,{children:[e(p,{children:P}),e(gr,{as:Qr,boxSize:"18px"})]})})]}),w==1&&t(b,{onClick:d,cursor:"pointer",fontSize:k,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(p,{w:"full",color:m?"unset":"gray.500",children:m?ce(m).format("YYYY-MM-DD (00:00)"):o("userDialog.startDate")}),e(gr,{as:Un,boxSize:"18px"}),e(p,{w:"full",color:N?"unset":"gray.500",children:N?ce(N).format("YYYY-MM-DD (23:59)"):o("userDialog.endDate")}),e(gr,{as:Qr,boxSize:"18px"})]}),e(B,{ref:E,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:C?"unset":"none",children:t(An,{onChange:R=>F(R),children:[t(Pn,{children:[e(It,{fontSize:k,children:o("userDialog.relative")}),e(It,{fontSize:k,children:o("userDialog.absolute")})]}),t(Ln,{children:[e(Rt,{children:x.map(R=>e(B,{alignItems:"start",pl:2,pr:2,children:t(b,{justifyItems:"flex-start",mb:4,children:[e(p,{fontSize:k,minW:"60px",children:o("userDialog."+R.title)}),R.options.map(X=>e(on,{border:!0,...I({value:X}),children:X},X+".custom"))]})},R.title))}),e(Rt,{className:"datepicker-panel",children:e(B,{children:e(Fn,{locale:l.language.toLocaleLowerCase(),selected:m,onChange:J,startDate:m,endDate:N,selectsRange:!0,maxDate:new Date,monthsShown:L,peekNextMonth:!1,inline:!0})})})]})]})})]})};function rr(r,s,n=[],o=[]){const l=Fe(n.reduce((i,a)=>i+=a,0));return{series:n,options:{labels:o,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${s}${l}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:r==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:r==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(i,{seriesIndex:a,w:x})=>Fe(x.config.series[a],1)},tooltip:{custom:({series:i,seriesIndex:a,dataPointIndex:x,w:y})=>{const I=Fe(i[a],1),S=Math.max(i.reduce((d,g)=>d+=g),1),C=Math.round(i[a]/S*1e3)/10+"%";return`
            <div style="
                    background-color: ${y.globals.colors[a]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${y.config.labels[a]}: <b>${C}, ${I}</b>
            </div>
          `}},colors:Kl(n.length)}}}const ln=(r,s=[],n=[])=>({series:s,options:{chart:{type:"bar",stacked:!0,width:"100%",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!0,borderRadius:6,dataLabels:{total:{enabled:!0,offsetX:20,style:{fontSize:"var(--chakra-fontSizes-xs)",fontWeight:900,color:r==="dark"?"var(--chakra-colors-gray-300)":void 0}}}}},stroke:{width:1,colors:["#fff"]},dataLabels:{formatter:(o,{seriesIndex:l,w:i})=>Fe(o,1)},xaxis:{type:"category",categories:n,labels:{formatter:function(o){return Fe(o,0)},style:{colors:r==="dark"?"var(--chakra-colors-gray-300)":void 0}}},yaxis:{title:{text:void 0},labels:{style:{fontSize:"var(--chakra-fontSizes-sm)",colors:r==="dark"?"var(--chakra-colors-gray-300)":void 0}}},tooltip:{custom:({series:o,seriesIndex:l,dataPointIndex:i,w:a})=>{console.log(o);const x=o[l],y=Fe(x[i],1);return`
            <div style="
                    background-color: ${a.globals.colors[l]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${a.globals.seriesNames[l]}: <b>${y}</b>
            </div>
          `}},fill:{opacity:1},legend:{position:"bottom",labels:{colors:r==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}}}}),ti=z(or,{baseStyle:{w:5,h:5}}),ri=()=>{const{isShowingNodesUsage:r,onShowingNodesUsage:s,fetchUserUsageTop10:n}=$(),{fetchNodesUsage:o}=Xt(),{t:l}=te(),[i,a]=f.exports.useState(!1),{colorMode:x}=vt(),y=l("userDialog.total"),[I,S]=f.exports.useState(rr(x,y)),[C,d]=f.exports.useState(ln(x)),[g,E]=f.exports.useState("1m"),P=u=>{o(u).then(w=>{const F=[],L=[];for(const k in w.usages){const m=w.usages[k];L.push(m.uplink+m.downlink),F.push(m.node_name)}S(rr(x,y,L,F))}),n(u).then(w=>{const F=w.usages,L=w.users;d(ln(x,F,L))})};f.exports.useEffect(()=>{r&&P({start:ce().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})},[r]);const h=()=>{s(!1),E("1m")},c=i;return t(xe,{isOpen:r,onClose:h,size:"2xl",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",w:"full",children:[e(we,{pt:6,children:t(b,{gap:2,children:[e(ve,{color:"primary",children:e(ti,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:l("header.nodesUsage")})]})}),e(Ce,{mt:3,disabled:c}),e(ke,{children:t(B,{gap:4,children:[e(hs,{defaultValue:g,onChange:(u,w)=>{E(u),P(w)}}),e(W,{justifySelf:"center",w:"full",mt:"4",children:e(f.exports.Suspense,{fallback:e(kr,{isIndeterminate:!0}),children:e(zr,{options:I.options,series:I.series,type:"donut",height:"360px"})})}),e(W,{justifySelf:"center",w:"full",children:e(f.exports.Suspense,{fallback:e(kr,{isIndeterminate:!0}),children:e(zr,{options:C.options,series:C.series,type:"bar"})})})]})}),e(Ne,{mt:"3"})]})]})},an=z(lo),ni=z(Un,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),si=z(io,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),oi=z(Wr,{baseStyle:{w:5,h:5}}),li=()=>{const{QRcodeLinks:r,setQRCode:s,setSubLink:n,subscribeUrl:o}=$(),l=r!==null,[i,a]=f.exports.useState(0),{t:x}=te(),y=()=>{s(null),n(null)},I=String(o).startsWith("/")?window.location.origin+o:String(o);return t(xe,{isOpen:l,onClose:y,children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(we,{pt:6,children:e(ve,{color:"primary",children:e(oi,{color:"white"})})}),e(Ce,{mt:3}),r&&t(ke,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[o&&t(B,{children:[e(an,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:I,bg:"white"}),e(p,{display:"block",textAlign:"center",pb:3,mt:1,children:x("qrcodeDialog.sublink")})]}),t(W,{w:"300px",children:[e(ao,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:a,onInit:()=>a(0),nextArrow:e(q,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(ni,{})}),prevArrow:e(q,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(si,{})}),children:r.map((S,C)=>e(b,{children:e(an,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:S,bg:"white"})},C))}),t(p,{display:"block",textAlign:"center",pb:3,mt:1,children:[i+1," / ",r.length]})]})]})]})]})},ii=z(zn,{baseStyle:{w:5,h:5}}),ai=()=>{const[r,s]=f.exports.useState(!1),{isResetingAllUsage:n,onResetAllUsage:o,resetAllUsage:l}=$(),{t:i}=te(),a=Me(),x=()=>{o(!1)},y=()=>{s(!0),l().then(()=>{a({title:i("resetAllUsage.success"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:i("resetAllUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)})};return t(xe,{isCentered:!0,isOpen:n,onClose:x,size:"sm",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",children:[e(we,{pt:6,children:e(ve,{color:"red",children:e(ii,{})})}),e(Ce,{mt:3}),t(ke,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:i("resetAllUsage.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:i("resetAllUsage.prompt")})]}),t(Ne,{display:"flex",children:[e(Q,{size:"sm",onClick:x,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(Q,{size:"sm",w:"full",colorScheme:"red",onClick:y,leftIcon:r?e(Pe,{size:"xs"}):void 0,children:i("reset")})]})]})]})},ci=z(qt,{baseStyle:{w:5,h:5}}),di=()=>{const[r,s]=f.exports.useState(!1),{resetUsageUser:n,resetDataUsage:o}=$(),{t:l}=te(),i=Me(),a=()=>{$.setState({resetUsageUser:null})},x=()=>{n&&(s(!0),o(n).then(()=>{i({title:l("resetUserUsage.success",{username:n.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:l("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return t(xe,{isCentered:!0,isOpen:!!n,onClose:a,size:"sm",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",children:[e(we,{pt:6,children:e(ve,{color:"blue",children:e(ci,{})})}),e(Ce,{mt:3}),t(ke,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:l("resetUserUsage.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(it,{components:{b:e("b",{})},children:l("resetUserUsage.prompt",{username:n.username})})})]}),t(Ne,{display:"flex",children:[e(Q,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Q,{size:"sm",w:"full",colorScheme:"blue",onClick:x,leftIcon:r?e(Pe,{size:"xs"}):void 0,children:l("reset")})]})]})]})},hi=z(qt,{baseStyle:{w:5,h:5}}),ui=()=>{const[r,s]=f.exports.useState(!1),{revokeSubscriptionUser:n,revokeSubscription:o}=$(),{t:l}=te(),i=Me(),a=()=>{$.setState({revokeSubscriptionUser:null})},x=()=>{n&&(s(!0),o(n).then(()=>{i({title:l("revokeUserSub.success",{username:n.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:l("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return t(xe,{isCentered:!0,isOpen:!!n,onClose:a,size:"sm",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",children:[e(we,{pt:6,children:e(ve,{color:"blue",children:e(hi,{})})}),e(Ce,{mt:3}),t(ke,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:l("revokeUserSub.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(it,{components:{b:e("b",{})},children:l("revokeUserSub.prompt",{username:n.username})})})]}),t(Ne,{display:"flex",children:[e(Q,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Q,{size:"sm",w:"full",colorScheme:"blue",onClick:x,leftIcon:r?e(Pe,{size:"xs"}):void 0,children:l("revoke")})]})]})]})},pi=r=>f.exports.createElement("svg",{height:60,width:60,viewBox:"0 0 60 60",xmlns:"http://www.w3.org/2000/svg",...r},f.exports.createElement("path",{fill:"#ccc",d:"M30 60a30 30 0 1130-30 30 30 0 01-30 30zm14-34H34V16a4 4 0 00-8 0v10H16a4 4 0 000 8h10v10a4 4 0 008 0V34h10a4 4 0 000-8z"})),fe=Yt((r,s)=>({loading:!1,sublink:null,setSublink:n=>r({sublink:n}),settings:[],editingSetting:null,onEditingSetting:n=>r({editingSetting:n}),fetchSettings:()=>(r({loading:!0}),V("/clash/settings").then(n=>(r({settings:n.data}),n.data)).finally(()=>{r({loading:!1})})),editSetting:n=>V(`/clash/setting/${n.name}`,{method:"PUT",body:n}).then(()=>{r({editingSetting:null}),s().fetchSettings()}),alert:null,onAlert:n=>r({alert:n}),rules:[],totalRules:0,rulesets:[],ruleFilter:{value:"",sort:"-modified_at",limit:10},fetchRules:()=>{var n=s().ruleFilter;for(const o in n)n[o]||delete n[o];return r({loading:!0}),V("/clash/rules",{query:n}).then(o=>(r({rules:o.data,totalRules:o.total}),o.data)).finally(()=>{r({loading:!1})})},fetchRulesets:()=>V("/clash/rulesets").then(n=>(fe.setState({rulesets:n.data}),n.data)),onRuleFilterChange:n=>{r({ruleFilter:{...s().ruleFilter,...n}}),s().fetchRules()},isCreatingRule:!1,editingRule:null,onCreateRule:n=>r({isCreatingRule:n}),onEditingRule:n=>r({editingRule:n}),createRule:n=>V("/clash/rule",{method:"POST",body:n}).then(()=>{r({editingRule:null}),s().fetchRules()}),editRule:n=>V(`/clash/rule/${n.id}`,{method:"PUT",body:n}).then(()=>{r({editingRule:null}),s().fetchRules()}),deleteRule:n=>V(`/clash/rule/${n.id}`,{method:"DELETE"}).then(()=>{r({editingRule:null}),s().fetchRules()}),isCreatingRuleset:!1,editingRuleset:null,onCreateRuleset:n=>r({isCreatingRuleset:n}),onEditingRuleset:n=>r({editingRuleset:n}),createRuleset:n=>V("/clash/ruleset",{method:"POST",body:n}).then(()=>{r({editingRuleset:null}),s().fetchRulesets()}),editRuleset:n=>V(`/clash/ruleset/${n.id}`,{method:"PUT",body:n}).then(()=>{r({editingRuleset:null}),s().fetchRulesets()}),deleteRuleset:n=>V(`/clash/ruleset/${n.id}`,{method:"DELETE"}).then(()=>{r({editingRuleset:null}),s().ruleFilter.ruleset="",s().fetchRulesets(),s().fetchRules()}),proxyTags:[],proxyInbounds:[],proxyBriefs:[],proxies:[],totalProxies:0,proxyFilter:{search:"",sort:"id",limit:10},fetchProxies:()=>{var n=s().proxyFilter;for(const o in n)n[o]||delete n[o];return r({loading:!0}),V("/clash/proxies",{query:n}).then(o=>(r({proxies:o.data,totalProxies:o.total}),o.data)).finally(()=>{r({loading:!1})})},fetchProxyTags:()=>V("/clash/proxy/tags").then(n=>(r({proxyTags:n.data}),n.data)),fetchProxyInbounds:()=>V("/clash/proxy/inbounds").then(n=>(r({proxyInbounds:n.data}),n.data)),fetchProxyBriefs:()=>V("/clash/proxy/briefs").then(n=>(r({proxyBriefs:n.data}),n.data)),onProxyFilterChange:n=>{r({proxyFilter:{...s().proxyFilter,...n}}),s().fetchProxies()},isCreatingProxy:!1,editingProxy:null,duplicatingProxy:null,onCreateProxy:n=>r({isCreatingProxy:n}),onEditingProxy:n=>r({editingProxy:n}),onDuplicatingProxy:n=>{n?(s().onEditingProxy(null),r({duplicatingProxy:n}),s().onCreateProxy(!0)):r({duplicatingProxy:n})},createProxy:n=>V("/clash/proxy",{method:"POST",body:n}).then(()=>{r({editingProxy:null}),s().fetchProxyBriefs(),s().fetchProxyTags(),s().fetchProxies()}),editProxy:n=>V(`/clash/proxy/${n.id}`,{method:"PUT",body:n}).then(()=>{$.getState().refetchUsers(),r({editingProxy:null}),s().fetchProxyBriefs(),s().fetchProxyTags(),s().fetchProxies()}),deleteProxy:n=>V(`/clash/proxy/${n.id}`,{method:"DELETE"}).then(()=>{r({editingProxy:null}),$.getState().refetchUsers(),s().fetchProxyBriefs(),s().fetchProxyTags(),s().fetchProxies()}),proxyGroups:[],totalProxyGroups:0,proxyGroupFilter:{search:"",sort:"id",limit:10},fetchProxyGroups:()=>{var n=s().proxyGroupFilter;for(const o in n)n[o]||delete n[o];return r({loading:!0}),V("/clash/proxy/groups",{query:n}).then(o=>(r({proxyGroups:o.data,totalProxyGroups:o.total}),o.data)).finally(()=>{r({loading:!1})})},onProxyGroupFilterChange:n=>{r({proxyGroupFilter:{...s().proxyGroupFilter,...n}}),s().fetchProxyGroups()},isCreatingProxyGroup:!1,editingProxyGroup:null,duplicatingProxyGroup:null,onCreateProxyGroup:n=>r({isCreatingProxyGroup:n}),onEditingProxyGroup:n=>r({editingProxyGroup:n}),onDuplicatingProxyGroup:n=>{n?(s().onEditingProxyGroup(null),r({duplicatingProxyGroup:n}),s().onCreateProxyGroup(!0)):r({duplicatingProxyGroup:n})},createProxyGroup:n=>V("/clash/proxy/group",{method:"POST",body:n}).then(()=>{r({editingProxyGroup:null}),s().fetchProxyTags(),s().fetchProxyGroups(),s().fetchProxyBriefs()}),editProxyGroup:n=>V(`/clash/proxy/group/${n.id}`,{method:"PUT",body:n}).then(()=>{$.getState().refetchUsers(),r({editingProxyGroup:null}),s().fetchProxyTags(),s().fetchProxyGroups(),s().fetchProxyBriefs()}),deleteProxyGroup:n=>V(`/clash/proxy/group/${n.id}`,{method:"DELETE"}).then(()=>{const o=s().editingProxyGroup;o!=null&&o.tag&&$.getState().refetchUsers(),r({editingProxyGroup:null}),s().fetchProxyTags(),s().fetchProxyGroups(),s().fetchProxyBriefs()})})),mi=z(co,{baseStyle:{strokeWidth:"2px",w:5,h:5}}),gi=({inbound:r,...s})=>{const{getCheckboxProps:n,getInputProps:o,getLabelProps:l,htmlProps:i}=Nn(s),a=o();return t(W,{as:"label",children:[e("input",{...a}),t(W,{w:"fll",position:"relative",...i,cursor:"pointer",borderRadius:"sm",border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"gray.600"},display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden",_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent",fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& p":{opacity:1}},__css:{"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...n(),children:[e($t,{size:"sm",w:"full",maxW:"full",color:"gray.700",_dark:{color:"gray.300"},textTransform:"uppercase",colorScheme:"primary",className:"inbound-item",isChecked:a.checked,pointerEvents:"none",flexGrow:1,children:e(b,{justify:"space-between",w:"full",maxW:"calc(100% - 20px)",spacing:0,gap:2,overflow:"hidden",children:t(p,{isTruncated:!0,...l(),fontSize:"xs",children:[r.tag," ",t(p,{as:"span",children:["(",r.network,")"]})]})})}),r.tls&&r.tls!="none"&&e(ee,{fontSize:"xs",opacity:".8",size:"xs",children:r.tls})]})]})},fi=({disabled:r,title:s,description:n,toggleAccordion:o,isSelected:l,...i})=>{const a=Nr(),{inbounds:x}=$(),{getCheckboxProps:y,getInputProps:I,getLabelProps:S,htmlProps:C}=Nn(i),d=I(),[g]=On({name:[`inbounds.${s}`],control:a.control}),{getCheckboxProps:E}=Mn({value:g,onChange:u=>{if(a.setValue(`inbounds.${s}`,u),u.length===0){const w=a.getValues("selected_proxies");a.setValue("selected_proxies",w.filter(F=>F!==s)),o()}}}),P=g&&l&&($.getState().inbounds.get(s)||[]).length!==g.length,h=($.getState().inbounds.get(s)||[]).length>0,c=!l&&!h;return t(dt,{isDisabled:!h,borderRadius:"md",borderStyle:"solid",border:"1px",borderColor:"gray.200",bg:c?"gray.100":"transparent",_dark:{borderColor:"gray.600",bg:c?"#364154":"transparent"},_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent"},...y(),children:[t(W,{as:c?"span":"label",position:"relative",children:[P&&e(W,{position:"absolute",w:"2",h:"2",bg:"yellow.500",top:"-1",right:"-1",rounded:"full",zIndex:999}),e("input",{...d}),t(W,{w:"fll",position:"relative",...C,borderRadius:"md",cursor:c?"not-allowed":"pointer",_checked:{fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& > svg":{opacity:1,"&.checked":{display:"block"},"&.unchecked":{display:"none"}},"& p":{opacity:1}},__css:{"& > svg":{opacity:.3,"&.checked":{display:"none"},"&.unchecked":{display:"block"}},"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...y(),children:[e(ht,{display:d.checked&&h?"block":"none",as:"span",className:"checked",color:"primary.200",position:"absolute",right:"3",top:"3",w:"auto",p:0,onClick:o,children:e(q,{size:"sm","aria-label":"inbound settings",children:e(mi,{})})}),e(p,{fontSize:"sm",color:c?"gray.400":"gray.700",_dark:{color:c?"gray.500":"gray.300"},...S(),children:s}),e(p,{fontWeight:"medium",color:c?"gray.400":"gray.600",_dark:{color:c?"gray.500":"gray.400"},fontSize:"xs",children:n})]})]}),e(ut,{px:2,pb:3,roundedBottom:"5px",pt:3,_dark:{bg:d.checked&&"gray.750"},children:t(B,{w:"full",rowGap:2,borderStyle:"solid",borderWidth:"1px",borderRadius:"md",pl:3,pr:3,pt:1.5,_dark:{bg:"gray.700"},children:[t(B,{alignItems:"flex-start",w:"full",children:[e(p,{fontSize:"sm",children:Ie("inbound")}),e(kt,{gap:2,alignItems:"flex-start",w:"full",columns:1,spacing:1,children:(x.get(s)||[]).map(u=>e(gi,{...E({value:u.tag}),inbound:u},u.tag))})]}),s==="vmess"&&l&&e(B,{alignItems:"flex-start",w:"full",children:t(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:"ID"}),e(Z,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ie("userDialog.generatedByDefault"),...a.register("proxies.vmess.id")})]})}),s==="vless"&&l&&t(B,{alignItems:"flex-start",w:"full",children:[t(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:"ID"}),e(Z,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ie("userDialog.generatedByDefault"),...a.register("proxies.vless.id")})]}),t(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:"Flow"}),e(pe,{fontSize:"xs",size:"sm",borderRadius:"6px",...a.register("proxies.vless.flow"),children:Al.map(u=>e("option",{value:u.value,children:u.title},u.title))})]})]}),s==="trojan"&&l&&e(B,{alignItems:"flex-start",w:"full",children:t(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:Ie("password")}),e(Z,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ie("userDialog.generatedByDefault"),...a.register("proxies.trojan.password")})]})}),s==="shadowsocks"&&l&&t(B,{alignItems:"flex-start",w:"full",children:[t(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:Ie("password")}),e(Z,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ie("userDialog.generatedByDefault"),...a.register("proxies.shadowsocks.password")})]}),t(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:Ie("userDialog.method")}),e(pe,{fontSize:"xs",size:"sm",borderRadius:"6px",...a.register("proxies.shadowsocks.method"),children:Pl.map(u=>e("option",{value:u,children:u},u))})]})]})]})})]})},bi=f.exports.forwardRef(({name:r,list:s,onChange:n,disabled:o,...l},i)=>{const a=Nr(),[x,y]=f.exports.useState([]),I=C=>{x.includes(C)?x.splice(x.indexOf(C),1):x.push(C),y([...x])},{getCheckboxProps:S}=Mn({value:l.value,onChange:C=>{var g;const d=C.filter(E=>!l.value.includes(E));d[0]&&a.setValue(`inbounds.${d[0]}`,(g=$.getState().inbounds.get(d[0]))==null?void 0:g.map(E=>E.tag)),y(x.filter(E=>C.find(P=>P===s[E].title))),n(C)}});return e(xt,{allowToggle:!0,index:x,children:e(kt,{ref:i,gap:2,alignItems:"flex-start",columns:1,spacing:1,children:s.map((C,d)=>e(fi,{toggleAccordion:I.bind(null,d),disabled:o,title:C.title,description:C.description,isSelected:!!l.value.find(g=>g===C.title),...S({value:C.title})},C.title))})})}),Kt={baseStyle:{w:5,h:5}},xi=z(Fr,Kt),yi=z(Lr,Kt),Si=z(ir,Kt),wi=z(Qt,Kt),Ci=z(Pr,Kt),ki=z(pi),vi=z(Mr,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),_i=z(ho,{baseStyle:{w:5,h:5}}),zi=z(At,{baseStyle:{w:5,h:5}}),Ii=z(or,{baseStyle:{w:5,h:5}}),Ri=r=>({...r,data_limit:r.data_limit?Number((r.data_limit/1073741824).toFixed(5)):r.data_limit,on_hold_expire_duration:r.on_hold_expire_duration?Number(r.on_hold_expire_duration/(24*60*60)):r.on_hold_expire_duration,selected_proxies:Object.keys(r.proxies),sub_tags:r.sub_tags||""}),xr=()=>{const r=Object.fromEntries($.getState().inbounds),s={};for(const n in r)s[n]=r[n].map(o=>o.tag);return{selected_proxies:Object.keys(r),data_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:s,proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},sub_url_prefix:"",sub_tags:"",sub_revoked_at:""}},Di=(r,s)=>{const n=r.reduce((o,l)=>({...o,[l]:{}}),{});return s&&r.forEach(o=>{s[o]&&(n[o]=s[o])}),n},Wt={username:_.string().min(1,{message:"Required"}),selected_proxies:_.array(_.string()).refine(r=>r.length>0,{message:"userDialog.selectOneProtocol"}),note:_.string().nullable(),proxies:_.record(_.string(),_.record(_.string(),_.any())).transform(r=>{const s=(n,o)=>{n&&n[o]===""&&delete n[o]};return s(r.vmess,"id"),s(r.vless,"id"),s(r.trojan,"password"),s(r.shadowsocks,"password"),s(r.shadowsocks,"method"),r}),data_limit:_.string().min(0).or(_.number()).nullable().transform(r=>r?Number((parseFloat(String(r))*1073741824).toFixed(5)):0),expire:_.number().nullable(),data_limit_reset_strategy:_.string(),sub_url_prefix:_.string().nullable(),sub_tags:_.string().nullable(),inbounds:_.record(_.string(),_.array(_.string())).transform(r=>(Object.keys(r).forEach(s=>{var n;Array.isArray(r[s])&&!((n=r[s])!=null&&n.length)&&delete r[s]}),r))},Ei=_.discriminatedUnion("status",[_.object({status:_.literal("active"),...Wt}),_.object({status:_.literal("disabled"),...Wt}),_.object({status:_.literal("limited"),...Wt}),_.object({status:_.literal("expired"),...Wt}),_.object({status:_.literal("on_hold"),on_hold_expire_duration:_.coerce.number().min(.1,"Required").transform(r=>r*(24*60*60)),...Wt})]),Ti=()=>{var Ye,qe,Ze,De,ge;const{editingUser:r,isCreatingNewUser:s,onCreateUser:n,editUser:o,fetchUserUsage:l,onEditingUser:i,createUser:a,onDeletingUser:x}=$(),y=!!r,I=s||y,[S,C]=f.exports.useState(!1),[d,g]=f.exports.useState(""),[E,P]=f.exports.useState("hidden"),[h,c]=f.exports.useState(""),u=Me(),{t:w,i18n:F}=te(),{colorMode:L}=vt(),[k,m]=f.exports.useState(!1),v=()=>{m(A=>!A)},{isOpen:N,onToggle:ie,onClose:J}=Tn(),R=rt({defaultValues:xr(),resolver:bt(Ei)});f.exports.useEffect(()=>$.subscribe(A=>A.inbounds,()=>{R.reset(xr())}),[]);const[X,j]=On({control:R.control,name:["data_limit","status"]}),O=w("userDialog.total"),[G,oe]=f.exports.useState(rr(L,O)),[he,K]=f.exports.useState("1m"),_e=A=>{l(r,A).then(se=>{const Le=[],He=[];for(const Ke in se.usages)He.push(se.usages[Ke].used_traffic),Le.push(se.usages[Ke].node_name);oe(rr(L,O,He,Le))})};f.exports.useEffect(()=>{r&&(R.reset(Ri(r)),c(r.sub_url_prefix),_e({start:ce().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}))},[r]);const M=A=>{C(!0);const se={edited:o,created:a},Le=y?"edited":"created";g(null);const{selected_proxies:He,...Ke}=A;let nt={...Ke,data_limit:A.data_limit,proxies:Di(He,A.proxies),data_limit_reset_strategy:A.data_limit&&A.data_limit>0?A.data_limit_reset_strategy:"no_reset",status:A.status==="active"||A.status==="disabled"||A.status==="on_hold"?A.status:"active"};se[Le](nt).then(()=>{u({title:w(y?"userDialog.userEdited":"userDialog.userCreated",{username:A.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),T()}).catch(me=>{var Lt,Ft,be,Mt,Gr;(((Lt=me==null?void 0:me.response)==null?void 0:Lt.status)===409||((Ft=me==null?void 0:me.response)==null?void 0:Ft.status)===400)&&g((Mt=(be=me==null?void 0:me.response)==null?void 0:be._data)==null?void 0:Mt.detail),((Gr=me==null?void 0:me.response)==null?void 0:Gr.status)===422&&Object.keys(me.response._data.detail).forEach(mr=>{g(me==null?void 0:me.response._data.detail[mr]),R.setError(mr,{type:"custom",message:me.response._data.detail[mr]})})}).finally(()=>{C(!1)})},T=()=>{R.reset(xr()),n(!1),i(null),g(null),m(!1),K("1m"),J()},re=()=>{$.setState({resetUsageUser:r})},H=()=>{$.setState({revokeSubscriptionUser:r})},le=S,Y=j==="on_hold",[ne,ze]=f.exports.useState(!1),Be=()=>{ze(!0);let A="";const se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Le=se.length;let He=0;for(;He<6;)A+=se.charAt(Math.floor(Math.random()*Le)),He+=1;return A};return t(xe,{isOpen:I,onClose:T,size:"2xl",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Ut,{...R,children:e(Se,{mx:"3",children:t("form",{onSubmit:R.handleSubmit(M),children:[e(we,{pt:6,children:t(b,{gap:2,children:[e(ve,{color:"primary",children:y?e(zi,{color:"white"}):e(_i,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:w(y?"userDialog.editUserTitle":"createNewUser")})]})}),e(Ce,{mt:3,disabled:le}),t(ke,{children:[t(wn,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:[e(zt,{children:t(B,{justifyContent:"space-between",children:[t(St,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[t(St,{flexDirection:"row",w:"full",gap:2,children:[t(D,{mb:"10px",children:[e(U,{children:t(St,{gap:2,alignItems:"center",children:[w("username"),!y&&e(jr,{cursor:"pointer",className:Xe({"animate-spin":ne}),onClick:()=>{const A=Be();R.setValue("username",A),setTimeout(()=>{ze(!1)},350)}})]})}),t(b,{children:[e(tt,{size:"sm",type:"text",borderRadius:"6px",error:(Ye=R.formState.errors.username)==null?void 0:Ye.message,disabled:le||y,...R.register("username")}),y&&e(b,{px:1,children:e(Oe,{name:"status",control:R.control,render:({field:A})=>e(de,{placement:"top",label:"status: "+w(`status.${A.value}`),textTransform:"capitalize",children:e(W,{children:e(We,{colorScheme:"primary",isChecked:A.value==="active",onChange:se=>{se.target.checked?A.onChange("active"):A.onChange("disabled")}})})})})})]})]}),!y&&t(D,{flex:"1",children:[e(U,{whiteSpace:"nowrap",children:w("userDialog.onHold")}),e(Oe,{name:"status",control:R.control,render:({field:A})=>{const se=A.value;return e(Ge,{children:se?e(We,{colorScheme:"primary",isChecked:se==="on_hold",onChange:Le=>{Le.target.checked?A.onChange("on_hold"):A.onChange("active")}}):""})}})]})]}),t(D,{mb:"10px",children:[e(U,{children:w("userDialog.dataLimit")}),e(Oe,{control:R.control,name:"data_limit",render:({field:A})=>{var se;return e(tt,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:A.onChange,disabled:le,error:(se=R.formState.errors.data_limit)==null?void 0:se.message,value:A.value?String(A.value):""})}})]}),e(_r,{in:!!(X&&X>0),animateOpacity:!0,style:{width:"100%"},children:t(D,{height:"66px",children:[e(U,{children:w("userDialog.periodicUsageReset")}),e(Oe,{control:R.control,name:"data_limit_reset_strategy",render:({field:A})=>e(pe,{size:"sm",...A,disabled:le,bg:le?"gray.100":"transparent",_dark:{bg:le?"gray.600":"transparent"},sx:{option:{backgroundColor:L==="dark"?"#222C3B":"white"}},children:Dr.map(se=>e("option",{value:se.value,children:w("userDialog.resetStrategy"+se.title)},se.value))})})]})}),t(D,{mb:"10px",children:[e(U,{children:w(Y?"userDialog.onHoldExpireDuration":"userDialog.expiryDate")}),Y&&e(Oe,{control:R.control,name:"on_hold_expire_duration",render:({field:A})=>{var se;return e(tt,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Le=>{R.setValue("expire",null),A.onChange({target:{value:Le}})},disabled:le,error:(se=R.formState.errors.on_hold_expire_duration)==null?void 0:se.message,value:A.value?String(A.value):""})}}),!Y&&e(Oe,{name:"expire",control:R.control,render:({field:A})=>{var Ke;function se(nt){return ce(ce(nt*1e3).utc()).toDate()}const{status:Le,time:He}=cr(A.value);return t(Ge,{children:[e(Fn,{locale:F.language.toLocaleLowerCase(),dateFormat:w("dateFormat"),minDate:new Date,selected:A.value?se(A.value):void 0,onChange:nt=>{R.setValue("on_hold_expire_duration",null),A.onChange({target:{value:nt?ce(ce(nt).set("hour",23).set("minute",59).set("second",59)).utc().valueOf()/1e3:0,name:"expire"}})},customInput:e(tt,{size:"sm",type:"text",borderRadius:"6px",clearable:!0,disabled:le,error:(Ke=R.formState.errors.expire)==null?void 0:Ke.message})}),A.value?e(Wn,{children:w(Le,{time:He})}):""]})}})]}),t(D,{mb:"10px",isInvalid:!!R.formState.errors.note,children:[e(U,{children:w("userDialog.note")}),e(uo,{...R.register("note")}),e($e,{children:(Ze=(qe=R.formState.errors)==null?void 0:qe.note)==null?void 0:Ze.message})]})]}),d&&t(pt,{status:"error",display:{base:"none",md:"flex"},children:[e(ft,{}),d]})]})}),e(zt,{children:t(D,{isInvalid:!!((De=R.formState.errors.selected_proxies)!=null&&De.message),children:[e(U,{children:w("userDialog.protocols")}),e(Oe,{control:R.control,name:"selected_proxies",render:({field:A})=>e(bi,{list:[{title:"vmess",description:w("userDialog.vmessDesc")},{title:"vless",description:w("userDialog.vlessDesc")},{title:"trojan",description:w("userDialog.trojanDesc")},{title:"shadowsocks",description:w("userDialog.shadowsocksDesc")}],disabled:le,...A})}),e($e,{children:w((ge=R.formState.errors.selected_proxies)==null?void 0:ge.message)})]})}),e(zt,{colSpan:{base:1,md:2},children:e(_r,{in:N,style:{overflow:E},onAnimationComplete:()=>P("unset"),animateOpacity:!0,children:t(kt,{columns:{base:1,md:2},spacing:3,children:[t(St,{pt:"15px",flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[t(D,{mb:"10px",children:[e(U,{children:w("userDialog.issuedAt")}),e(Oe,{name:"sub_revoked_at",control:R.control,render:({field:A})=>e(b,{children:e(Z,{size:"sm",borderRadius:"6px",disabled:!0,value:ce.utc(A.value).local().format("YYYY-MM-DD HH:mm:ss")})})})]}),t(D,{mb:"10px",isInvalid:!!R.formState.errors.sub_url_prefix,children:[e(U,{children:w("userDialog.urlPrefix")}),e(tt,{size:"sm",type:"text",borderRadius:"6px",placeholder:"Domain (e.g. https://example.com)",disabled:le,...R.register("sub_url_prefix",{onChange:A=>c(A.target.value)})}),h&&t(p,{maxW:"300px",pt:"1",fontSize:"xs",color:"gray.500",w:"inherit",noOfLines:1,children:[h,"/sub/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"]})]})]}),e(St,{pt:"15px",flexDirection:"column",gridAutoRows:"min-content",w:"full",children:t(D,{mb:"10px",isInvalid:!!R.formState.errors.sub_url_prefix,children:[t(b,{mb:"1",children:[e(U,{mr:"0",mb:"0",children:w("clash.tag")}),t(Ee,{isLazy:!0,placement:"top",children:[e(Te,{children:e(vi,{})}),t(Ue,{w:"300px",children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:w("userDialog.tags.info")})]})]})]}),e(Oe,{name:"sub_tags",control:R.control,render:({field:A})=>e(Ui,{tags:A.value,onChange:A.onChange})})]})})]})})}),y&&k&&e(zt,{pt:6,colSpan:{base:1,md:2},children:t(B,{gap:4,children:[e(hs,{defaultValue:he,onChange:(A,se)=>{K(A),_e(se)}}),e(W,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(zr,{options:G.options,series:G.series,type:"donut"})})]})})]}),d&&t(pt,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(ft,{}),d]})]}),e(Ne,{mt:"3",children:t(b,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(b,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:y&&t(Ge,{children:[e(de,{label:w("delete"),placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",onClick:()=>{x(r),T()},children:e(mt,{})})}),e(de,{label:w("userDialog.subscription"),placement:"top",children:e(q,{"aria-label":"usage",size:"sm",onClick:()=>{P("hidden"),ie()},children:e(xi,{})})}),e(de,{label:w("userDialog.usage"),placement:"top",children:e(q,{"aria-label":"usage",size:"sm",onClick:v,children:e(Ii,{})})}),e(Q,{onClick:re,size:"sm",children:w("userDialog.resetUsage")}),e(Q,{onClick:H,size:"sm",children:w("userDialog.revokeSubscription")})]})}),e(b,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(Q,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:S?e(Pe,{size:"xs"}):void 0,disabled:le,children:w(y?"userDialog.editUser":"createUser")})})]})})]})})})]})},Ui=({tags:r,onChange:s})=>{const{proxyTags:n,onCreateProxy:o}=fe(),{onEditingSubscription:l}=$(),{t:i}=te(),a=r.split(",").filter(d=>d.length>0),x=n.reduce((d,g)=>({...d,[g.tag]:g}),{}),y=f.exports.useRef(null),[I,S]=f.exports.useState(""),C=d=>{S(d.target.value)};return t(B,{children:[e($n,{onDragEnd:d=>{if(!d.destination)return;const g=Array.from(a),[E]=g.splice(d.source.index,1);g.splice(d.destination.index,0,E),s(g.join(","))},children:e(jn,{droppableId:"droppable",children:d=>{const g=a;return t(kt,{w:"full",...d.droppableProps,ref:d.innerRef,children:[g.map((E,P)=>{const h=x[E]||{tag:E,servers:["Not Found"]},c=h.servers[0].split("->")[0].trimEnd()+(h.servers.length>1?"...":"");let u="primary";return x[E]||(u="red"),e(Bn,{index:P,draggableId:h.tag,children:w=>t(Hn,{ref:w.innerRef,...w.draggableProps,...w.dragHandleProps,w:"fit-content",size:"md",pl:"3",pr:"3",mb:"1",borderRadius:"full",variant:"solid",cursor:"default",colorScheme:u,children:[e(Vn,{boxSize:"18px",as:yi}),t(Ee,{isLazy:!0,trigger:"hover",placement:"top",children:[e(Te,{children:e(Gn,{height:"full",cursor:"default",children:t(Yn,{children:[h.tag," -> ",c]})})}),t(Ue,{w:"full",children:[e(Ae,{}),e(kt,{p:"2",spacingY:"1",pl:"3",pr:"3",w:"full",alignItems:"flex-start",color:"gray.800",_dark:{color:"whiteAlpha.900"},children:h.servers.map((F,L)=>e(p,{fontSize:"sm",children:F},L))})]})]}),e(qn,{onClick:()=>{const F=g.filter(L=>L!==E);s(F.join(","))}})]})},h.tag)}),d.placeholder]})}})}),n.length==0&&t(B,{mt:3,children:[e(p,{children:i("userDialog.noTags")}),e(ki,{onClick:()=>{l(!0),o(!0)},cursor:"pointer",boxSize:"32px",_dark:{'path[fill="#ccc"]':{fill:"primary.300"}},_light:{'path[fill="#ccc"]':{fill:"primary.500"}}})]}),n.length>0&&t(B,{w:"full",children:[t(b,{w:"full",children:[t(at,{children:[e(Tt,{height:"8",pointerEvents:"none",children:e(Ci,{})}),e(tt,{pl:10,size:"sm",borderRadius:"md",placeholder:i("search"),value:I,borderColor:"light-border",onChange:C}),e(ct,{height:"8",children:I.length>0&&e(q,{onClick:()=>S(""),"aria-label":"clear",size:"xs",variant:"ghost",children:e(Si,{})})})]}),e(W,{w:"36px"})]}),t(b,{w:"full",children:[e(pe,{ref:y,size:"sm",children:n.map(d=>{const E=a.some(h=>h===d.tag),P=I&&d.tag.toLowerCase().indexOf(I.toLowerCase())<0;return E||P?null:e("option",{value:d.tag,children:d.tag},d.tag)})}),e(q,{size:"sm","aria-label":"Add Tags",icon:e(wi,{}),onClick:()=>{const d=a,g=y.current.value;s([...d,g].join(","))}})]})]})]})},Ai=r=>f.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...r},f.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),f.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),f.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),f.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),f.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),f.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),f.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),f.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),f.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),f.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),f.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),f.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),f.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),f.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),f.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),Pi=r=>{if(!r)return null;const s=new Date(`${r}Z`);return Math.floor(s.getTime()/1e3)},cn=({lastOnline:r})=>{const s=Math.floor(Date.now()/1e3),n=Pi(r);return!r||n===null?e(W,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):s-n<=60?e(W,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(W,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Li=r=>{if(!r)return null;const s=new Date(r+"Z");return Math.floor(s.getTime()/1e3)},dn=({lastOnline:r})=>{const s=Math.floor(Date.now()/1e3),n=Li(r),o=n?s-n:null,l=n?cr(n):{status:"",time:"Not Connected Yet"};return e(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:o&&o<=60?"Online":o?`${l.time} ago`:l.time})},Fi=z(po,{baseStyle:{w:4,h:4}}),Mi=z(mo,{baseStyle:{w:4,h:4}}),hn=5;function Ni(r,s,n){if(n<hn)throw new Error(`Must allow at least ${hn} page items`);if(n%2===0)throw new Error("Must allow odd number of page items");if(r<n)return[...new Array(r).keys()];const o=Math.max(0,Math.min(r-n,s-Math.floor(n/2))),l=new Array(n);for(let i=0;i<n;i+=1)l[i]=i+o;return l[0]>0&&(l[0]=0,l[1]="prev-more"),l[l.length-1]<r-1&&(l[l.length-1]=r-1,l[l.length-2]="next-more"),l}const dr=({onChange:r,total:s,limit:n,offset:o})=>{const l=(o||0)/(n||1),i=Math.ceil(s/(n||1)),a=Ni(i,l,7),x=S=>{r(S,n)},y=S=>{r(l,parseInt(S.target.value)),Qo(S.target.value)},{t:I}=te();return t(b,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(W,{order:{base:2,md:1},children:t(b,{children:[t(pe,{minW:"60px",value:n,onChange:y,size:"sm",rounded:"md",children:[e("option",{children:"10"}),e("option",{children:"20"}),e("option",{children:"30"})]}),e(p,{whiteSpace:"nowrap",fontSize:"sm",children:I("itemsPerPage")})]})}),t(go,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(Q,{leftIcon:e(Fi,{}),onClick:x.bind(null,l-1),isDisabled:l===0||i===0,children:I("previous")}),a.map(S=>typeof S=="string"?e(Q,{children:"..."},S):e(Q,{variant:S===l?"solid":"outline",onClick:x.bind(null,S),children:S+1},S)),e(Q,{rightIcon:e(Mi,{}),onClick:x.bind(null,l+1),isDisabled:l+1===i||i===0,children:I("next")})]})]})},yr=({expiryDate:r,status:s,compact:n=!1,showDetail:o=!0,extraText:l})=>{const{t:i}=te(),a=cr(r),x=Ct[s].icon;return t(Ge,{children:[t(ee,{colorScheme:Ct[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:n?1:2,alignItems:"center",children:[e(x,{w:n?3:4}),o&&t(p,{textTransform:"capitalize",fontSize:n?".7rem":".875rem",lineHeight:n?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&i(`status.${s}`),l&&`: ${l}`]})]}),o&&r&&e(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},Oi=z(Ai),Pt={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Wi=z(fo,Pt),$i=z(Zn,Pt),un=z(Qn,Pt),ji=z(ar,Pt),Bi=z(Wr,Pt),Hi=z(At,Pt),Vi=z(Zn,{baseStyle:{width:"15px",height:"15px"}}),Gi=r=>{for(var s=0;s<Dr.length;s++){const n=Dr[s];if(n.value==r)return n.title}return"No"},Yi=r=>{const{used:s,total:n,dataLimitResetStrategy:o,totalUsedTraffic:l}=r,i=n===0||n===null;return e(b,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t(p,{children:[Fe(s)," /"," ",i?e(p,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Fe(n)]})})},pn=r=>{const{used:s,total:n,dataLimitResetStrategy:o,totalUsedTraffic:l,...i}=r,a=n===0||n===null,x=!a&&s/n*100>=100;return t(Ge,{children:[e(bo,{orientation:"horizontal",value:a?100:Math.min(s/n*100,100),colorScheme:x?"red":"primary",...i,children:e(xo,{h:"6px",borderRadius:"full",children:e(yo,{borderRadius:"full"})})}),t(b,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[t(p,{children:[Fe(s)," /"," ",a?e(p,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Fe(n)+(o&&o!=="no_reset"?" "+Ie("userDialog.resetStrategy"+Gi(o)):"")]}),t(p,{children:[Ie("usersTable.total"),": ",Fe(l)]})]})]})},Re=({sort:r,column:s})=>r.includes(s)?e(Vi,{transform:r.startsWith("-")?void 0:"rotate(180deg)"}):null,qi=r=>{const{filters:s,users:{users:n},users:o,onEditingUser:l,onFilterChange:i}=$(),{t:a}=te(),[x,y]=f.exports.useState(void 0),I=wt({base:120,lg:72})||72,[S,C]=f.exports.useState(`${I}px`),d=wt({base:!1,md:!0});f.exports.useEffect(()=>{const c=()=>{const u=document.querySelectorAll("#filters")[0];C(`${u.offsetHeight}px`)};window.addEventListener("scroll",c)},[]);const g=n.length!==o.total,E=c=>{let u=s.sort;u.includes(c)?u.startsWith("-")?u="-created_at":u="-"+c:u=c,i({sort:u})},P=c=>{i({status:c.target.value.length>0?c.target.value:void 0})},h=c=>{y(c===x?void 0:c)};return t(W,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(xt,{allowMultiple:!0,display:{base:"block",md:"none"},index:x,children:t(Bt,{orientation:"vertical",zIndex:"docked",...r,children:[e(Ht,{zIndex:"docked",position:"relative",children:t(Ve,{children:[e(ue,{position:"sticky",top:S,minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:E.bind(null,"username"),children:t(b,{children:[e("span",{children:a("users")}),e(Re,{sort:s.sort,column:"username"})]})}),e(ue,{position:"sticky",top:S,minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:t(b,{spacing:0,position:"relative",children:[t(p,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[a("usersTable.status"),s.status?": "+s.status:""]}),t(pe,{value:s.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Ge,{}),_focusVisible:{border:"0 !important"},onChange:P,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(ue,{position:"sticky",top:S,minW:"100px",cursor:"pointer",pr:0,onClick:E.bind(null,"used_traffic"),children:t(b,{children:[e("span",{children:a("usersTable.dataUsage")}),e(Re,{sort:s.sort,column:"used_traffic"})]})}),e(ue,{position:"sticky",top:S,minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(Vt,{children:!d&&(n==null?void 0:n.map((c,u)=>t(f.exports.Fragment,{children:[t(Ve,{onClick:h.bind(null,u),cursor:"pointer",children:[e(ae,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:t("div",{className:"flex-status",children:[e(cn,{lastOnline:c.online_at}),e(p,{isTruncated:!0,children:c.username})]})}),e(ae,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(yr,{compact:!0,showDetail:!1,expiryDate:c.expire,status:c.status})}),e(ae,{borderBottom:0,minW:"100px",pr:0,children:e(Yi,{totalUsedTraffic:c.lifetime_used_traffic,dataLimitResetStrategy:c.data_limit_reset_strategy,used:c.used_traffic,total:c.data_limit,colorScheme:Ct[c.status].bandWidthColor})}),e(ae,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e($i,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:x===u?"rotate(180deg)":"0deg"})})]}),e(Ve,{className:"collapsible",onClick:h.bind(null,u),children:e(ae,{p:0,colSpan:4,children:t(dt,{border:0,children:[e(ht,{display:"none"}),e(ut,{border:0,cursor:"pointer",px:6,py:3,children:t(B,{justifyContent:"space-between",spacing:"4",children:[t(B,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(p,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:a("usersTable.dataUsage")}),e(W,{width:"full",minW:"230px",children:e(pn,{totalUsedTraffic:c.lifetime_used_traffic,dataLimitResetStrategy:c.data_limit_reset_strategy,used:c.used_traffic,total:c.data_limit,colorScheme:Ct[c.status].bandWidthColor})})]}),t(b,{w:"full",justifyContent:"space-between",children:[t(W,{width:"full",children:[e(yr,{compact:!0,expiryDate:c.expire,status:c.status}),e(dn,{lastOnline:c.online_at})]}),t(b,{children:[e(mn,{user:c}),e(de,{label:a("userDialog.editUser"),placement:"top",children:e(q,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:w=>{w.stopPropagation(),l(c)},children:e(Hi,{})})})]})]})]})})]})})})]},c.username)))})]})}),t(Bt,{orientation:"vertical",display:{base:"none",md:"table"},...r,children:[e(Ht,{zIndex:"docked",position:"relative",children:t(Ve,{children:[e(ue,{position:"sticky",top:{base:"unset",md:S},minW:"140px",cursor:"pointer",onClick:E.bind(null,"username"),children:t(b,{children:[e("span",{children:a("username")}),e(Re,{sort:s.sort,column:"username"})]})}),e(ue,{position:"sticky",top:{base:"unset",md:S},width:"400px",minW:"150px",cursor:"pointer",children:t(b,{position:"relative",gap:"5px",children:[t(p,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[a("usersTable.status"),s.status?": "+s.status:""]}),e(p,{children:"/"}),e(Re,{sort:s.sort,column:"expire"}),e(b,{onClick:E.bind(null,"expire"),children:e(p,{children:a("usersTable.sortByExpire")})}),t(pe,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Ge,{}),_focusVisible:{border:"0 !important"},value:s.sort,onChange:P,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(ue,{position:"sticky",top:{base:"unset",md:S},width:"350px",minW:"230px",cursor:"pointer",onClick:E.bind(null,"used_traffic"),children:t(b,{children:[e("span",{children:a("usersTable.dataUsage")}),e(Re,{sort:s.sort,column:"used_traffic"})]})}),e(ue,{position:"sticky",top:{base:"unset",md:S},width:"200px",minW:"180px"})]})}),t(Vt,{children:[d&&(n==null?void 0:n.map((c,u)=>t(Ve,{className:Xe("interactive",{"last-row":u===n.length-1}),onClick:()=>l(c),children:[e(ae,{minW:"140px",children:t("div",{className:"flex-status",children:[e(cn,{lastOnline:c.online_at}),c.username,e(dn,{lastOnline:c.online_at})]})}),e(ae,{width:"400px",minW:"150px",children:e(yr,{expiryDate:c.expire,status:c.status})}),e(ae,{width:"350px",minW:"230px",children:e(pn,{totalUsedTraffic:c.lifetime_used_traffic,dataLimitResetStrategy:c.data_limit_reset_strategy,used:c.used_traffic,total:c.data_limit,colorScheme:Ct[c.status].bandWidthColor})}),e(ae,{width:"200px",minW:"180px",children:e(mn,{user:c})})]},c.username))),n.length==0&&e(Ve,{children:e(ae,{colSpan:4,children:e(Zi,{isFiltered:g})})})]})]}),e(dr,{onChange:(c,u)=>{i({...s,limit:u,offset:c*u})},total:o.total,limit:s.limit,offset:s.offset})]})},mn=({user:r})=>{const{setQRCode:s,setSubLink:n}=$(),o=r.links.join(`\r
`),[l,i]=f.exports.useState([-1,!1]);return f.exports.useEffect(()=>{l[1]&&setTimeout(()=>{i([-1,!1])},1e3)},[l]),t(b,{justifyContent:"flex-end",onClick:a=>{a.preventDefault(),a.stopPropagation()},children:[e(Xr,{text:r.subscription_url.startsWith("/")?window.location.origin+r.subscription_url:r.subscription_url,onCopy:()=>{i([0,!0])},children:e("div",{children:e(de,{label:l[0]==0&&l[1]?Ie("usersTable.copied"):Ie("usersTable.copyLink"),placement:"top",children:e(q,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:l[0]==0&&l[1]?e(un,{}):e(ji,{})})})})}),e(Xr,{text:o,onCopy:()=>{i([1,!0])},children:e("div",{children:e(de,{label:l[0]==1&&l[1]?Ie("usersTable.copied"):Ie("usersTable.copyConfigs"),placement:"top",children:e(q,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:l[0]==1&&l[1]?e(un,{}):e(Wi,{})})})})}),e(de,{label:"QR Code",placement:"top",children:e(q,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{s(r.links),n(r.subscription_url)},children:e(Bi,{})})})]})},Zi=({isFiltered:r})=>{const{onCreateUser:s}=$();return t(W,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(Oi,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(p,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:r?Ie("usersTable.noUserMatched"):Ie("usersTable.noUser")}),!r&&e(Q,{size:"sm",colorScheme:"primary",onClick:()=>s(!0),children:Ie("createUser")})]})},hr=r=>{if(typeof r=="string")try{r=JSON.parse(r)}catch{}return r},us={baseStyle:{w:5,h:5}},Qi=z(Qt,us),Xi=z(At,us),Ji=_.object({name:_.string().min(1,{message:"fieldRequired"}),server:_.string().min(1,{message:"fieldRequired"}),port:_.string().min(1,{message:"fieldRequired"}),tag:_.string().min(1,{message:"fieldRequired"}),inbound:_.string().min(1,{message:"fieldRequired"}),settings:_.record(_.string(),_.any())}),Ki=r=>({...r}),Sr=()=>({id:0,name:"",server:"",inbound:"",tag:"",port:"",settings:{icon:"",hidden:!1,trojan:{security:"tls",fingerprint:"chrome",udp:!0,alpn:"",sni:"",allow_insecure:!1},vless:{security:"tls",fingerprint:"chrome",servername:"",alpn:"",udp:!0,allow_insecure:!1},vmess:{security:"tls",fingerprint:"chrome",servername:"",alpn:"",udp:!0,allow_insecure:!1,ws_opts_path:"",ws_opts_host:""},shadowsocks:{udp:!0}}}),ea=()=>{var oe,he,K,_e,M;const{proxyInbounds:r,editingProxy:s,isCreatingProxy:n,duplicatingProxy:o,onEditingProxy:l,onDuplicatingProxy:i,onCreateProxy:a,deleteProxy:x,editProxy:y,createProxy:I,onAlert:S}=fe(),C=!!s,d=n||C,g=C?"clash.proxy.edited":"clash.proxy.created",[E,P]=f.exports.useState(!1),[h,c]=f.exports.useState(null),[u,w]=f.exports.useState(""),[F,L]=f.exports.useState(""),k=Me(),{t:m}=te(),v=rt({defaultValues:Sr(),resolver:bt(Ji)}),N=T=>r.find(re=>re.name===T)||null,ie=T=>{if(T){const re=N(T.inbound);v.reset(Ki(T)),c(re),w(T.port)}else v.reset(Sr()),c(null),w("")};f.exports.useEffect(()=>{s&&ie(s)},[s,r]),f.exports.useEffect(()=>{n&&ie(o||null)},[n,r]);const J=(T,re)=>{Object.keys(T).map(H=>{re[H]===void 0&&delete T[H]})},R=T=>{P(!0),L(null);const re=Sr().settings;let H={};T.settings.icon&&(H.icon=T.settings.icon),H.hidden=T.settings.hidden,(h==null?void 0:h.type)=="trojan"?(H.trojan=T.settings.trojan,J(H.trojan,re.trojan)):(h==null?void 0:h.type)=="vless"?(H.vless=T.settings.vless,J(H.vless,re.vless)):(h==null?void 0:h.type)=="vmess"?(H.vmess=T.settings.vmess,J(H.vmess,re.vmess)):(h==null?void 0:h.type)=="shadowsocks"&&(H.shadowsocks=T.settings.shadowsocks,J(H.shadowsocks,re.shadowsocks));const{...le}=T;let Y={...le,id:s==null?void 0:s.id,settings:H};(C?y:I)(Y).then(()=>{k({title:m(g,{name:T.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),X()}).catch(ne=>{var ze,Be,Ye,qe,Ze,De;if(((ze=ne==null?void 0:ne.response)==null?void 0:ze.status)===409||((Be=ne==null?void 0:ne.response)==null?void 0:Be.status)===400||((Ye=ne==null?void 0:ne.response)==null?void 0:Ye.status)===404){let ge=(Ze=(qe=ne==null?void 0:ne.response)==null?void 0:qe._data)==null?void 0:Ze.detail;ge.err&&(ge=m(`error.${ge.err}`)),L(ge)}((De=ne==null?void 0:ne.response)==null?void 0:De.status)===422&&Object.keys(ne.response._data.detail).forEach(ge=>{let A=hr(ne.response._data.detail[ge]),se=A;A.err&&(se=`error.${A.err}`,A=m(se)),L(A),v.setError(ge,{type:"custom",message:se})})}).finally(()=>{P(!1)})},X=()=>{ie(null),a(!1),l(null),i(null),L(null),S(null)},j=()=>{let T={};T.title="clash.proxy.delete",T.prompt="clash.proxy.deletePrompt",T.yes="delete",T.success="clash.proxy.deleteSuccess",S({title:m(T.title),content:m(T.prompt,{name:s==null?void 0:s.name}),type:"error",yes:m(T.yes),onConfirm:()=>{x(s).then(()=>{k({title:m(T.success,{name:s==null?void 0:s.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),X()}).catch(re=>{k({title:m("clash.proxy.deleteFail",{name:s==null?void 0:s.name}),status:"warning",isClosable:!0,position:"top",duration:3e3}),X()})}})},O=T=>T&&m(T),G=E;return t(xe,{isOpen:d,onClose:X,size:"lg",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Ut,{...v,children:e(Se,{mx:"3",children:t("form",{onSubmit:v.handleSubmit(R),children:[e(we,{pt:6,children:t(b,{gap:2,children:[e(ve,{color:"primary",children:C?e(Xi,{color:"white"}):e(Qi,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:m(C?"clash.proxy.edit":"clash.proxy.add")})]})}),e(Ce,{mt:3,disabled:G}),e(ke,{children:t(B,{children:[e(b,{w:"full",children:t(D,{isInvalid:!!v.formState.errors.name,children:[t(b,{mb:"1",children:[e(U,{mr:"0",mb:"0",children:m("clash.name")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(sr,{})}),t(Ue,{children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:m("clash.proxy.uniqueInfo")})]})]})]}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:(h==null?void 0:h.name)||"us bwh|01",disabled:G,...v.register("name")}),e($e,{children:O((oe=v.formState.errors.name)==null?void 0:oe.message)})]})}),t(b,{w:"full",alignItems:"baseline",children:[t(D,{isInvalid:!!v.formState.errors.server,children:[e(U,{children:m("clash.server")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:(h==null?void 0:h.server)||"bwh-aws.example.com",disabled:G,...v.register("server")}),e($e,{children:O((he=v.formState.errors.server)==null?void 0:he.message)})]}),t(D,{w:"50%",isInvalid:!!v.formState.errors.port,children:[e(U,{children:m("clash.port")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:(h==null?void 0:h.port)||"1080 | 1080:1081",disabled:G,...v.register("port",{onChange:T=>w(T.target.value)})}),e($e,{children:O((K=v.formState.errors.port)==null?void 0:K.message)})]})]}),t(b,{w:"full",alignItems:"baseline",children:[t(D,{isInvalid:!!v.formState.errors.inbound,children:[e(U,{children:m("clash.inbound")}),e(pe,{disabled:G,size:"sm",placeholder:"Select inbound",...v.register("inbound",{onChange:T=>{const re=N(T.target.value),H=v.getValues();re.type=="trojan"&&v.setValue("settings.trojan.security","tls"),(!H.name||(h==null?void 0:h.name)==H.name)&&v.setValue("name",re.name),(!H.server||(h==null?void 0:h.server)==H.server)&&v.setValue("server",re.server),(!H.port||(h==null?void 0:h.port)==H.port)&&v.setValue("port",re.port),v.clearErrors("port"),v.clearErrors("inbound"),c(re)}}),children:r.map(T=>e("option",{value:T.name,children:T.name},T.name))}),e($e,{children:O((_e=v.formState.errors.inbound)==null?void 0:_e.message)})]}),t(D,{isInvalid:!!v.formState.errors.tag,children:[e(b,{mb:"1",children:e(U,{mr:"0",mb:"0",children:m("clash.tag")})}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:"bwh-aws",disabled:G,...v.register("tag")}),e($e,{children:O((M=v.formState.errors.tag)==null?void 0:M.message)})]})]}),t(b,{w:"full",children:[t(St,{w:"full",flexDirection:"column",gap:"1",children:[e(p,{fontSize:"sm",children:m("clash.type")}),e(Z,{size:"sm",borderRadius:"6px",disabled:!0,value:(h==null?void 0:h.type)||""})]}),t(St,{w:"full",flexDirection:"column",gap:"1",children:[e(p,{fontSize:"sm",children:m("clash.proxy.network")}),e(Z,{size:"sm",borderRadius:"6px",disabled:!0,value:(h==null?void 0:h.network)||""})]}),h&&h.type!="shadowsocks"&&t(D,{w:"full",children:[e(U,{children:m("clash.proxy.security")}),h.security=="none"&&t(pe,{disabled:G,size:"sm",placeholder:"Select security",...v.register(`settings.${h.type}.security`),children:[e("option",{value:"none",children:"none"},"none"),e("option",{value:"tls",children:"tls"},"tls")]}),h.security!="none"&&e(Z,{size:"sm",borderRadius:"6px",disabled:!0,value:h==null?void 0:h.security})]})]}),e(xt,{w:"full",allowToggle:!0,children:t(dt,{border:"0",children:[e(ht,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:t(b,{pt:"4",pb:"2",w:"full",children:[e(Et,{}),t(p,{whiteSpace:"nowrap",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[m("clash.advanceOption"),e(Dt,{fontSize:"sm",ml:1})]}),e(Et,{})]})}),e(ut,{w:"full",p:1,children:t(B,{w:"full",children:[e(b,{pt:1,w:"full",gap:"4",children:t(D,{w:"fit-content",display:"flex",alignItems:"center",children:[t(U,{mb:"0",children:[m("clash.hidden"),t(Ee,{isLazy:!0,trigger:"hover",placement:"right",children:[e(Te,{children:e(sr,{display:"inline-block"})}),t(Ue,{children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:m("clash.proxy.hiddenInfo")})]})]})]}),e(We,{colorScheme:"primary",...v.register("settings.hidden")})]})}),u.indexOf(":")>0&&t(D,{children:[e(U,{children:m("clash.icon")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...v.register("settings.icon")})]}),h&&h.type!="shadowsocks"&&t(B,{w:"full",children:[h.type=="trojan"&&t(D,{children:[e(U,{children:"SNI"}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...v.register(`settings.${h.type}.sni`)})]}),(h.type=="vmess"||h.type=="vless")&&t(D,{children:[e(U,{children:m("clash.proxy.serverName")}),h.security=="reality"&&e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:!0,value:h.servername}),h.security!="reality"&&e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...v.register(`settings.${h.type}.servername`)}),h.type=="vmess"&&h.network=="ws"&&t(b,{w:"full",paddingTop:"8px",children:[t(D,{children:[e(U,{children:m("clash.proxy.host")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...v.register("settings.vmess.ws_opts_host")})]}),t(D,{w:"50%",children:[e(U,{children:m("clash.proxy.path")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...v.register("settings.vmess.ws_opts_path")})]})]})]}),t(b,{w:"full",children:[t(D,{children:[e(U,{children:"ALPN"}),e(pe,{disabled:G,size:"sm",...v.register(`settings.${h.type}.alpn`),children:as.map(T=>e("option",{value:T.value,children:T.title},T.value))})]}),t(D,{children:[e(U,{children:m("clash.proxy.fingerprint")}),e(pe,{disabled:G,size:"sm",...v.register(`settings.${h.type}.fingerprint`),children:cs.map(T=>e("option",{value:T.value,children:T.title},T.value))})]})]}),t(b,{pt:1,w:"full",gap:"4",children:[t(D,{w:"fit-content",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:"UDP"}),e(We,{colorScheme:"primary",...v.register(`settings.${h.type}.udp`)})]}),t(D,{w:"fit-content",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:m("clash.proxy.allowInsecure")}),e(We,{colorScheme:"primary",...v.register(`settings.${h.type}.allow_insecure`)})]})]})]}),(h==null?void 0:h.type)=="shadowsocks"&&e(b,{pt:1,w:"full",gap:"4",children:t(D,{w:"fit-content",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:"UDP"}),e(We,{colorScheme:"primary",...v.register(`settings.${h.type}.udp`)})]})})]})})]})}),F&&t(pt,{status:"error",children:[e(ft,{}),F]})]})}),e(Ne,{children:t(b,{justifyContent:"space-between",w:"full",gap:3,children:[C&&t(b,{spacing:2,pr:10,children:[e(de,{label:m("delete"),placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",onClick:j,children:e(mt,{})})}),e(de,{label:m("clash.duplicate"),placement:"top",children:e(q,{"aria-label":"duplicate proxy",size:"sm",onClick:()=>i(s),children:e(gs,{})})})]}),t(b,{w:"full",justifyItems:"flex-end",children:[e(Q,{onClick:X,size:"sm",variant:"outline",w:"full",disabled:G,children:m("cancel")}),e(Q,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:E?e(Pe,{size:"xs"}):void 0,w:"full",isDisabled:G||!v.formState.isDirty,children:m(C?"clash.update":"clash.create")})]})]})})]})})})]})},gn=["select","load-balance","relay","url-test","fallback"],ta=["consistent-hashing","round-robin"],ra=_.object({name:_.string().min(1,{message:"fieldRequired"}),tag:_.string().min(1,{message:"fieldRequired"}),type:_.string().min(1,{message:"fieldRequired"}),selected_proxies:_.array(_.string()),settings:_.record(_.string(),_.any())}),wr=()=>({id:0,name:"",tag:"",type:"select",builtin:!1,proxies:"",selected_proxies:[],settings:{relay:{},url_test:{tolerance:150,lazy:!0,url:"http://cp.cloudflare.com/generate_204",interval:300},fallback:{url:"http://cp.cloudflare.com/generate_204",interval:300},load_balance:{strategy:"consistent-hashing",url:"http://cp.cloudflare.com/generate_204",interval:300},select:{disable_udp:!0,filter:""}}}),fn=r=>({...r,selected_proxies:r.proxies.split(",").filter(s=>s.length>0)}),na=()=>{var he,K,_e;const{editingProxyGroup:r,duplicatingProxyGroup:s,isCreatingProxyGroup:n,onEditingProxyGroup:o,onCreateProxyGroup:l,onDuplicatingProxyGroup:i,deleteProxyGroup:a,editProxyGroup:x,createProxyGroup:y,onAlert:I,proxyBriefs:S}=fe(),C=!!r,d=n||C,g=C?"clash.proxyGroup.edited":"clash.proxyGroup.created",[E,P]=f.exports.useState(!1),[h,c]=f.exports.useState(""),[u,w]=f.exports.useState(""),F=f.exports.useRef(null),L=Me(),{t:k}=te(),m=rt({defaultValues:wr(),resolver:bt(ra)}),v=S.reduce((M,T)=>({...M,[T.id]:T}),{});f.exports.useEffect(()=>{r&&(m.reset(fn(r)),w(r.type))},[r]),f.exports.useEffect(()=>{n&&(s?(m.reset(fn(s)),w(s.type)):(m.reset(wr()),w(gn[0])))},[n]);const[N,ie]=f.exports.useState(""),J=M=>{ie(M.target.value)},R=()=>{ie("")},X=M=>{P(!0),c(null);const{selected_proxies:T,...re}=M;let H={};H.icon=M.settings.icon,M.type=="select"?H.select=M.settings.select:M.type=="url-test"?H.url_test=M.settings.url_test:M.type=="fallback"?H.fallback=M.settings.fallback:M.type=="load-balance"&&(H.load_balance=M.settings.load_balance);let le={...re,id:r==null?void 0:r.id,builtin:(r==null?void 0:r.builtin)||!1,proxies:T.join(","),settings:H};(C?x:y)(le).then(()=>{L({title:k(g,{name:M.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),j()}).catch(Y=>{var ne,ze,Be,Ye,qe,Ze;if(((ne=Y==null?void 0:Y.response)==null?void 0:ne.status)===409||((ze=Y==null?void 0:Y.response)==null?void 0:ze.status)===400||((Be=Y==null?void 0:Y.response)==null?void 0:Be.status)===404){let De=(qe=(Ye=Y==null?void 0:Y.response)==null?void 0:Ye._data)==null?void 0:qe.detail;De.err&&(De=k(`error.${De.err}`)),c(De)}((Ze=Y==null?void 0:Y.response)==null?void 0:Ze.status)===422&&Object.keys(Y.response._data.detail).forEach(De=>{let ge=hr(Y.response._data.detail[De]),A=ge;ge.err&&(A=`error.${ge.err}`,ge=k(A)),c(ge),m.setError(De,{type:"custom",message:A})})}).finally(()=>{P(!1)})},j=()=>{m.reset(wr()),l(!1),o(null),i(null),c(null),P(!1),I(null),R()},O=()=>{I({title:k("clash.proxyGroup.delete"),content:k("clash.proxyGroup.deletePrompt",{name:r==null?void 0:r.name}),type:"error",yes:k("delete"),onConfirm:()=>{a(r).then(()=>{L({title:k("clash.proxyGroup.deleteSuccess",{name:r==null?void 0:r.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),j()}).catch(M=>{L({title:k("clash.proxyGroup.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{I(null)})}})},G=M=>M&&k(M),oe=E;return t(xe,{isOpen:d,onClose:j,size:"md",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Ut,{...m,children:e(Se,{mx:"3",children:t("form",{onSubmit:m.handleSubmit(X),children:[e(we,{pt:6,children:t(b,{gap:2,children:[e(ve,{color:"primary",children:C?e(ps,{color:"white"}):e(nr,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:k(C?"clash.proxyGroup.edit":"clash.proxyGroup.add")})]})}),e(Ce,{mt:3,disabled:oe}),e(ke,{children:t(B,{justifyContent:"space-between",children:[e(b,{w:"full",children:t(D,{isInvalid:!!m.formState.errors.name,children:[t(b,{mb:"1",children:[e(U,{mr:"0",mb:"0",children:k("clash.name")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(sr,{})}),t(Ue,{children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:k("clash.proxyGroup.uniqueInfo")})]})]})]}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:oe,...m.register("name")}),e($e,{children:G((he=m.formState.errors.name)==null?void 0:he.message)})]})}),t(b,{w:"full",alignItems:"baseline",children:[t(D,{w:"60%",children:[e(U,{children:k("clash.type")}),e(pe,{disabled:oe||(r==null?void 0:r.builtin),size:"sm",...m.register("type",{onChange:M=>w(M.target.value)}),children:gn.map(M=>e("option",{value:M,children:M},M))}),e($e,{children:G((K=m.formState.errors.type)==null?void 0:K.message)})]}),t(D,{isInvalid:!!m.formState.errors.tag,children:[e(U,{children:k("clash.tag")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:oe||(r==null?void 0:r.builtin),...m.register("tag")}),e($e,{children:G((_e=m.formState.errors.tag)==null?void 0:_e.message)})]})]}),t(D,{pt:"2",children:[t(b,{mb:"1",children:[e(U,{mr:"0",mb:"0",children:k("clash.proxies")}),t(Ee,{isLazy:!0,placement:"right",children:[e(Te,{children:e(sr,{})}),t(Ue,{children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:k("clash.proxyGroup.proxiesInfo")})]})]})]}),t(B,{w:"full",children:[e($n,{onDragEnd:M=>{if(!M.destination)return;const T=Array.from(m.getValues().selected_proxies),[re]=T.splice(M.source.index,1);T.splice(M.destination.index,0,re),m.setValue("selected_proxies",T,{shouldDirty:!0})},children:e(jn,{droppableId:"droppable",children:M=>t(kt,{w:"full",...M.droppableProps,ref:M.innerRef,children:[m.getValues().selected_proxies.map((T,re)=>{const H=v[T]||{id:T,name:`(${T})`,server:"Not Found",tag:"<Not Found>",builtin:!1};let le="primary";return v[T]?H.id.startsWith("#")?le="green":H.id!=="..."&&(le="purple"):le="red",e(Bn,{index:re,draggableId:H.id,isDragDisabled:r==null?void 0:r.builtin,children:Y=>t(Hn,{ref:Y.innerRef,...Y.draggableProps,...Y.dragHandleProps,pl:"3",pr:"3",mb:"1",w:"fit-content",size:"md",borderRadius:"full",variant:"solid",cursor:"default",colorScheme:le,children:[!(r!=null&&r.builtin)&&e(Vn,{boxSize:"18px",as:pa}),t(Ee,{isLazy:!0,trigger:"hover",placement:"top",children:[e(Te,{children:e(Gn,{height:"full",cursor:"default",children:t(Yn,{children:[H.name," -> ",H.tag]})})}),!!H.server&&t(Ue,{w:"full",children:[e(Ae,{}),e(p,{p:"2",pl:"3",pr:"3",color:"gray.800",_dark:{color:"whiteAlpha.900"},children:H.server})]})]}),!(r!=null&&r.builtin)&&e(qn,{onClick:()=>{const ze=m.getValues().selected_proxies.filter(Be=>Be!==T);m.setValue("selected_proxies",ze,{shouldDirty:!0,shouldValidate:!0})}})]})},H.id)}),M.placeholder]})})}),t(B,{w:"full",children:[t(b,{w:"full",children:[t(at,{children:[e(Tt,{height:"8",pointerEvents:"none",children:e(q,{"aria-label":"clear",size:"xs",bgColor:"unset",isDisabled:oe||(r==null?void 0:r.builtin),children:e(ur,{})})}),e(Z,{disabled:oe||(r==null?void 0:r.builtin),size:"sm",borderRadius:"md",placeholder:k("search"),value:N,borderColor:"light-border",onChange:J}),t(ct,{height:"8",children:[E&&e(Pe,{size:"xs"}),N.length>0&&e(q,{onClick:R,"aria-label":"clear",size:"xs",variant:"ghost",children:e(pr,{})})]})]}),e(W,{w:"36px"})]}),t(b,{w:"full",children:[e(pe,{ref:F,disabled:oe||(r==null?void 0:r.builtin),size:"sm",children:S.map(M=>{const re=m.getValues().selected_proxies.some(ne=>M.id===ne),H=`#${r==null?void 0:r.id}`,le=`${M.name} -> ${M.tag}`,Y=N&&le.toLowerCase().indexOf(N.toLowerCase())<0;return re||M.id==H||Y?null:e("option",{value:M.id,children:le},M.id)})}),e(q,{size:"sm","aria-label":"Add Proxy",isDisabled:oe||(r==null?void 0:r.builtin),icon:e(nr,{}),onClick:()=>{const M=m.getValues().selected_proxies,T=F.current.value,re=v[T];M.some(le=>{var Y;return re.name===((Y=v[le])==null?void 0:Y.name)})?L({title:k("clash.proxy.exists",{name:v[T].name}),status:"error",isClosable:!0,position:"top",duration:3e3}):(m.clearErrors("proxies"),m.setValue("selected_proxies",[...M,T],{shouldDirty:!0}))}})]})]})]})]}),e(xt,{w:"full",allowToggle:!0,children:t(dt,{border:"0",children:[e(ht,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:t(b,{pt:"4",pb:"2",w:"full",children:[e(Et,{}),t(p,{whiteSpace:"nowrap",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[k("clash.advanceOption"),e(Dt,{fontSize:"sm",ml:1})]}),e(Et,{})]})}),e(ut,{w:"full",p:1,children:t(B,{w:"full",children:[e(b,{pt:1,w:"full",gap:"4",children:t(D,{w:"fit-content",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:k("clash.hidden")}),e(We,{colorScheme:"primary",...m.register("settings.hidden")})]})}),t(D,{children:[e(U,{children:k("clash.icon")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:oe,...m.register("settings.icon")})]}),u=="load-balance"&&t(B,{w:"full",children:[t(D,{children:[e(U,{children:k("clash.strategy")}),e(pe,{size:"sm",...m.register("settings.load_balance.strategy"),children:ta.map(M=>e("option",{value:M,children:M},M))})]}),t(D,{children:[e(U,{children:k("clash.url")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...m.register("settings.load_balance.url")})]}),t(D,{children:[e(U,{children:k("clash.interval")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...m.register("settings.load_balance.interval")})]})]}),u=="url-test"&&t(B,{w:"full",children:[t(D,{children:[e(U,{children:k("clash.url")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...m.register("settings.url_test.url")})]}),t(D,{children:[e(U,{children:k("clash.interval")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...m.register("settings.url_test.interval")})]}),t(D,{children:[e(U,{children:k("clash.tolerance")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...m.register("settings.url_test.tolerance")})]}),t(D,{pt:"1",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:"lazy"}),e(We,{colorScheme:"primary",...m.register("settings.url_test.lazy")})]})]}),u=="fallback"&&t(B,{w:"full",children:[t(D,{children:[e(U,{children:k("clash.url")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...m.register("settings.fallback.url")})]}),t(D,{children:[e(U,{children:k("clash.interval")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...m.register("settings.fallback.interval")})]})]}),u=="select"&&t(B,{w:"full",children:[t(D,{children:[e(U,{children:k("clash.filter")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:r==null?void 0:r.builtin,...m.register("settings.select.filter")})]}),t(D,{pt:2,display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:"disable-udp"}),e(We,{colorScheme:"primary",disabled:r==null?void 0:r.builtin,...m.register("settings.select.disable_udp")})]})]})]})})]})}),h&&t(pt,{status:"error",children:[e(ft,{}),h]})]})}),e(Ne,{children:t(b,{justifyContent:"space-between",w:"full",gap:3,children:[C&&t(b,{spacing:2,pr:5,children:[e(de,{isDisabled:r.builtin,label:k("delete"),placement:"top",children:e(q,{isDisabled:r.builtin,"aria-label":"Delete",size:"sm",onClick:O,children:e(mt,{})})}),e(de,{isDisabled:r.builtin,label:k("clash.duplicate"),placement:"top",children:e(q,{isDisabled:r.builtin,"aria-label":"Duplicate proxy group",size:"sm",onClick:()=>i(r),children:e(gs,{})})})]}),t(b,{w:"full",justifyItems:"flex-end",children:[e(Q,{onClick:j,size:"sm",variant:"outline",w:"full",disabled:oe,children:k("cancel")}),e(Q,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:E?e(Pe,{size:"xs"}):void 0,w:"full",isDisabled:oe||!m.formState.isDirty,children:k(C?"clash.update":"clash.create")})]})]})})]})})})]})},Er=[{name:"DOMAIN",example:"www.google.com"},{name:"DOMAIN-SUFFIX",example:"google.com"},{name:"DOMAIN-KEYWORD",example:"google"},{name:"GEOIP",noResolve:!0,example:"cn"},{name:"GEOSITE",message:"clash.rule.supportGEOSITE",example:"google"},{name:"IP-CIDR",noResolve:!0,example:"127.0.0.0/8"},{name:"IP-CIDR6",noResolve:!0,example:"2620:0:2d0:200::7/32"},{name:"RULE-SET",example:"providername"},{name:"SRC-IP-CIDR",example:"192.168.1.201/32"},{name:"SRC-PORT",example:"80"},{name:"DST-PORT",example:"8080"},{name:"PROCESS-NAME",example:"onedrive"},{name:"PROCESS-PATH",example:"/usr/bin/curl"},{name:"NETWORK",message:"clash.rule.supportNETWORK",example:"tcp udp"},{name:"SCRIPT",message:"clash.rule.supportSCRIPT",example:"script shortcut"},{name:"AND",message:"clash.rule.supportLOGIC",example:"((DOMAIN,google.com),(NETWORK,UDP))"},{name:"OR",message:"clash.rule.supportLOGIC",example:"((NETWORK,UDP),(DOMAIN,google.com))"},{name:"NOT",message:"clash.rule.supportLOGIC",example:"((DOMAIN,google.com))"}],sa=_.object({content:_.string().min(1,{message:"fieldRequired"}),type:_.string().min(1,{message:"fieldRequired"}),ruleset:_.string().min(1,{message:"fieldRequired"}),policy:_.string(),priority:_.boolean(),no_resolve:_.boolean()}),Cr=r=>({id:0,type:"DOMAIN-SUFFIX",content:"",option:"",policy:"",priority:!1,no_resolve:!1,ruleset:r||"DIRECT"}),oa=r=>{var s;return{...r,no_resolve:((s=r.option)==null?void 0:s.includes("no-resolve"))||!1,priority:r.priority==1}},_t=r=>Er.filter(s=>s.name===r)[0]||Er[0],la=()=>{var X;const{ruleFilter:r,editingRule:s,isCreatingRule:n,onEditingRule:o,onCreateRule:l,onEditingRuleset:i,deleteRule:a,editRule:x,createRule:y,rulesets:I,onAlert:S}=fe(),C=!!s,d=n||C,g=C?"clash.rule.edited":"clash.rule.created",[E,P]=f.exports.useState(!1),[h,c]=f.exports.useState(""),[u,w]=f.exports.useState(_t("DOMAIN-SUFFIX")),F=Me(),{t:L}=te(),k=rt({defaultValues:Cr(null),resolver:bt(sa)});f.exports.useEffect(()=>{s&&(k.reset(oa(s)),w(_t(s.type)))},[s]),f.exports.useEffect(()=>{n&&(w(_t("DOMAIN-SUFFIX")),k.reset(Cr(r.ruleset)))},[n,r]);const m=j=>{P(!0),c(null);const{no_resolve:O,priority:G,...oe}=j;let he={...oe,id:s==null?void 0:s.id,priority:G?1:0,option:O&&_t(j.type).noResolve?"no-resolve":""};(C?x:y)(he).then(()=>{F({title:L(g,{name:j.content}),status:"success",isClosable:!0,position:"top",duration:3e3}),v()}).catch(K=>{var _e,M,T,re,H,le;if(((_e=K==null?void 0:K.response)==null?void 0:_e.status)===409||((M=K==null?void 0:K.response)==null?void 0:M.status)===400||((T=K==null?void 0:K.response)==null?void 0:T.status)===404){let Y=(H=(re=K==null?void 0:K.response)==null?void 0:re._data)==null?void 0:H.detail;Y.err&&(Y=L(`error.${Y.err}`)),c(Y)}((le=K==null?void 0:K.response)==null?void 0:le.status)===422&&Object.keys(K.response._data.detail).forEach(Y=>{let ne=hr(K.response._data.detail[Y]),ze=ne;ne.err&&(ze=`error.${ne.err}`,ne=L(ze)),c(ne),k.setError(Y,{type:"custom",message:ze})})}).finally(()=>{P(!1)})},v=()=>{k.reset(Cr(r.ruleset)),l(!1),o(null),c(null),w(_t("DOMAIN-SUFFIX"))},N=()=>{S({title:L("clash.rule.delete"),content:L("clash.rule.deletePrompt",{name:s==null?void 0:s.content}),type:"error",yes:L("delete"),onConfirm:()=>{a(s).then(()=>{F({title:L("clash.rule.deleteSuccess",{name:s==null?void 0:s.content}),status:"success",isClosable:!0,position:"top",duration:3e3}),v()}).catch(j=>{F({title:L("clash.rule.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{S(null)})}})},ie=()=>{const j=k.getValues().ruleset,O=I.filter(G=>G.name==j)[0];O&&(v(),i(O))},J=j=>j&&L(j),R=E;return t(xe,{isOpen:d,onClose:v,size:"md",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Ut,{...k,children:e(Se,{mx:"3",children:t("form",{onSubmit:k.handleSubmit(m),children:[e(we,{pt:6,children:t(b,{gap:2,children:[e(ve,{color:"primary",children:C?e(ps,{color:"white"}):e(nr,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:L(C?"clash.rule.edit":"clash.rule.add")})]})}),e(Ce,{mt:3,disabled:R}),e(ke,{children:t(B,{justifyContent:"space-between",children:[t(D,{height:"66px",children:[e(U,{children:L("clash.ruleset")}),t(b,{children:[e(pe,{disabled:R,size:"sm",...k.register("ruleset"),children:I.map(j=>t("option",{value:j.name,children:[j.name," (",j.policy,")"]},j.id))}),e(q,{"aria-label":"Edit",size:"sm",onClick:ie,children:e(ms,{})})]})]}),t(D,{height:"66px",mb:u.message?4:0,children:[e(U,{children:L("clash.type")}),e(pe,{disabled:R,size:"sm",...k.register("type",{onChange:j=>w(_t(j.target.value))}),children:Er.map(j=>e("option",{value:j.name,children:j.name},j.name))}),u.message&&e(Wn,{fontSize:"xs",mt:1,children:L(u.message)})]}),t(D,{isInvalid:!!k.formState.errors.content,children:[e(U,{children:L("clash.content")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:u.example,disabled:R,...k.register("content")}),e($e,{children:J((X=k.formState.errors.content)==null?void 0:X.message)})]}),t(D,{mb:"0px",pt:"10px",children:[e(U,{children:L("clash.policy")}),e(Oe,{control:k.control,name:"policy",render:({field:j})=>e(Xn,{isDisabled:R,...j,children:e(Jn,{direction:"row",spacing:"6",children:["","DIRECT","PROXY","REJECT"].map(O=>e(Kn,{value:O,size:"md",colorScheme:"primary",children:e(p,{fontSize:"sm",children:O||"RULESET"})},O||"RULESET"))})})})]}),t(b,{w:"full",pt:"2",children:[u.noResolve&&t(D,{display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:L("clash.rule.noResolve")}),e(We,{colorScheme:"primary",...k.register("no_resolve")})]}),t(D,{display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:L("clash.rule.priority")}),e(We,{disabled:R,colorScheme:"primary",...k.register("priority")})]})]}),h&&t(pt,{status:"error",children:[e(ft,{}),h]})]})}),e(Ne,{mt:"3",children:t(b,{justifyContent:"space-between",w:"full",gap:3,children:[C&&e(de,{label:L("delete"),placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",onClick:N,children:e(mt,{})})}),t(b,{w:"full",justifyItems:"flex-end",children:[e(Q,{onClick:v,size:"sm",variant:"outline",w:"full",disabled:R,children:L("cancel")}),e(Q,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:E?e(Pe,{size:"xs"}):void 0,w:"full",isDisabled:R||!k.formState.isDirty,children:L(C?"clash.update":"clash.create")})]})]})})]})})})]})},ia=z(Qt,{baseStyle:{w:5,h:5}}),aa=z(At,{baseStyle:{w:5,h:5}}),bn=()=>({id:0,name:"",builtin:!1,policy:"PROXY",settings:{as_provider:!1,type:"http",behavior:"classical",format:"yaml",interval:3600}}),ca=()=>{const{editingRuleset:r,isCreatingRuleset:s,onEditingRuleset:n,onCreateRuleset:o,deleteRuleset:l,editRuleset:i,createRuleset:a,onRuleFilterChange:x,onAlert:y}=fe(),I=!!r,S=s||I,C=I?"clash.ruleset.edited":"clash.ruleset.created",[d,g]=f.exports.useState(!1),[E,P]=f.exports.useState(""),[h,c]=f.exports.useState(!1),u=Me(),{t:w}=te(),F=rt({defaultValues:bn()});f.exports.useEffect(()=>{var N;r&&(F.reset(r),c((N=r.settings.as_provider)!=null?N:!1))},[r]);const L=N=>{g(!0),P(null);let ie=N;(I?i:a)(ie).then(()=>{u({title:w(C,{name:N.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),x({ruleset:ie.name,offset:0}),k()}).catch(J=>{var R,X,j,O,G,oe;if(((R=J==null?void 0:J.response)==null?void 0:R.status)===409||((X=J==null?void 0:J.response)==null?void 0:X.status)===400||((j=J==null?void 0:J.response)==null?void 0:j.status)===404){let he=(G=(O=J==null?void 0:J.response)==null?void 0:O._data)==null?void 0:G.detail;he.err&&(he=w(`error.${he.err}`)),P(he)}((oe=J==null?void 0:J.response)==null?void 0:oe.status)===422&&Object.keys(J.response._data.detail).forEach(he=>{let K=hr(J.response._data.detail[he]),_e=K;K.err&&(_e=`error.${K.err}`,K=w(_e)),P(K),F.setError(he,{type:"custom",message:K})})}).finally(()=>{g(!1)})},k=()=>{F.reset(bn()),o(!1),c(!1),n(null),P(null),y(null)},m=()=>{y({title:w("clash.ruleset.delete"),content:w("clash.ruleset.deletePrompt",{name:r==null?void 0:r.name}),type:"error",yes:w("delete"),onConfirm:()=>{l(r).then(()=>{u({title:w("clash.ruleset.deleteSuccess",{name:r==null?void 0:r.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),k()}).catch(N=>{u({title:w("clash.ruleset.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{y(null)})}})},v=d;return t(xe,{isOpen:S,onClose:k,size:"md",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Ut,{...F,children:e(Se,{mx:"3",children:t("form",{onSubmit:F.handleSubmit(L),children:[e(we,{pt:6,children:t(b,{gap:2,children:[e(ve,{color:"primary",children:I?e(aa,{color:"white"}):e(ia,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:w(I?"clash.ruleset.edit":"clash.ruleset.add")})]})}),e(Ce,{mt:3,disabled:v}),e(ke,{children:t(B,{justifyContent:"space-between",children:[t(D,{mb:"0",isInvalid:!!F.formState.errors.name,children:[e(U,{children:w("clash.name")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:v||(r==null?void 0:r.builtin),...F.register("name")})]}),t(D,{mb:"0px",pt:"10px",children:[e(U,{children:w("clash.policy")}),e(Oe,{control:F.control,name:"policy",render:({field:N})=>e(Xn,{isDisabled:v||(r==null?void 0:r.builtin),...N,children:e(Jn,{direction:"row",spacing:"6",children:["DIRECT","PROXY","REJECT"].map(ie=>e(Kn,{value:ie,size:"md",colorScheme:"primary",children:e(p,{fontSize:"sm",children:ie})},ie))})})})]}),e(xt,{w:"full",allowToggle:!0,children:t(dt,{border:"0",children:[e(ht,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:t(b,{pt:"4",pb:"2",w:"full",children:[e(Et,{}),t(p,{whiteSpace:"nowrap",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[w("clash.advanceOption"),e(Dt,{fontSize:"sm",ml:1})]}),e(Et,{})]})}),e(ut,{w:"full",p:1,children:t(B,{w:"full",children:[t(D,{mb:"10px",children:[e(U,{children:w("clash.icon")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:v,...F.register("settings.icon")})]}),t(D,{display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:w("clash.ruleset.asRuleProvider")}),e(We,{disabled:v||(r==null?void 0:r.builtin),colorScheme:"primary",...F.register("settings.as_provider",{onChange:N=>c(N.target.checked)})})]}),h&&t(B,{w:"full",children:[t(b,{w:"full",children:[t(D,{children:[e(U,{children:w("clash.behavior")}),e(pe,{size:"sm",...F.register("settings.behavior"),children:["classical","domain","ipcidr"].map(N=>e("option",{value:N,children:N},N))})]}),t(D,{children:[e(U,{children:w("clash.type")}),e(pe,{size:"sm",...F.register("settings.type"),children:["http","file"].map(N=>e("option",{value:N,children:N},N))})]})]}),t(b,{w:"full",children:[t(D,{children:[e(U,{children:w("clash.format")}),e(pe,{size:"sm",...F.register("settings.format"),children:["yaml","text"].map(N=>e("option",{value:N,children:N},N))})]}),t(D,{children:[e(U,{children:w("clash.interval")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...F.register("settings.interval")})]})]}),t(D,{children:[e(U,{children:w("clash.url")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...F.register("settings.url")})]}),t(D,{children:[e(U,{children:w("clash.path")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...F.register("settings.path")})]})]})]})})]})}),E&&t(pt,{status:"error",children:[e(ft,{}),E]})]})}),e(Ne,{mt:"3",children:t(b,{justifyContent:"space-between",w:"full",gap:3,children:[I&&e(de,{label:w("delete"),placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",onClick:m,children:e(mt,{})})}),t(b,{w:"full",justifyItems:"flex-end",children:[e(Q,{onClick:k,size:"sm",variant:"outline",w:"full",disabled:v,children:w("cancel")}),e(Q,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:d?e(Pe,{size:"xs"}):void 0,w:"full",isDisabled:v||!F.formState.isDirty,children:w(I?"clash.update":"clash.create")})]})]})})]})})})]})},da=z(At,{baseStyle:{w:5,h:5}}),ha=()=>{const{loading:r,editingSetting:s,onEditingSetting:n,editSetting:o}=fe(),l=s!==null,{colorMode:i}=vt(),{t:a}=te(),x=Me(),[y,I]=f.exports.useState((s==null?void 0:s.content)||""),S=()=>{n(null)},C=()=>{o({name:s.name,content:y}).then(()=>{x({title:a("clash.setting.savedSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})})};return f.exports.useEffect(()=>{s&&I(s.content)},[s]),t(xe,{isOpen:l,onClose:S,size:"4xl",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",children:[e(we,{pt:6,children:t(b,{gap:2,children:[e(ve,{color:"primary",children:e(da,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:a("clash.setting.edit")})]})}),e(Ce,{mt:3}),e(ke,{children:e(B,{w:"full",children:e(So,{value:y,height:"500px",theme:i,extensions:[wo.define(Co)],onChange:d=>I(d)})})}),e(Ne,{children:e(b,{w:"full",justifyContent:"flex-end",children:e(Q,{colorScheme:"primary",size:"sm",minW:40,isDisabled:r||y==(s==null?void 0:s.content),onClick:C,px:5,children:a("clash.save")})})})]})]})},je={baseStyle:{w:5,h:5}},ps=z(At,je),nr=z(Qt,je),ur=z(Pr,je),pr=z(ir,je);z(Qn,je);z(ar,je);const ua=z(Fr,je),ms=z(Ar,je);z(Wr,je);const Vr=z(qt,je);z(ko,je);const gs=z(In,je),pa=z(Lr,je),sr=z(Mr,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),ma=()=>{const{isEditingSubscription:r,onEditingSubscription:s}=$(),{t:n}=te();return e(An,{isLazy:!0,colorScheme:"primary",lazyBehavior:"keepMounted",children:t(xe,{isOpen:r,onClose:()=>{s(!1)},size:"5xl",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",w:"full",children:[e(we,{pt:6,children:t(b,{gap:2,children:[e(ve,{color:"primary",children:e(ua,{color:"white"})}),t(Pn,{children:[e(It,{fontSize:"lg",children:n("clash.proxies")}),e(It,{fontSize:"lg",children:n("clash.proxyGroups")}),e(It,{fontSize:"lg",children:n("clash.rules")}),e(It,{fontSize:"lg",children:n("clash.setting")})]})]})}),e(Ce,{mt:3}),t(ke,{children:[t(Ln,{children:[e(Rt,{children:e(ba,{})}),e(Rt,{children:e(ya,{})}),e(Rt,{children:e(wa,{})}),e(Rt,{children:e(ga,{})})]}),e(la,{}),e(ca,{}),e(na,{}),e(ea,{}),e(ha,{})]}),e(Ne,{mt:"3"})]})]})})},ga=()=>{const{fetchSettings:r,settings:s,onEditingSetting:n}=fe(),{isEditingSubscription:o}=$();f.exports.useEffect(()=>{o&&r()},[o]);const l=i=>Tr(["/",`/statics/images/${i}.png`]);return e(b,{spacing:6,minH:"sm",alignItems:"baseline",children:s.map(i=>t(Sn,{p:6,pl:10,pr:10,borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{borderColor:"gray.600",bg:"gray.750"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",onClick:()=>n(i),children:[e(W,{w:"48px",children:e(vo,{src:l(i.name),alt:i.name})}),e(W,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:i.name})]},i.name))})},fa=Zt(r=>{fe.getState().onProxyFilterChange({...fe.getState().proxyFilter,offset:0,search:r})},300),ba=()=>{const{isEditingSubscription:r}=$(),{t:s}=te(),{proxyFilter:n,onProxyFilterChange:o,onCreateProxy:l,onEditingProxy:i,fetchProxies:a,fetchProxyInbounds:x,proxies:y,totalProxies:I,loading:S}=fe(),[C,d]=f.exports.useState(""),g=h=>{d(h.target.value),fa(h.target.value)},E=()=>{d(""),o({...n,offset:0,search:""})},P=h=>{let c=n.sort;c.includes(h)?c.startsWith("-")?c="-modified_at":c="-"+h:c=h,o({sort:c,offset:0})};return f.exports.useEffect(()=>{r&&(n.search="",a(),x())},[r]),t(B,{w:"full",children:[t(b,{w:"full",justifyContent:"space-between",children:[e(b,{children:t(at,{children:[e(Tt,{height:"8",pointerEvents:"none",children:e(ur,{})}),e(Z,{size:"sm",borderRadius:"md",placeholder:s("search"),value:C,borderColor:"light-border",onChange:g}),t(ct,{height:"8",children:[S&&e(Pe,{size:"xs"}),C.length>0&&e(q,{onClick:E,"aria-label":"clear",size:"xs",variant:"ghost",children:e(pr,{})})]})]})}),t(b,{children:[e(q,{"aria-label":"refresh proxies",disabled:S,onClick:a,size:"sm",variant:"outline",children:e(Vr,{className:Xe({"animate-spin":S})})}),e(Q,{colorScheme:"primary",size:"sm",onClick:()=>l(!0),px:5,children:s("clash.proxy.add")})]})]}),t(W,{overflowX:"auto",w:"full",children:[t(Bt,{orientation:"vertical",children:[e(Ht,{zIndex:"docked",position:"relative",children:t(Ve,{children:[e(ue,{minW:"30px",pr:"0",cursor:"pointer",onClick:P.bind(null,"id"),children:t(b,{children:[e("span",{children:"id"}),e(Re,{sort:n.sort,column:"id"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:P.bind(null,"name"),children:t(b,{children:[e("span",{children:s("clash.name")}),e(Re,{sort:n.sort,column:"name"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:P.bind(null,"server"),children:t(b,{children:[e("span",{children:s("clash.server")}),e(Re,{sort:n.sort,column:"server"})]})}),e(ue,{minW:"100px",cursor:"pointer",onClick:P.bind(null,"inbound"),children:t(b,{children:[e("span",{children:s("clash.inbound")}),e(Re,{sort:n.sort,column:"inbound"})]})}),e(ue,{minW:"100px",cursor:"pointer",onClick:P.bind(null,"tag"),children:t(b,{children:[e("span",{children:s("clash.tag")}),e(Re,{sort:n.sort,column:"tag"})]})})]})}),e(Vt,{children:y==null?void 0:y.map((h,c)=>t(Ve,{className:Xe("interactive",{"last-row":c===y.length-1}),onClick:()=>i(h),children:[e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:h.id}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:h.name}),t(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:[h.server,":",h.port]}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:h.inbound}),e(ae,{pt:"2.5",pb:"2.5",fontSize:"sm",children:h.tag})]},h.id))})]}),e(dr,{onChange:(h,c)=>{o({...n,limit:c,offset:h*c})},total:I,limit:n.limit,offset:n.offset})]})]})},xa=Zt(r=>{fe.getState().onProxyGroupFilterChange({...fe.getState().proxyGroupFilter,offset:0,search:r})},300),ya=()=>{const{isEditingSubscription:r}=$(),{t:s}=te(),{proxyGroupFilter:n,onProxyGroupFilterChange:o,fetchProxyGroups:l,fetchProxyBriefs:i,proxyGroups:a,totalProxyGroups:x,loading:y,onEditingProxyGroup:I,onCreateProxyGroup:S}=fe(),[C,d]=f.exports.useState(""),g=h=>{d(h.target.value),xa(h.target.value)},E=()=>{d(""),o({...n,offset:0,search:""})},P=h=>{let c=n.sort;c.includes(h)?c.startsWith("-")?c="-modified_at":c="-"+h:c=h,o({sort:c,offset:0})};return f.exports.useEffect(()=>{r&&(n.search="",l(),i())},[r]),t(B,{w:"full",children:[t(b,{w:"full",justifyContent:"space-between",children:[e(b,{children:t(at,{children:[e(Tt,{height:"8",pointerEvents:"none",children:e(ur,{})}),e(Z,{size:"sm",borderRadius:"md",placeholder:s("search"),value:C,borderColor:"light-border",onChange:g}),t(ct,{height:"8",children:[y&&e(Pe,{size:"xs"}),C.length>0&&e(q,{onClick:E,"aria-label":"clear",size:"xs",variant:"ghost",children:e(pr,{})})]})]})}),t(b,{children:[e(q,{"aria-label":"refresh proxy groups",disabled:y,onClick:l,size:"sm",variant:"outline",children:e(Vr,{className:Xe({"animate-spin":y})})}),e(Q,{colorScheme:"primary",size:"sm",onClick:()=>S(!0),px:5,children:s("clash.proxyGroup.add")})]})]}),t(W,{overflowX:"auto",w:"full",children:[t(Bt,{orientation:"vertical",children:[e(Ht,{zIndex:"docked",position:"relative",children:t(Ve,{children:[e(ue,{minW:"30px",pr:"0",cursor:"pointer",onClick:P.bind(null,"id"),children:t(b,{children:[e("span",{children:"id"}),e(Re,{sort:n.sort,column:"id"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:P.bind(null,"name"),children:t(b,{children:[e("span",{children:s("clash.name")}),e(Re,{sort:n.sort,column:"name"})]})}),e(ue,{minW:"100px",cursor:"pointer",onClick:P.bind(null,"type"),children:t(b,{children:[e("span",{children:s("clash.type")}),e(Re,{sort:n.sort,column:"type"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:P.bind(null,"tag"),children:t(b,{children:[e("span",{children:s("clash.tag")}),e(Re,{sort:n.sort,column:"tag"})]})}),e(ue,{minW:"140px",cursor:"pointer",children:e(b,{children:e("span",{children:s("clash.proxies")})})})]})}),e(Vt,{children:a==null?void 0:a.map((h,c)=>t(Ve,{className:Xe("interactive",{"last-row":c===a.length-1}),onClick:()=>I(h),children:[e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:h.id}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:h.name}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:h.type}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:h.tag}),e(ae,{pt:"2.5",pb:"2.5",fontSize:"sm",children:h.proxies})]},h.id))})]}),e(dr,{onChange:(h,c)=>{o({...n,limit:c,offset:h*c})},total:x,limit:n.limit,offset:n.offset})]})]})},Sa=Zt(r=>{fe.getState().onRuleFilterChange({...fe.getState().ruleFilter,offset:0,search:r})},300),wa=()=>{const{isEditingSubscription:r}=$(),{t:s}=te(),{ruleFilter:n,onRuleFilterChange:o,fetchRules:l,fetchRulesets:i,onEditingRule:a,onCreateRule:x,onEditingRuleset:y,onCreateRuleset:I,rules:S,totalRules:C,rulesets:d,loading:g}=fe(),[E,P]=f.exports.useState(""),h=d.reduce((m,v)=>({...m,[v.name]:v}),{}),c=m=>{P(m.target.value),Sa(m.target.value)},u=()=>{P(""),o({...n,offset:0,search:""})},w=m=>{const v=d.filter(N=>N.name===m);return v.length?v[0]:null},F=m=>{o(m==="All"?{ruleset:"",offset:0}:{ruleset:m,offset:0})},L=()=>{y(w(n.ruleset))},k=m=>{let v=n.sort;v.includes(m)?v.startsWith("-")?v="-modified_at":v="-"+m:v=m,o({sort:v,offset:0})};return f.exports.useEffect(()=>{n.ruleset&&!w(n.ruleset)&&o({ruleset:"",offset:0})},[d]),f.exports.useEffect(()=>{r&&(n.search="",l(),i())},[r]),t(B,{w:"full",children:[t(b,{w:"full",justifyContent:"space-between",children:[t(b,{children:[e(de,{placement:"top",label:s("clash.ruleset.add"),children:e(q,{"aria-label":"Add ruleset",size:"sm",onClick:()=>I(!0),children:e(nr,{})})}),e(de,{isDisabled:!n.ruleset,label:s("clash.ruleset.edit"),placement:"top",children:e(q,{"aria-label":"Ruleset setting",size:"sm",isDisabled:!n.ruleset,onClick:L,children:e(ms,{})})}),t(pe,{size:"sm",value:n.ruleset||"All",onChange:m=>F(m.target.value),children:[e("option",{value:"All",children:"All"},"All"),d.map(m=>t("option",{value:m.name,children:[m.name," (",m.policy,")"]},m.name))]}),t(at,{children:[e(Tt,{height:"8",pointerEvents:"none",children:e(ur,{})}),e(Z,{size:"sm",borderRadius:"md",placeholder:s("search"),value:E,borderColor:"light-border",onChange:c}),t(ct,{height:"8",children:[g&&e(Pe,{size:"xs"}),E.length>0&&e(q,{onClick:u,"aria-label":"clear",size:"xs",variant:"ghost",children:e(pr,{})})]})]})]}),t(b,{children:[e(q,{"aria-label":"refresh rules",disabled:g,onClick:l,size:"sm",variant:"outline",children:e(Vr,{className:Xe({"animate-spin":g})})}),e(Q,{colorScheme:"primary",size:"sm",onClick:()=>x(!0),px:5,children:s("clash.rule.add")})]})]}),t(W,{overflowX:"auto",w:"full",children:[t(Bt,{orientation:"vertical",children:[e(Ht,{zIndex:"docked",position:"relative",children:t(Ve,{children:[e(ue,{minW:"170px",cursor:"pointer",onClick:k.bind(null,"type"),children:t(b,{children:[e("span",{children:s("clash.type")}),e(Re,{sort:n.sort,column:"type"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:k.bind(null,"content"),children:t(b,{children:[e("span",{children:s("clash.content")}),e(Re,{sort:n.sort,column:"content"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:k.bind(null,"option"),children:t(b,{children:[e("span",{children:s("clash.option")}),e(Re,{sort:n.sort,column:"option"})]})}),e(ue,{minW:"140px",children:e(b,{children:e("span",{children:s("clash.ruleset")})})})]})}),e(Vt,{children:S==null?void 0:S.map((m,v)=>{var N;return t(Ve,{className:Xe("interactive",{"last-row":v===S.length-1}),onClick:()=>a(m),children:[e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:m.type}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:e(p,{noOfLines:1,children:m.content})}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:m.option}),e(ae,{pt:"2.5",pb:"2.5",fontSize:"sm",children:t(p,{whiteSpace:"nowrap",children:[m.ruleset," (",m.policy||((N=h[m.ruleset])==null?void 0:N.policy),")"]})})]},m.content)})})]}),e(dr,{onChange:(m,v)=>{o({...n,limit:v,offset:m*v})},total:C,limit:n.limit,offset:n.offset})]})]})},Ca={baseStyle:{w:5,h:5}},xn={error:"red",success:"green",warning:"yellow",info:"blue"},ka=z(Rn,Ca),va=()=>{const[r,s]=f.exports.useState(!1),{alert:n,onAlert:o}=fe(),{t:l}=te(),i=()=>{o(null)},a=()=>{s(!0),n==null||n.onConfirm()};return f.exports.useEffect(()=>{s(!1)},[n]),t(xe,{isOpen:!!n,onClose:i,size:"sm",children:[e(ye,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),t(Se,{mx:"3",mt:150,children:[e(we,{pt:6,children:t(b,{spacing:4,children:[e(ve,{color:xn[(n==null?void 0:n.type)||"error"],children:e(ka,{w:10})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:n==null?void 0:n.title})]})}),e(Ce,{mt:3}),e(ke,{children:n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(it,{components:{b:e("b",{})},children:n.content})})}),t(Ne,{display:"flex",children:[e(Q,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Q,{size:"sm",w:"full",colorScheme:xn[(n==null?void 0:n.type)||"error"],onClick:a,leftIcon:r?e(Pe,{size:"xs"}):void 0,children:n==null?void 0:n.yes})]})]})]})},_a=()=>(f.exports.useEffect(()=>{$.getState().refetchUsers(),fe.getState().fetchProxyTags(),Jo()},[]),t(B,{justifyContent:"space-between",minH:"100vh",p:"6",rowGap:4,children:[t(W,{w:"full",children:[e(Tl,{}),e(qo,{mt:"4"}),e(pl,{}),e(qi,{}),e(Ti,{}),e(cl,{}),e(li,{}),e(Bl,{}),e(di,{}),e(ui,{}),e(Jl,{}),e(ri,{}),e(ai,{}),e(al,{}),e(va,{}),e(ma,{})]}),e(os,{})]})),za=r=>f.exports.createElement("svg",{viewBox:"0 0 747 747",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},f.exports.createElement("path",{d:"M746.671 209.652V77.6572C746.671 72.9384 743.827 68.6832 739.468 66.8811C735.108 65.0738 730.093 66.0739 726.754 69.4072L579.354 216.807C577.453 202.386 570.203 189.203 559.037 179.87C547.875 170.542 533.615 165.744 519.083 166.432C504.551 167.12 490.807 173.24 480.573 183.583L414.375 249.776C412.417 235.391 405.141 222.25 393.985 212.959C382.823 203.662 368.594 198.88 354.083 199.552C339.578 200.224 325.849 206.302 315.594 216.588L274.343 257.828L19.9167 3.41515C16.5781 0.0818157 11.5625 -0.918184 7.20306 0.889149C2.84373 2.69648 0 6.94648 0 11.6651V143.649C0 146.743 1.22917 149.712 3.41667 151.899L191.843 340.339L3.41667 528.753C1.2292 530.94 0 533.909 0 537.003V668.997C0 673.716 2.84373 677.971 7.20306 679.773C11.5624 681.581 16.578 680.58 19.9167 677.247L167.317 529.847C169.285 544.233 176.561 557.358 187.718 566.65C198.869 575.947 213.098 580.728 227.603 580.066C242.103 579.404 255.838 573.342 266.098 563.071L332.295 496.874V496.879C334.259 511.264 341.535 524.395 352.691 533.686C363.853 542.977 378.082 547.759 392.587 547.092C407.093 546.421 420.822 540.348 431.077 530.066L472.327 488.826L726.754 743.239C728.941 745.427 731.91 746.656 735.004 746.656C736.535 746.661 738.056 746.359 739.473 745.77C743.832 743.963 746.671 739.708 746.671 734.989V602.994C746.671 599.901 745.442 596.932 743.254 594.744L554.827 406.318L743.254 217.904H743.259C745.447 215.717 746.676 212.748 746.676 209.654L746.671 209.652ZM23.3373 39.8118L257.844 274.318L208.328 323.818L23.3413 138.818L23.3373 39.8118ZM723.337 706.825L488.831 472.318L538.347 422.818L723.333 607.818L723.337 706.825ZM23.3373 541.825L332.097 233.078C338.764 226.719 347.624 223.172 356.843 223.172C366.056 223.172 374.916 226.719 381.588 233.078C388.151 239.641 391.838 248.548 391.838 257.828C391.838 267.114 388.151 276.016 381.588 282.577L23.3347 640.831L23.3373 541.825ZM249.604 546.575C240.755 555.419 227.864 558.872 215.781 555.638C203.703 552.398 194.265 542.961 191.027 530.883C187.792 518.8 191.245 505.91 200.089 497.06L497.076 200.074C505.92 191.23 518.811 187.772 530.893 191.011C542.971 194.246 552.409 203.678 555.648 215.76C558.888 227.839 555.434 240.73 546.591 249.572L249.604 546.575ZM723.337 204.815L414.577 513.562C407.911 519.926 399.051 523.473 389.832 523.473C380.618 523.473 371.753 519.926 365.087 513.562C358.529 506.999 354.842 498.098 354.842 488.816C354.842 479.535 358.529 470.634 365.087 464.071L723.34 105.818L723.337 204.815Z",fill:"currentColor"})),Ia=_.object({username:_.string().min(1,"login.fieldRequired"),password:_.string().min(1,"login.fieldRequired")}),Ra=z(za,{baseStyle:{strokeWidth:"10px",w:12,h:12}}),Da=z(_o,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),yn=()=>{var C,d;const[r,s]=f.exports.useState(""),[n,o]=f.exports.useState(!1),l=zo(),{t:i}=te();let a=Io();const{register:x,formState:{errors:y},handleSubmit:I}=rt({resolver:bt(Ia)});f.exports.useEffect(()=>{$o(),a.pathname!=="/login"&&l("/login",{replace:!0})},[]);const S=g=>{s("");const E=new FormData;E.append("username",g.username),E.append("password",g.password),E.append("grant_type","password"),o(!0),V("/admin/token",{method:"post",body:E}).then(({access_token:P})=>{Wo(P),l("/")}).catch(P=>{s(P.response._data.detail)}).finally(o.bind(null,!1))};return t(B,{justifyContent:"space-between",minH:"100vh",p:"6",w:"full",children:[t(W,{w:"full",children:[e(b,{justifyContent:"end",w:"full",children:e(ls,{})}),e(b,{w:"full",justifyContent:"center",alignItems:"center",children:t(W,{w:"full",maxW:"340px",mt:"6",children:[t(B,{alignItems:"center",w:"full",children:[e(Ra,{}),e(p,{fontSize:"2xl",fontWeight:"semibold",children:i("login.loginYourAccount")}),e(p,{color:"gray.600",_dark:{color:"gray.400"},children:i("login.welcomeBack")})]}),e(W,{w:"full",maxW:"300px",m:"auto",pt:"4",children:e("form",{onSubmit:I(S),children:t(B,{mt:4,rowGap:2,children:[e(D,{children:e(tt,{w:"full",placeholder:i("username"),...x("username"),error:i((C=y==null?void 0:y.username)==null?void 0:C.message)})}),e(D,{children:e(tt,{w:"full",type:"password",placeholder:i("password"),...x("password"),error:i((d=y==null?void 0:y.password)==null?void 0:d.message)})}),r&&t(pt,{status:"error",rounded:"md",children:[e(ft,{}),e(En,{children:r})]}),t(Q,{isLoading:n,type:"submit",w:"full",colorScheme:"primary",children:[e(Da,{marginRight:1}),i("login")]})]})})})]})})]}),e(os,{})]})},Ea=()=>V("/admin",{headers:{Authorization:`Bearer ${tr()}`}}),Ta=Ro([{path:"/",element:e(_a,{}),errorElement:e(yn,{}),loader:Ea},{path:"/login/",element:e(yn,{})}]);function Ua(){return e("main",{className:"p-8",children:e(Do,{router:Ta})})}ce.extend(Eo);ce.extend(To);ce.extend(Uo);ce.extend(Ao);ce.extend(Po);es(Lo.get()||"light");Fo.createRoot(document.getElementById("root")).render(e(vr.StrictMode,{children:e(Mo,{theme:Oo,children:e(No,{client:Ir,children:e(Ua,{})})})}));
