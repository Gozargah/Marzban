import{i as Yt,B as on,a as ln,b as an,j as yr,d as ae,U as os,e as cn,z as dn,Q as un,c as hn,$ as pn,f as Nt,g as v,h as mn,C as gn,k as er,u as ls,l as X,m as r,H as g,n as e,T as b,o as is,p as j,s as fn,r as m,q as kt,J as bn,t as Sr,A as Wt,v as xn,w as yn,M as be,x as xe,y as ye,D as Se,E as Ce,F as De,G as qe,I as Ot,K as Sn,L as At,N as we,O as E,P as L,R as as,S as me,V as le,W as Be,X as q,Y as Ee,Z as Y,_ as Oe,a0 as Dt,a1 as Cn,a2 as Ye,a3 as Re,a4 as Cr,a5 as $t,a6 as cs,a7 as xt,a8 as He,a9 as vt,aa as Z,ab as Ve,ac as Ur,ad as wn,ae as ds,af as us,ag as hs,ah as Ge,ai as kn,aj as vn,ak as wr,al as zn,am as In,an as tr,ao as ps,ap as ms,aq as kr,ar as Xe,as as Fr,at as _n,au as Zt,av as Rn,aw as gs,ax as Dn,ay as En,az as Pn,aA as fs,aB as Te,aC as Tn,aD as pe,aE as rr,aF as T,aG as it,aH as zt,aI as at,aJ as O,aK as vr,aL as An,aM as Je,aN as Ke,aO as Ct,aP as et,aQ as Ae,aR as Le,aS as mt,aT as Ue,aU as Fe,aV as gt,aW as Mr,aX as zr,aY as Ln,aZ as Un,a_ as bs,a$ as Fn,b0 as Mn,b1 as jt,b2 as ot,b3 as lt,b4 as xs,b5 as ht,b6 as Nn,b7 as ys,b8 as Wn,b9 as pt,ba as ar,bb as Nr,bc as Ss,bd as Cs,be as ws,bf as yt,bg as ks,bh as St,bi as vs,bj as On,bk as zs,bl as $n,bm as jn,bn as Ir,bo as Bn,bp as Gn,bq as Is,br as _s,bs as Rs,bt as Ie,bu as Hn,bv as It,bw as Ds,bx as Pt,by as Qe,bz as Wr,bA as Es,bB as Ps,bC as Ts,bD as As,bE as Ls,bF as Us,bG as Fs,bH as Ms,bI as Ns,bJ as Vn,bK as qn,bL as Yn,bM as Zn,bN as Ws,bO as Os,bP as Lt,bQ as Ut,bR as Ne,bS as ue,bT as Ft,bU as ie,bV as Or,bW as Qn,bX as Xn,bY as Jn,bZ as wt,b_ as $s,b$ as js,c0 as Bs,c1 as Kn,c2 as eo,c3 as to,c4 as ro,c5 as so,c6 as no,c7 as oo,c8 as lo,c9 as io,ca as ao,cb as co,cc as uo,cd as ho,ce as po,cf as mo,cg as go,ch as fo,ci as bo,cj as xo,ck as yo}from"./vendor.8f27f439.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerpolicy&&(i.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?i.credentials="include":l.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(l){if(l.ep)return;l.ep=!0;const i=s(l);fetch(l.href,i)}})();Yt.use(on).use(ln).use(an).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:yr(["/dashboard/","locales/{{lng}}.json"])}},function(t,n){ae.locale(Yt.language)});Yt.on("languageChanged",t=>{ae.locale(t)});os("es",cn);os("zh-cn",dn);const gr=new un,Gs=t=>{const n=document.querySelector('meta[name="theme-color"]');n==null||n.setAttribute("content",t=="dark"?"#1A202C":"#3B81F6")},So=hn({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",primary:{50:"#9cb7f2",100:"#88a9ef",200:"#749aec",300:"#618ce9",400:"#4d7de7",500:"#396fe4",600:"#3364cd",700:"#2e59b6",800:"#284ea0",900:"#224389"},gray:{750:"#222C3B"}},components:{Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}}}});const Qt=()=>localStorage.getItem("token"),Co=t=>{localStorage.setItem("token",t)},wo=()=>{localStorage.removeItem("token")},ko=pn.create({baseURL:"/api/"}),vo=(t,n={})=>(Qt()&&(n.headers={...(n==null?void 0:n.headers)||{},Authorization:`Bearer ${Qt()}`}),ko(t,n)),B=vo,zo=Nt(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:"",fetchCoreSettings:()=>{t({isLoading:!0}),Promise.all([B("/core").then(({version:n,started:s,logs_websocket:o})=>t({version:n,started:s,logs_websocket:o})),B("/core/config").then(n=>t({config:n}))]).finally(()=>t({isLoading:!1}))},updateConfig:n=>(t({isPostLoading:!0}),B("/core/config",{method:"PUT",body:n}).finally(()=>{t({isPostLoading:!1})})),restartCore:()=>B("/core/restart",{method:"POST"})}));function We(t,n=2,s=!1){if(!+t)return"0 B";const o=1024,l=n<0?0:n,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(t)/Math.log(o));return s?[parseFloat((t/Math.pow(o,a)).toFixed(l)),i[a]]:`${parseFloat((t/Math.pow(o,a)).toFixed(l))} ${i[a]}`}const $r=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Io=v(mn,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),_o=v(gn,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Ro=v(er,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),cr=({title:t,content:n,icon:s})=>r(is,{p:6,borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{borderColor:"gray.600",bg:"gray.750"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[r(g,{alignItems:"center",columnGap:"4",children:[e(j,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:s}),e(b,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(j,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:n})]}),fr="statistics-query-key",Do=t=>{const{version:n}=W(),{data:s}=ls({queryKey:fr,queryFn:()=>B("/system"),refetchInterval:5e3,onSuccess:({version:l})=>{n!==l&&W.setState({version:l})}}),{t:o}=X();return r(g,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...t,children:[e(cr,{title:o("activeUsers"),content:s&&r(g,{alignItems:"flex-end",children:[e(b,{children:$r(s.users_active)}),r(b,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",$r(s.total_user)]})]}),icon:e(Io,{})}),e(cr,{title:o("dataUsage"),content:s&&We(s.incoming_bandwidth+s.outgoing_bandwidth),icon:e(_o,{})}),e(cr,{title:o("memoryUsage"),content:s&&r(g,{alignItems:"flex-end",children:[e(b,{children:We(s.mem_used,1,!0)[0]}),r(b,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:[We(s.mem_used,1,!0)[1]," /"," ",We(s.mem_total,1)]})]}),icon:e(Ro,{})})]})},Eo=t=>{for(const n in t)t[n]||delete t[n];return W.setState({loading:!0}),B("/users",{query:t}).then(n=>(W.setState({users:n}),n)).finally(()=>{W.setState({loading:!1})})},Po=()=>B("/inbounds").then(t=>{W.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{W.setState({loading:!1})}),W=Nt(fn((t,n)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0},loading:!0,isResetingAllUsage:!1,isEditingHosts:!1,isEditingNodes:!1,isEditingSubscription:!1,isShowingNodesUsage:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:10,sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:()=>{Eo(n().filters)},resetAllUsage:()=>B("/users/reset",{method:"POST"}).then(()=>{n().onResetAllUsage(!1),n().refetchUsers()}),onResetAllUsage:s=>t({isResetingAllUsage:s}),onCreateUser:s=>t({isCreatingNewUser:s}),onEditingUser:s=>{t({editingUser:s})},onDeletingUser:s=>{t({deletingUser:s})},onFilterChange:s=>{t({filters:{...n().filters,...s}}),n().refetchUsers()},setQRCode:s=>{t({QRcodeLinks:s})},deleteUser:s=>(t({editingUser:null}),B(`/user/${s.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),n().refetchUsers(),gr.invalidateQueries(fr)})),createUser:s=>B("/user",{method:"POST",body:s}).then(()=>{t({editingUser:null}),n().refetchUsers(),gr.invalidateQueries(fr)}),editUser:s=>B(`/user/${s.username}`,{method:"PUT",body:s}).then(()=>{n().onEditingUser(null),n().refetchUsers()}),revokeUserSubscription:s=>{var o,l,i,a;return delete s.sub_revoked_at,(o=s.proxies.shadowsocks)==null||delete o.password,(l=s.proxies.trojan)==null||delete l.password,(i=s.proxies.vless)==null||delete i.id,(a=s.proxies.vmess)==null||delete a.id,B(`/user/${s.username}`,{method:"PUT",body:s}).then(f=>{n().refetchUsers(),t({editingUser:f})})},fetchUserUsage:(s,o)=>{for(const l in o)o[l]||delete o[l];return B(`/user/${s.username}/usage`,{method:"GET",query:o})},onEditingHosts:s=>{t({isEditingHosts:s})},onEditingNodes:s=>{t({isEditingNodes:s})},onEditingSubscription:s=>{t({isEditingSubscription:s})},onShowingNodesUsage:s=>{t({isShowingNodesUsage:s})},setSubLink:s=>{t({subscribeUrl:s})},resetDataUsage:s=>B(`/user/${s.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),n().refetchUsers()}),revokeSubscription:s=>B(`/user/${s.username}/revoke_sub`,{method:"POST"}).then(()=>{t({revokeSubscriptionUser:null}),n().refetchUsers()})}))),ke=({children:t,color:n})=>e(j,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${n}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${n}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${n}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${n}.400`}},children:e(b,{color:`${n}.500`,_dark:{color:`${n}.900`},position:"relative",zIndex:"2",children:t})});window.ace.define("ace/theme/nord_dark",["require","exports","module","ace/lib/dom"],(t,n,s)=>{n.isDark=!0,n.cssClass="ace-nord-dark",t("../lib/dom").importCssString(n.cssText,n.cssClass)});window.ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],(t,n,s)=>{n.isDark=!1,n.cssClass="ace-dawn",t("../lib/dom").importCssString(n.cssText,n.cssClass)});const To=m.exports.forwardRef(({json:t,onChange:n,mode:s="code"},o)=>{const{colorMode:l}=kt(),i={mode:s,onChangeText:n,statusBar:!1,mainMenuBar:!1,theme:l==="dark"?"ace/theme/nord_dark":"ace/theme/dawn"},a=m.exports.useRef(null),f=m.exports.useRef(null);return m.exports.useEffect(()=>(f.current=new bn(a.current,i),()=>{f.current&&f.current.destroy()}),[]),m.exports.useEffect(()=>{f.current&&f.current.update(t)},[t]),e(j,{ref:o,border:"1px solid",borderColor:"gray.300",_dark:{borderColor:"gray.500"},borderRadius:5,h:"full",children:e(j,{height:"full",ref:a})})}),jr=500,Ao=v(Sr,{baseStyle:{w:5,h:5}}),Lo=v(Wt,{baseStyle:{w:4,h:4}}),Uo=v(xn,{baseStyle:{w:4,h:4}}),Fo=v(yn,{baseStyle:{w:3,h:3}}),Mo=t=>({[Dt.ReadyState.CONNECTING]:"connecting",[Dt.ReadyState.OPEN]:"connected",[Dt.ReadyState.CLOSING]:"closed",[Dt.ReadyState.CLOSED]:"closed",[Dt.ReadyState.UNINSTANTIATED]:"closed"})[t],No=()=>{try{let t=new URL("/api/".startsWith("/")?window.location.origin+"/api/":"/api/");return(t.protocol==="https:"?"wss://":"ws://")+yr([t.host+t.pathname,"/core/logs"])+"?interval=1&token="+Qt()}catch(t){return console.error("Unable to generate websocket url"),console.error(t),null}};let ut=[];const Wo=()=>{const{isEditingCore:t}=W(),{fetchCoreSettings:n,updateConfig:s,isLoading:o,config:l,isPostLoading:i,version:a,restartCore:f}=zo(),x=m.exports.useRef(null),[w,d]=m.exports.useState([]),{t:h}=X(),_=De(),I=qe({defaultValues:{config:l||{}}});m.exports.useEffect(()=>{l&&I.setValue("config",l)},[l]),m.exports.useEffect(()=>{t&&n()},[t]);const y=m.exports.useRef(!0),R=m.exports.useCallback(Ot(U=>{var H,G,re;const J=Math.abs((((H=x.current)==null?void 0:H.scrollTop)||0)-(((G=x.current)==null?void 0:G.scrollHeight)||0)+(((re=x.current)==null?void 0:re.offsetHeight)||0))<10;x.current&&J?y.current=!0:y.current=!1,U.length<40&&d(U)},300),[]),{readyState:c}=Sn(No(),{onMessage:U=>{ut.push(U.data),ut.length>jr&&(ut=ut.splice(0,ut.length-jr)),R([...ut])},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});m.exports.useEffect(()=>{var U;x.current&&y.current&&(x.current.scrollTop=(U=x.current)==null?void 0:U.scrollHeight)},[w]),m.exports.useEffect(()=>()=>{ut=[]},[]);const u=Mo(c.toString()),{mutate:z,isLoading:P}=At(f),N=({config:U})=>{s(U).then(()=>{_({title:h("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(J=>{let H=h("core.generalErrorMessage");typeof J.response._data.detail=="object"&&(H=J.response._data.detail[Object.keys(J.response._data.detail)[0]]),typeof J.response._data.detail=="string"&&(H=J.response._data.detail),_({title:H,status:"error",isClosable:!0,position:"top",duration:3e3})})},k=m.exports.useRef(null),[S,p]=m.exports.useState(!1),C=()=>{var U;document.fullscreenElement?(document.exitFullscreen(),p(!1)):((U=k.current)==null||U.requestFullscreen(),p(!0))};return r("form",{onSubmit:I.handleSubmit(N),children:[r(we,{children:[r(E,{children:[r(g,{justifyContent:"space-between",alignItems:"flex-start",children:[r(L,{children:[h("core.configuration")," ",o&&e(as,{isIndeterminate:!0,size:"15px"})]}),e(g,{gap:0,children:e(me,{label:"Xray Version",placement:"top",children:e(le,{height:"100%",textTransform:"lowercase",children:a&&`v${a}`})})})]}),r(j,{position:"relative",ref:k,minHeight:"300px",children:[e(Be,{control:I.control,name:"config",render:({field:U})=>e(To,{json:l,onChange:U.onChange})}),e(q,{size:"xs","aria-label":"full screen",variant:"ghost",position:"absolute",top:"2",right:"4",onClick:C,children:S?e(Fo,{}):e(Uo,{})})]})]}),r(E,{mt:"4",children:[r(g,{justifyContent:"space-between",children:[e(L,{children:h("core.logs")}),e(b,{as:L,children:h(`core.socket.${u}`)})]}),e(j,{border:"1px solid",borderColor:"gray.300",bg:"#F9F9F9",_dark:{borderColor:"gray.500",bg:"#2e3440"},borderRadius:5,minHeight:"200px",maxHeight:"250px",p:2,overflowY:"auto",ref:x,children:w.map((U,J)=>e(b,{fontSize:"xs",opacity:.8,whiteSpace:"pre-line",children:U},J))})]})]}),e(Ee,{children:r(g,{w:"full",justifyContent:"space-between",children:[e(j,{children:e(Y,{size:"sm",leftIcon:e(Lo,{className:Oe({"animate-spin":P})}),onClick:()=>z(),children:h(P?"core.restarting":"core.restartCore")})}),e(g,{children:e(Y,{size:"sm",variant:"solid",colorScheme:"primary",px:"5",type:"submit",isDisabled:o||i,isLoading:i,children:h("core.save")})})]})})]})},Oo=()=>{const{isEditingCore:t}=W(),n=W.setState.bind(null,{isEditingCore:!1}),{t:s}=X();return r(be,{isOpen:t,onClose:n,size:"3xl",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",w:"full",children:[e(Se,{pt:6,children:r(g,{gap:2,children:[e(ke,{color:"primary",children:e(Ao,{color:"white"})}),e(b,{fontWeight:"semibold",fontSize:"lg",children:s("core.title")})]})}),e(Ce,{mt:3}),e(Wo,{})]})]})},tt=v(Cn,{baseStyle:{w:5,h:5}}),$o=()=>{const[t,n]=m.exports.useState(!1),{deletingUser:s,onDeletingUser:o,deleteUser:l}=W(),{t:i}=X(),a=De(),f=()=>{o(null)},x=()=>{s&&(n(!0),l(s).then(()=>{a({title:i("deleteUser.deleteSuccess",{username:s.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(f).finally(n.bind(null,!1)))};return r(be,{isCentered:!0,isOpen:!!s,onClose:f,size:"sm",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",children:[e(Se,{pt:6,children:e(ke,{color:"red",children:e(tt,{})})}),e(Ce,{mt:3}),r(we,{children:[e(b,{fontWeight:"semibold",fontSize:"lg",children:i("deleteUser.title")}),s&&e(b,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ye,{components:{b:e("b",{})},children:i("deleteUser.prompt",{username:s.username})})})]}),r(Ee,{display:"flex",children:[e(Y,{size:"sm",onClick:f,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:"red",onClick:x,leftIcon:t?e(Re,{size:"xs"}):void 0,children:i("delete")})]})]})]})},_r={baseStyle:{w:4,h:4}},jo=v(Cr,_r),Bo=v($t,_r),Hs=v(Wt,_r),Go=Ot(t=>{W.getState().onFilterChange({...W.getState().filters,offset:0,username:t})},300),Ho=({...t})=>{const{loading:n,filters:s,onFilterChange:o,refetchUsers:l,onCreateUser:i}=W(),{t:a}=X(),[f,x]=m.exports.useState(""),w=h=>{x(h.target.value),Go(h.target.value)},d=()=>{x(""),o({...s,offset:0,username:""})};return r(cs,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},position:"sticky",top:0,mx:"-6",px:"6",rowGap:4,gap:{lg:4,base:0},bg:"var(--chakra-colors-chakra-body-bg)",py:4,zIndex:"docked",...t,children:[e(xt,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:r(He,{children:[e(vt,{pointerEvents:"none",children:e(jo,{})}),e(Z,{placeholder:a("search"),value:f,borderColor:"light-border",onChange:w}),r(Ve,{children:[n&&e(Re,{size:"xs"}),s.username&&s.username.length>0&&e(q,{onClick:d,"aria-label":"clear",size:"xs",variant:"ghost",children:e(Bo,{})})]})]})}),e(xt,{colSpan:2,order:{base:1,md:2},children:r(g,{justifyContent:"flex-end",alignItems:"center",h:"full",children:[e(q,{"aria-label":"refresh users",disabled:n,onClick:l,size:"sm",variant:"outline",children:e(Hs,{className:Oe({"animate-spin":n})})}),e(Y,{colorScheme:"primary",size:"sm",onClick:()=>i(!0),px:5,children:a("createUser")})]})})]})},Vs="https://github.com/Gozargah/Marzban",Vo="https://github.com/Gozargah",qo="https://github.com/Gozargah/Marzban#donation",qs=t=>{const{version:n}=W();return e(g,{w:"full",py:"0",position:"relative",...t,children:r(b,{display:"inline-block",flexGrow:1,textAlign:"center",color:"gray.500",fontSize:"xs",children:[e(Ur,{color:"blue.400",href:Vs,children:"Marzban"}),n?` (v${n}), `:", ","Made with \u2764\uFE0F in"," ",e(Ur,{color:"blue.400",href:Vo,children:"Gozargah"})]})})},Yo=v(wn,{baseStyle:{w:4,h:4}}),Ys=({actions:t})=>{const{i18n:n}=X();var s=o=>{n.changeLanguage(o)};return r(ds,{placement:"bottom-end",children:[e(us,{as:q,size:"sm",variant:"outline",icon:e(Yo,{}),position:"relative"}),r(hs,{minW:"100px",className:"menuList",zIndex:99999,children:[e(Ge,{maxW:"100px",fontSize:"sm",onClick:()=>s("en"),children:"English"}),e(Ge,{maxW:"100px",fontSize:"sm",onClick:()=>s("fa"),children:"\u0641\u0627\u0631\u0633\u06CC"}),e(Ge,{maxW:"100px",fontSize:"sm",onClick:()=>s("zh-cn"),children:"\u7B80\u4F53\u4E2D\u6587"})]})]})},$e={baseStyle:{w:4,h:4}},Zo=v(kn,$e),Qo=v(vn,$e),Xo=v(Sr,$e),Jo=v(wr,$e),Ko=v(zn,$e),el=v(In,$e),tl=v(tr,$e),rl=v(ps,$e),sl=v(er,$e),nl=v(ms,$e),ol=v(kr,$e),Br=v(j,{baseStyle:{bg:"yellow.500",w:"2",h:"2",rounded:"full",position:"absolute"}}),Gr="marzban-menu-notification",ll=({actions:t})=>{const{onEditingHosts:n,onResetAllUsage:s,onEditingNodes:o,onShowingNodesUsage:l,onEditingSubscription:i}=W(),{t:a}=X(),{colorMode:f,toggleColorMode:x}=kt(),[w,d]=m.exports.useState(localStorage.getItem(Gr)),h=f==="dark"?"dark_dimmed":f,_=()=>{localStorage.setItem(Gr,"true"),d("true")};return r(g,{gap:2,justifyContent:"space-between",__css:{"& .menuList":{direction:"ltr"}},children:[e(b,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:a("users")}),e(j,{overflow:"auto",css:{direction:"rtl"},children:r(g,{alignItems:"center",children:[r(ds,{onClose:_,children:[e(us,{as:q,size:"sm",variant:"outline",icon:r(Xe,{children:[e(Jo,{}),!w&&e(Br,{top:"-1",right:"-1"})]}),position:"relative"}),r(hs,{minW:"170px",zIndex:99999,className:"menuList",children:[e(Ge,{maxW:"210px",fontSize:"sm",icon:e(tl,{}),onClick:n.bind(null,!0),children:a("header.hostSettings")}),e(Ge,{maxW:"210px",fontSize:"sm",icon:e(rl,{}),onClick:o.bind(null,!0),children:a("header.nodeSettings")}),e(Ge,{maxW:"210px",fontSize:"sm",icon:e(ol,{}),onClick:i.bind(null,!0),children:a("header.subscriptionSetting")}),e(Ge,{maxW:"210px",fontSize:"sm",icon:e(sl,{}),onClick:l.bind(null,!0),children:a("header.nodesUsage")}),e(Ge,{maxW:"210px",fontSize:"sm",icon:e(nl,{}),onClick:s.bind(null,!0),children:a("resetAllUsage")}),e(Fr,{to:qo,target:"_blank",children:r(Ge,{maxW:"210px",fontSize:"sm",icon:e(el,{}),position:"relative",children:[a("header.donation")," ",!w&&e(Br,{top:"3",right:"2"})]})}),e(Fr,{to:"/login",children:e(Ge,{maxW:"210px",fontSize:"sm",icon:e(Ko,{}),children:a("header.logout")})})]})]}),e(q,{size:"sm",variant:"outline","aria-label":"core settings",onClick:()=>{W.setState({isEditingCore:!0})},children:e(Xo,{})}),e(Ys,{}),e(q,{size:"sm",variant:"outline","aria-label":"switch theme",onClick:()=>{Gs(f=="dark"?"light":"dark"),x()},children:f==="light"?e(Zo,{}):e(Qo,{})}),e(j,{css:{direction:"ltr"},display:"flex",alignItems:"center",pr:"2",__css:{"&  span":{display:"inline-flex"}},children:e(_n,{href:Vs,"data-color-scheme":`no-preference: ${h}; light: ${h}; dark: ${h};`,"data-size":"large","data-show-count":"true","aria-label":"Star Marzban on GitHub",children:"Star"})})]})})]})},il=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Zs=[{title:"",value:""},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h2, http/1.1",value:"h2,http/1.1"}],Qs=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],al=[{title:"none",value:""},{title:"xtls-rprx-vision",value:"xtls-rprx-vision"}],cl=["aes-128-gcm","aes-256-gcm","chacha20-poly1305"],dl=Nt(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),B("/hosts").then(n=>t({hosts:n})).finally(()=>t({isLoading:!1}))},setHosts:n=>(t({isPostLoading:!0}),B("/hosts",{method:"PUT",body:n}).finally(()=>{t({isPostLoading:!1})}))}));const ul=v($t,{baseStyle:{w:4,h:4}}),Ze=Zt.forwardRef(({disabled:t,step:n,label:s,className:o,startAdornment:l,endAdornment:i,type:a="text",placeholder:f,onChange:x,onBlur:w,name:d,value:h,onClick:_,error:I,clearable:y=!1,...R},c)=>{const u=()=>{x&&x({target:{value:"",name:d}})},{size:z="md"}=R,P=a=="number"?Tn:Z,N=a=="number"?Rn:Zt.Fragment,k=a=="number"?{keepWithinRange:!0,precision:5,format:S=>isNaN(parseFloat(String(S)))||Number(parseFloat(String(S)).toFixed(5))===0?S:Number(parseFloat(String(S)).toFixed(5)),min:0,step:n,name:d,type:a,placeholder:f,onChange:S=>{x&&x(S)},onBlur:w,value:h,onClick:_,disabled:t,flexGrow:1,size:z}:{};return r(E,{isInvalid:!!I,children:[s&&e(L,{children:s}),r(He,{size:z,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[l&&e(gs,{children:l}),r(N,{...k,children:[e(P,{name:d,ref:c,step:n,className:Oe(o),type:a,placeholder:f,onChange:x,onBlur:w,value:h,onClick:_,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...R,roundedLeft:l?"0":"md",roundedRight:i?"0":"md"}),a=="number"&&e(Xe,{children:r(Dn,{children:[e(En,{}),e(Pn,{})]})})]}),i&&e(fs,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),y&&h&&h.length&&e(Ve,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:u,cursor:"pointer",children:e(ul,{})})]}),!!I&&e(Te,{children:I})]})}),dr=v(pe,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),Et=v(Ze,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),hl=v(tr,{baseStyle:{w:5,h:5}}),ft=v(rr,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),pl=T.record(T.string().min(1),T.array(T.object({remark:T.string().min(1,"Remark is required"),address:T.string().min(1,"Address is required"),port:T.string().or(T.number()).nullable().transform(t=>typeof t=="number"?t:t!==null&&!isNaN(parseInt(t))?Number(parseInt(t)):null),sni:T.string().nullable(),host:T.string().nullable(),security:T.string(),alpn:T.string(),fingerprint:T.string()}))),Ht=v(Te,{baseStyle:{color:"red.400",display:"block",textAlign:"left",w:"100%"}}),ml=({hostKey:t,isOpen:n,toggleAccordion:s})=>{const{inbounds:o}=W(),l=[...o.values()].flat().filter(I=>I.tag===t)[0],i=vr(),{fields:a,append:f,remove:x}=An({control:i.control,name:t}),{errors:w}=i.formState,{t:d}=X(),h=w[t],_=()=>{f({host:"",sni:"",port:null,address:"",remark:"",security:"inbound_default",alpn:"",fingerprint:""})};return m.exports.useEffect(()=>{h&&!n&&s()},[h]),r(Je,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[r(Ke,{px:2,borderRadius:"3px",onClick:s,children:[e(b,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:t}),e(Ct,{})]}),e(et,{px:2,pb:2,children:r(O,{gap:3,children:[a.map((I,y)=>{var R,c,u,z,P,N,k,S,p,C,U,J,H,G,re,A,ne;return r(O,{border:"1px solid",_dark:{borderColor:"gray.600",bg:"#273142"},_light:{borderColor:"gray.200",bg:"#fcfbfb"},p:2,w:"full",borderRadius:"4px",children:[e(g,{w:"100%",alignItems:"flex-start",children:r(E,{position:"relative",zIndex:10,isInvalid:!!(h&&((R=h[y])==null?void 0:R.remark)),children:[r(He,{children:[e(Et,{...i.register(t+"."+y+".remark"),size:"sm",borderRadius:"4px",placeholder:"Remark"}),e(Ve,{children:r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(j,{mt:"-8px",children:e(ft,{})})}),e(mt,{children:r(Ue,{children:[e(Fe,{}),e(gt,{}),e(Mr,{children:r(j,{fontSize:"xs",children:[e(b,{pr:"20px",children:d("hostsDialog.desc")}),r(b,{children:[r(le,{children:["{","SERVER_IP","}"]})," ",d("hostsDialog.currentServer")]}),r(b,{mt:1,children:[r(le,{children:["{","USERNAME","}"]})," ",d("hostsDialog.username")]}),r(b,{mt:1,children:[r(le,{children:["{","DATA_USAGE","}"]})," ",d("hostsDialog.dataUsage")]}),r(b,{mt:1,children:[r(le,{children:["{","DATA_LEFT","}"]})," ",d("hostsDialog.remainingData")]}),r(b,{mt:1,children:[r(le,{children:["{","DATA_LIMIT","}"]})," ",d("hostsDialog.dataLimit")]}),r(b,{mt:1,children:[r(le,{children:["{","DAYS_LEFT","}"]})," ",d("hostsDialog.remaingDays")]}),r(b,{mt:1,children:[r(le,{children:["{","PROTOCOL","}"]})," ",d("hostsDialog.proxyProtocol")]}),r(b,{mt:1,children:[r(le,{children:["{","TRANSPORT","}"]})," ",d("hostsDialog.proxyMethod")]})]})})]})})]})})]}),h&&((c=h[y])==null?void 0:c.remark)&&e(Ht,{children:(z=(u=h[y])==null?void 0:u.remark)==null?void 0:z.message})]})}),r(E,{isInvalid:!!(h&&((P=h[y])==null?void 0:P.address)),children:[r(He,{children:[e(Et,{size:"sm",borderRadius:"4px",placeholder:"Address (e.g. example.com)",...i.register(t+"."+y+".address")}),e(Ve,{children:r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(j,{mt:"-8px",children:e(ft,{})})}),e(mt,{children:r(Ue,{children:[e(Fe,{}),e(gt,{}),e(Mr,{children:r(j,{fontSize:"xs",children:[e(b,{pr:"20px",children:d("hostsDialog.desc")}),r(b,{children:[r(le,{children:["{","SERVER_IP","}"]})," ",d("hostsDialog.currentServer")]}),r(b,{mt:1,children:[r(le,{children:["{","USERNAME","}"]})," ",d("hostsDialog.username")]}),r(b,{mt:1,children:[r(le,{children:["{","DATA_USAGE","}"]})," ",d("hostsDialog.dataUsage")]}),r(b,{mt:1,children:[r(le,{children:["{","DATA_LEFT","}"]})," ",d("hostsDialog.remainingData")]}),r(b,{mt:1,children:[r(le,{children:["{","DATA_LIMIT","}"]})," ",d("hostsDialog.dataLimit")]}),r(b,{mt:1,children:[r(le,{children:["{","DAYS_LEFT","}"]})," ",d("hostsDialog.remaingDays")]}),r(b,{mt:1,children:[r(le,{children:["{","PROTOCOL","}"]})," ",d("hostsDialog.proxyProtocol")]}),r(b,{mt:1,children:[r(le,{children:["{","TRANSPORT","}"]})," ",d("hostsDialog.proxyMethod")]})]})})]})})]})})]}),h&&((N=h[y])==null?void 0:N.address)&&e(Ht,{children:(S=(k=h[y])==null?void 0:k.address)==null?void 0:S.message})]}),e(at,{w:"full",allowToggle:!0,children:r(Je,{border:"0",children:[r(Ke,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:[r(b,{fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[d("hostsDialog.advancedOptions"),e(Ct,{fontSize:"sm",ml:1})]}),e(me,{label:"Delete",placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",colorScheme:"red",variant:"ghost",onClick:x.bind(null,y),children:e(tt,{})})})]}),e(et,{w:"full",p:1,children:r(O,{w:"full",borderRadius:"4px",children:[r(E,{isInvalid:!!(h&&((p=h[y])==null?void 0:p.port)),children:[r(L,{display:"flex",pb:1,alignItems:"center",justifyContent:"space-between",gap:1,m:"0",children:[e("span",{children:d("hostsDialog.port")}),r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ft,{})}),e(mt,{children:r(Ue,{p:2,children:[e(Fe,{}),e(gt,{}),e(b,{fontSize:"xs",pr:5,children:d("hostsDialog.port.info")})]})})]})]}),e(Et,{size:"sm",borderRadius:"4px",placeholder:String(l.port||"8080"),type:"number",...i.register(t+"."+y+".port")})]}),r(E,{isInvalid:!!(h&&((C=h[y])==null?void 0:C.sni)),children:[r(L,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:d("hostsDialog.sni")}),r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ft,{})}),e(mt,{children:r(Ue,{p:2,children:[e(Fe,{}),e(gt,{}),e(b,{fontSize:"xs",pr:5,children:d("hostsDialog.sni.info")}),e(b,{fontSize:"xs",mt:"2",children:e(Ye,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(le,{})}})}),e(b,{fontSize:"xs",children:e(Ye,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(le,{})}})})]})})]})]}),e(Et,{size:"sm",borderRadius:"4px",placeholder:"SNI (e.g. example.com)",...i.register(t+"."+y+".sni")}),h&&((U=h[y])==null?void 0:U.sni)&&e(Ht,{children:(H=(J=h[y])==null?void 0:J.sni)==null?void 0:H.message})]}),r(E,{isInvalid:!!(h&&((G=h[y])==null?void 0:G.host)),children:[r(L,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:d("hostsDialog.host")}),r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ft,{})}),e(mt,{children:r(Ue,{p:2,children:[e(Fe,{}),e(gt,{}),e(b,{fontSize:"xs",pr:5,children:d("hostsDialog.host.info")}),e(b,{fontSize:"xs",mt:"2",children:e(Ye,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(le,{})}})}),e(b,{fontSize:"xs",children:e(Ye,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(le,{})}})})]})})]})]}),e(Et,{size:"sm",borderRadius:"4px",placeholder:"Host (e.g. example.com)",...i.register(t+"."+y+".host")}),h&&((re=h[y])==null?void 0:re.host)&&e(Ht,{children:(ne=(A=h[y])==null?void 0:A.host)==null?void 0:ne.message})]}),r(E,{height:"66px",children:[r(L,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:d("hostsDialog.security")}),r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ft,{})}),e(mt,{children:r(Ue,{p:2,children:[e(Fe,{}),e(gt,{}),e(b,{fontSize:"xs",pr:5,children:d("hostsDialog.security.info")})]})})]})]}),e(dr,{size:"sm",...i.register(t+"."+y+".security"),children:il.map(V=>e("option",{value:V.value,children:V.title},V.value))})]}),r(E,{height:"66px",children:[e(L,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:d("hostsDialog.alpn")})}),e(dr,{size:"sm",...i.register(t+"."+y+".alpn"),children:Zs.map(V=>e("option",{value:V.value,children:V.title},V.value))})]}),r(E,{height:"66px",children:[e(L,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:d("hostsDialog.fingerprint")})}),e(dr,{size:"sm",...i.register(t+"."+y+".fingerprint"),children:Qs.map(V=>e("option",{value:V.value,children:V.title},V.value))})]})]},y)})]})})]},y)}),e(Y,{variant:"outline",w:"full",size:"sm",color:"",fontWeight:"normal",onClick:_,children:d("hostsDialog.addHost")})]})})]})},gl=()=>{const{isEditingHosts:t,onEditingHosts:n,refetchUsers:s,inbounds:o}=W(),{isLoading:l,hosts:i,fetchHosts:a,isPostLoading:f,setHosts:x}=dl(),w=De(),{t:d}=X(),[h,_]=m.exports.useState({});m.exports.useEffect(()=>{t&&a()},[t]);const I=qe({resolver:it(pl)});m.exports.useEffect(()=>{i&&t&&I.reset(i)},[i]);const y=()=>{_({}),n(!1)},R=u=>{x(u).then(()=>{w({title:d("hostsDialog.savedSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3}),s()}).catch(z=>{var P,N,k,S,p;(((P=z==null?void 0:z.response)==null?void 0:P.status)===409||((N=z==null?void 0:z.response)==null?void 0:N.status)===400)&&w({title:(S=(k=z.response)==null?void 0:k._data)==null?void 0:S.detail,status:"error",isClosable:!0,position:"top",duration:3e3}),((p=z==null?void 0:z.response)==null?void 0:p.status)===422&&Object.keys(z.response._data.detail).forEach(C=>{w({title:z.response._data.detail[C]+" ("+C+")",status:"error",isClosable:!0,position:"top",duration:3e3})})})},c=u=>{h[String(u)]?delete h[String(u)]:h[String(u)]={},_({...h})};return r(be,{isOpen:t,onClose:y,children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(Se,{pt:6,children:e(ke,{color:"primary",children:e(hl,{color:"white"})})}),e(Ce,{mt:3}),e(we,{w:"440px",pb:3,pt:3,children:e(zt,{...I,children:r("form",{onSubmit:I.handleSubmit(R),children:[e(b,{mb:3,opacity:.8,fontSize:"sm",children:d("hostsDialog.title")}),l&&d("hostsDialog.loading"),!l&&i&&(Object.keys(i).length>0?e(at,{w:"full",allowToggle:!0,allowMultiple:!0,index:Object.keys(h).map(u=>parseInt(u)),children:e(O,{w:"full",children:Object.keys(i).map((u,z)=>e(ml,{toggleAccordion:()=>c(z),isOpen:h[String(z)],hostKey:u},u))})}):"No inbound found. Please check your Xray config file."),e(g,{justifyContent:"flex-end",py:2,children:e(Y,{variant:"solid",mt:"2",type:"submit",colorScheme:"primary",size:"sm",px:5,isLoading:f,disabled:f,children:d("hostsDialog.apply")})})]})})})]})]})},Xs=T.object({name:T.string().min(1),address:T.string().min(1),port:T.number().min(1).or(T.string().transform(t=>parseFloat(t))),api_port:T.number().min(1).or(T.string().transform(t=>parseFloat(t))),xray_version:T.string().nullable().optional(),certificate:T.string().min(1),id:T.number().nullable().optional(),status:T.enum(["connected","connecting","error","disabled"]).nullable().optional(),message:T.string().nullable().optional(),add_as_new_host:T.boolean().optional()}),fl=()=>({name:"",address:"",port:62050,api_port:62051,certificate:"",xray_version:""}),Mt="fetch-nodes-query-key",bl=()=>{const{isEditingNodes:t}=W();return ls({queryKey:Mt,queryFn:Bt.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},Bt=Nt((t,n)=>({nodes:[],addNode(s){return B("/node",{method:"POST",body:s})},fetchNodes(){return B("/nodes")},fetchNodesUsage(s){return B("/nodes/usage",{query:s})},updateNode(s){return B(`/node/${s.id}`,{method:"PUT",body:s})},setDeletingNode(s){t({deletingNode:s})},reconnectNode(s){return B(`/node/${s.id}/reconnect`,{method:"POST"})},deleteNode:()=>{var s;return B(`/node/${(s=n().deletingNode)==null?void 0:s.id}`,{method:"DELETE"})}})),Rr=(t,n,s)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return n({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&s){Object.keys(t.response._data.detail).forEach(o=>s.setError(o,{message:t.response._data.detail[o]}));return}}return n({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Dr=(t,n)=>n({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),xl=({deleteCallback:t})=>{const{deleteNode:n,deletingNode:s,setDeletingNode:o}=Bt(),{t:l}=X(),i=De(),a=zr(),f=()=>{o(null)},{isLoading:x,mutate:w}=At(n,{onSuccess:()=>{Dr(l("deleteNode.deleteSuccess",{name:s&&s.name}),i),o(null),a.invalidateQueries(Mt),t&&t()},onError:d=>{Rr(d,i)}});return r(be,{isCentered:!0,isOpen:!!s,onClose:f,size:"sm",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",children:[e(Se,{pt:6,children:e(ke,{color:"red",children:e(tt,{})})}),e(Ce,{mt:3}),r(we,{children:[e(b,{fontWeight:"semibold",fontSize:"lg",children:l("deleteNode.title")}),s&&e(b,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ye,{components:{b:e("b",{})},children:l("deleteNode.prompt",{name:s.name})})})]}),r(Ee,{display:"flex",children:[e(Y,{size:"sm",onClick:f,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:"red",onClick:()=>w(),leftIcon:x?e(Re,{size:"xs"}):void 0,children:l("delete")})]})]})]})},sr={baseStyle:{strokeWidth:"2px",w:4,h:4}},Hr=v(Ln,sr),yl=v(Un,sr),Vr=v(bs,sr),qr=v(Fn,sr),br=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],Tt={active:{statusColor:"green",bandWidthColor:"primary",icon:Hr},connected:{statusColor:"green",bandWidthColor:"primary",icon:Hr},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:yl},expired:{statusColor:"orange",bandWidthColor:"orange",icon:qr},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:qr},limited:{statusColor:"red",bandWidthColor:"red",icon:Vr},error:{statusColor:"red",bandWidthColor:"red",icon:Vr}},Js=t=>{let n={status:"",time:""};if(t){ae(t*1e3).utc().isAfter(ae().utc())?n.status="expires":n.status="expired";const s=[],o=ae.duration(ae(t*1e3).utc().diff(ae()));o.years()!=0&&s.push(Math.abs(o.years())+" year"+(Math.abs(o.years())!=1?"s":"")),o.months()!=0&&s.push(Math.abs(o.months())+" month"+(Math.abs(o.months())!=1?"s":"")),o.days()!=0&&s.push(Math.abs(o.days())+" day"+(Math.abs(o.days())!=1?"s":"")),s.length===0&&(o.hours()!=0&&s.push(Math.abs(o.hours())+" hour"+(Math.abs(o.hours())!=1?"s":"")),o.minutes()!=0&&s.push(Math.abs(o.minutes())+" min"+(Math.abs(o.minutes())!=1?"s":""))),n.time=s.join(", "),Yt.language.toLocaleLowerCase()==="zh-cn"&&(n.time=n.time.replace(/year[s]?/,"\u5E74"),n.time=n.time.replace(/month[s]?/,"\u4E2A\u6708"),n.time=n.time.replace(/day[s]?/,"\u5929"),n.time=n.time.replace(/hour[s]?/,"\u5C0F\u65F6"),n.time=n.time.replace(/min[s]?/,"\u5206\u949F"),n.time=n.time.replace(/,/g,""),n.status=="expires"?n.time+="\u5185":n.time+="\u524D")}return n},qt=({expiryDate:t,status:n,compact:s=!1,showDetail:o=!0,extraText:l})=>{const{t:i}=X(),a=Js(t),f=Tt[n].icon;return r(Xe,{children:[r(le,{colorScheme:Tt[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:s?1:2,alignItems:"center",children:[e(f,{w:s?3:4}),o&&r(b,{textTransform:"capitalize",fontSize:s?".7rem":".875rem",lineHeight:s?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[n,l&&`: ${l}`]})]}),o&&t&&e(b,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},Sl=v($t,{baseStyle:{w:4,h:4}}),Cl=Zt.forwardRef(({disabled:t,step:n,label:s,className:o,startAdornment:l,endAdornment:i,placeholder:a,onChange:f,onBlur:x,name:w,value:d,onClick:h,error:_,clearable:I=!1,...y},R)=>{const c=()=>{f&&f({target:{value:"",name:w}})},{size:u="md"}=y;return r(E,{isInvalid:!!_,children:[s&&e(L,{children:s}),r(He,{size:u,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[l&&e(gs,{children:l}),e(Mn,{name:w,ref:R,step:n,className:Oe(o),placeholder:a,onChange:f,onBlur:x,value:d,onClick:h,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...y,roundedLeft:l?"0":"md",roundedRight:i?"0":"md"}),i&&e(fs,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),I&&d&&d.length&&e(Ve,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:c,cursor:"pointer",children:e(Sl,{})})]}),!!_&&e(Te,{children:_})]})}),Vt=v(Ze,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),wl=v(ps,{baseStyle:{w:5,h:5}}),kl=v(jt,{baseStyle:{w:5,h:5,strokeWidth:2}});v(rr,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}});v(Te,{baseStyle:{color:"red.400",display:"block",textAlign:"left",w:"100%"}});const vl=({toggleAccordion:t,node:n})=>{const{updateNode:s,reconnectNode:o,setDeletingNode:l}=Bt(),{t:i}=X(),a=zr(),f=De(),x=qe({defaultValues:n,resolver:it(Xs)}),w=l.bind(null,n),{isLoading:d,mutate:h}=At(s,{onSuccess:()=>{Dr("Node updated successfully",f),a.invalidateQueries(Mt)},onError:R=>{Rr(R,f,x)}}),{isLoading:_,mutate:I}=At(o.bind(null,n),{onSuccess:()=>{a.invalidateQueries(Mt)}}),y=_?"connecting":n.status?n.status:"error";return r(Je,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[r(Ke,{px:2,borderRadius:"3px",onClick:t,children:[r(g,{w:"full",justifyContent:"space-between",pr:2,children:[e(b,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:n.name}),r(g,{children:[n.xray_version&&e(le,{colorScheme:"blue",rounded:"full",display:"inline-flex",px:3,py:1,children:r(b,{textTransform:"capitalize",fontSize:"0.7rem",fontWeight:"medium",letterSpacing:"tighter",children:["Xray ",n.xray_version]})}),n.status&&e(qt,{status:y,compact:!0})]})]}),e(Ct,{})]}),r(et,{px:2,pb:2,children:[e(O,{pb:3,alignItems:"flex-start",children:y==="error"&&e(ot,{status:"error",size:"xs",children:r(j,{children:[r(g,{w:"full",children:[e(lt,{w:4}),e(b,{marginInlineEnd:0,children:n.message})]}),e(g,{justifyContent:"flex-end",w:"full",children:e(Y,{size:"sm","aria-label":"reconnect node",leftIcon:e(Hs,{}),onClick:()=>I(),disabled:_,children:i(_?"nodes.reconnecting":"nodes.reconnect")})})]})})}),e(Ks,{form:x,mutate:h,isLoading:d,isMaster:n.id==0,submitBtnText:i("nodes.editNode"),btnLeftAdornment:e(me,{label:i("delete"),placement:"top",children:e(q,{colorScheme:"red",variant:"ghost",size:"sm","aria-label":"delete node",onClick:w,children:e(tt,{})})})})]})]})},zl=({toggleAccordion:t,resetAccordions:n})=>{const s=De(),{t:o}=X(),l=zr(),{addNode:i}=Bt(),a=qe({resolver:it(Xs),defaultValues:{...fl(),add_as_new_host:!0}}),{isLoading:f,mutate:x}=At(i,{onSuccess:()=>{Dr(o("nodes.addNodeSuccess",{name:a.getValues("name")}),s),l.invalidateQueries(Mt),a.reset(),n()},onError:w=>{Rr(w,s,a)}});return r(Je,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[e(Ke,{px:2,borderRadius:"3px",onClick:t,children:r(b,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},display:"flex",gap:1,children:[e(kl,{display:"inline-block"})," ",e("span",{children:o("nodes.addNewMarzbanNode")})]})}),e(et,{px:2,py:4,children:e(Ks,{form:a,mutate:x,isLoading:f,submitBtnText:o("nodes.addNode"),btnProps:{variant:"solid"},addAsHost:!0})})]})},Ks=({form:t,mutate:n,isLoading:s,isMaster:o=!1,submitBtnText:l,btnProps:i={},btnLeftAdornment:a,addAsHost:f=!1})=>{var w,d,h,_,I,y,R,c,u,z,P,N,k,S,p;const{t:x}=X();return e("form",{onSubmit:t.handleSubmit(C=>n(C)),children:r(O,{children:[e(E,{children:e(Vt,{label:x("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...t.register("name"),error:(h=(d=(w=t.formState)==null?void 0:w.errors)==null?void 0:d.name)==null?void 0:h.message,disabled:o})}),r(g,{alignItems:"flex-start",children:[e(j,{w:"50%",children:e(Vt,{label:x("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...t.register("address"),error:(y=(I=(_=t.formState)==null?void 0:_.errors)==null?void 0:I.address)==null?void 0:y.message,disabled:o})}),e(j,{w:"25%",children:e(Vt,{label:x("nodes.nodePort"),size:"sm",placeholder:"62050",...t.register("port"),error:(u=(c=(R=t.formState)==null?void 0:R.errors)==null?void 0:c.port)==null?void 0:u.message,disabled:o})}),e(j,{w:"25%",children:e(Vt,{label:x("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...t.register("api_port"),error:(N=(P=(z=t.formState)==null?void 0:z.errors)==null?void 0:P.api_port)==null?void 0:N.message,disabled:o})})]}),!o&&r(E,{children:[e(L,{children:x("nodes.certificate")}),e(Cl,{...t.register("certificate"),w:"full",fontSize:"10px",fontFamily:"monospace",overflowWrap:"normal",noOfLines:10,rows:10,error:(p=(S=(k=t.formState)==null?void 0:k.errors)==null?void 0:S.certificate)==null?void 0:p.message,placeholder:`-----BEGIN CERTIFICATE----- XzBWUjjMrWf/0rWV5fDl7b4RU8AjeviG1RmEc64ueZ3s6q1LI6DJX1+qGuqDEvp g1gctfdLMARuV6LkLiGy5k2FGAW/tfepEyySA/N9WhcHg+rZ4/x1thP0eYJPQ2YJ XFSa6Zv8LPLCz5iMbo0FjNlKyZo3699PtyBFXt3zyfTPmiy19RVGTziHqJ9NR9kW kBwvFzIy+qPc/dJAk435hVaV3pRBC7Pl2Y7k/pJxxlC07PkACXuhwtUGhQrHYWkK Il8rJ9cs0zwC1BOmqoS3Ez22dgtT7FucvIJ1MGP8oUAudMmrXDxx/d7CmnD5q1v4 iLlV21kNnWuvjS1orTwvuW3aagb6tvEEEmlMhw5a2B8sl71sQ6sxWidgRaOSGW7l emFyZ2FoMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA0BvDh0eU78EJ AjimHyBb+3tFs7KaOPu9G5xgbQWUWccukMDXqybqiUDSfU/T5/+XM8CKq/Fu0DB=
-----END CERTIFICATE-----`,overflow:"auto"})]}),f&&e(E,{py:1,children:e(xs,{...t.register("add_as_new_host"),children:e(L,{m:0,children:x("nodes.addHostForEveryInbound")})})}),!o&&r(g,{w:"full",children:[a,e(Y,{flexGrow:1,type:"submit",colorScheme:"primary",size:"sm",px:5,w:"full",isLoading:s,...i,children:l})]})]})})},Il=()=>{const{isEditingNodes:t,onEditingNodes:n}=W(),{t:s}=X(),[o,l]=m.exports.useState({}),{data:i,isLoading:a}=bl(),f=()=>{l({}),n(!1)},x=w=>{o[String(w)]?delete o[String(w)]:o[String(w)]={},l({...o})};return r(Xe,{children:[r(be,{isOpen:t,onClose:f,children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(Se,{pt:6,children:e(ke,{color:"primary",children:e(wl,{color:"white"})})}),e(Ce,{mt:3}),r(we,{w:"440px",pb:6,pt:3,children:[e(b,{mb:3,opacity:.8,fontSize:"sm",children:s("nodes.title")}),a&&"loading...",e(at,{w:"full",allowToggle:!0,index:Object.keys(o).map(w=>parseInt(w)),children:r(O,{w:"full",children:[!a&&i.map((w,d)=>e(vl,{toggleAccordion:()=>x(d),node:w},w.name)),e(zl,{toggleAccordion:()=>x((i||[]).length),resetAccordions:()=>l({})})]})})]})]})]}),e(xl,{deleteCallback:()=>l({})})]})};function _l(t){const n=360/t,s=90,o=47,l=[];for(let i=0;i<t;i++){const a=i*n%360+140,f=Rl(a,s,o);l.push(f)}return l}function Rl(t,n,s){t/=360,n/=100,s/=100;let o,l,i;if(n===0)o=l=i=s;else{const f=(d,h,_)=>(_<0&&(_+=1),_>1&&(_-=1),_<.16666666666666666?d+(h-d)*6*_:_<.5?h:_<.6666666666666666?d+(h-d)*(.6666666666666666-_)*6:d),x=s<.5?s*(1+n):s+n-s*n,w=2*s-x;o=Math.round(f(w,x,t+1/3)*255),l=Math.round(f(w,x,t)*255),i=Math.round(f(w,x,t-1/3)*255)}const a=f=>{const x=f.toString(16);return x.length===1?"0"+x:x};return`#${a(o)}${a(l)}${a(i)}`}const Yr=({border:t,...n})=>{const{getInputProps:s,getRadioProps:o}=On(n),l=ht({base:"xs",md:"sm"});return r(j,{as:"label",children:[e("input",{...s()}),e(j,{...o(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:l,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:n.children})]})},en=({onChange:t,defaultValue:n,...s})=>{const{t:o,i18n:l}=X();kt();const i=ht({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),a={h:"hour",d:"day",w:"week",m:"month",y:"year"},f=ht({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:x,getRadioProps:w,setValue:d}=Nn({name:"filter",defaultValue:n,onChange:G=>{if(G==="custom")return;I(),i.indexOf(G)>=0?(c(o("userDialog.custom")),z(!1)):(c(o("userDialog.custom")+` (${G})`),z(!0));const re=Number(G.substring(0,G.length-1)),A=a[G[G.length-1]];t(G,{start:ae().utc().subtract(re,A).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:h,onOpen:_,onClose:I}=ys(),y=m.exports.useRef(null);Wn({ref:y,handler:I});const[R,c]=m.exports.useState(o("userDialog.custom")),[u,z]=m.exports.useState(!1),[P,N]=m.exports.useState(0),k=ht({base:1,md:2}),S=ht({base:"xs",md:"sm"}),[p,C]=m.exports.useState(null),[U,J]=m.exports.useState(null),H=G=>{const[re,A]=G;U&&!A?(C(null),J(null)):(C(re),J(A),re&&A&&(I(),t("custom",{start:ae(re).format("YYYY-MM-DDT00:00:00"),end:ae(A).format("YYYY-MM-DDT23:59:59")})))};return r(O,{...s,children:[P==0&&r(pt,{...x(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[i.map(G=>e(Yr,{...w({value:G}),children:G},G)),e(j,{onClick:()=>{C(null),J(null),_()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:S,px:3,py:1,bg:u?"primary.500":"unset",color:u?"white":"unset",borderColor:u?"primary.500":"unset",children:r(g,{children:[e(b,{children:R}),e(ar,{as:Nr,boxSize:"18px"})]})})]}),P==1&&r(g,{onClick:_,cursor:"pointer",fontSize:S,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(b,{w:"full",color:p?"unset":"gray.500",children:p?ae(p).format("YYYY-MM-DD (00:00)"):o("userDialog.startDate")}),e(ar,{as:Ss,boxSize:"18px"}),e(b,{w:"full",color:U?"unset":"gray.500",children:U?ae(U).format("YYYY-MM-DD (23:59)"):o("userDialog.endDate")}),e(ar,{as:Nr,boxSize:"18px"})]}),e(O,{ref:y,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:h?"unset":"none",children:r(Cs,{onChange:G=>N(G),children:[r(ws,{children:[e(yt,{fontSize:S,children:o("userDialog.relative")}),e(yt,{fontSize:S,children:o("userDialog.absolute")})]}),r(ks,{children:[e(St,{children:f.map(G=>e(O,{alignItems:"start",pl:2,pr:2,children:r(g,{justifyItems:"flex-start",mb:4,children:[e(b,{fontSize:S,minW:"60px",children:o("userDialog."+G.title)}),G.options.map(re=>e(Yr,{border:!0,...w({value:re}),children:re},re+".custom"))]})},G.title))}),e(St,{className:"datepicker-panel",children:e(O,{children:e(vs,{locale:l.language.toLocaleLowerCase(),selected:p,onChange:H,startDate:p,endDate:U,selectsRange:!0,maxDate:new Date,monthsShown:k,peekNextMonth:!1,inline:!0})})})]})]})})]})};function Xt(t,n,s=[],o=[]){const l=We(s.reduce((i,a)=>i+=a,0));return{series:s,options:{labels:o,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${n}${l}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(i,{seriesIndex:a,w:f})=>We(f.config.series[a],1)},tooltip:{custom:({series:i,seriesIndex:a,dataPointIndex:f,w:x})=>{const w=We(i[a],1),d=Math.max(i.reduce((_,I)=>_+=I),1),h=Math.round(i[a]/d*1e3)/10+"%";return`
            <div style="
                    background-color: ${x.globals.colors[a]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${x.config.labels[a]}: <b>${h}, ${w}</b>
            </div>
          `}},colors:_l(s.length)}}}const Dl=v(er,{baseStyle:{w:5,h:5}}),El=()=>{const{isShowingNodesUsage:t,onShowingNodesUsage:n}=W(),{fetchNodesUsage:s}=Bt(),{t:o}=X(),[l,i]=m.exports.useState(!1),{colorMode:a}=kt(),f=o("userDialog.total"),[x,w]=m.exports.useState(Xt(a,f)),[d,h]=m.exports.useState("1m"),_=R=>{s(R).then(c=>{const u=[],z=[];for(const P in c.usages){const N=c.usages[P];z.push(N.uplink+N.downlink),u.push(N.node_name)}w(Xt(a,f,z,u))})};m.exports.useEffect(()=>{t&&_({start:ae().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})},[t]);const I=()=>{n(!1),h("1m")},y=l;return r(be,{isOpen:t,onClose:I,size:"2xl",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",w:"full",children:[e(Se,{pt:6,children:r(g,{gap:2,children:[e(ke,{color:"primary",children:e(Dl,{color:"white"})}),e(b,{fontWeight:"semibold",fontSize:"lg",children:o("header.nodesUsage")})]})}),e(Ce,{mt:3,disabled:y}),e(we,{children:r(O,{gap:4,children:[e(en,{defaultValue:d,onChange:(R,c)=>{h(R),_(c)}}),e(j,{justifySelf:"center",w:"full",maxW:"300px",mt:"4",children:e(m.exports.Suspense,{fallback:e(as,{isIndeterminate:!0}),children:e(zs,{options:x.options,series:x.series,type:"donut",height:"500px"})})})]})}),e(Ee,{mt:"3"})]})]})},Zr=v($n),Pl=v(Ss,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Tl=v(jn,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Al=v(Ir,{baseStyle:{w:5,h:5}}),Ll=()=>{const{QRcodeLinks:t,setQRCode:n,setSubLink:s,subscribeUrl:o}=W(),l=t!==null,[i,a]=m.exports.useState(0),{t:f}=X(),x=()=>{n(null),s(null)},w=String(o).startsWith("/")?window.location.origin+o:String(o);return r(be,{isOpen:l,onClose:x,children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(Se,{pt:6,children:e(ke,{color:"primary",children:e(Al,{color:"white"})})}),e(Ce,{mt:3}),t&&r(we,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[o&&r(O,{children:[e(Zr,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:w,bg:"white"}),e(b,{display:"block",textAlign:"center",pb:3,mt:1,children:f("qrcodeDialog.sublink")})]}),r(j,{w:"300px",children:[e(Bn,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:a,onInit:()=>a(0),nextArrow:e(q,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(Pl,{})}),prevArrow:e(q,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(Tl,{})}),children:t.map((d,h)=>e(g,{children:e(Zr,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:d,bg:"white"})},h))}),r(b,{display:"block",textAlign:"center",pb:3,mt:1,children:[i+1," / ",t.length]})]})]})]})]})},Ul=v(ms,{baseStyle:{w:5,h:5}}),Fl=()=>{const[t,n]=m.exports.useState(!1),{isResetingAllUsage:s,onResetAllUsage:o,resetAllUsage:l}=W(),{t:i}=X(),a=De(),f=()=>{o(!1)},x=()=>{n(!0),l().then(()=>{a({title:i("resetAllUsage.success"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:i("resetAllUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)})};return r(be,{isCentered:!0,isOpen:s,onClose:f,size:"sm",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",children:[e(Se,{pt:6,children:e(ke,{color:"red",children:e(Ul,{})})}),e(Ce,{mt:3}),r(we,{children:[e(b,{fontWeight:"semibold",fontSize:"lg",children:i("resetAllUsage.title")}),s&&e(b,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:i("resetAllUsage.prompt")})]}),r(Ee,{display:"flex",children:[e(Y,{size:"sm",onClick:f,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:"red",onClick:x,leftIcon:t?e(Re,{size:"xs"}):void 0,children:i("reset")})]})]})]})},Ml=v(Wt,{baseStyle:{w:5,h:5}}),Nl=()=>{const[t,n]=m.exports.useState(!1),{resetUsageUser:s,resetDataUsage:o}=W(),{t:l}=X(),i=De(),a=()=>{W.setState({resetUsageUser:null})},f=()=>{s&&(n(!0),o(s).then(()=>{i({title:l("resetUserUsage.success",{username:s.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:l("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return r(be,{isCentered:!0,isOpen:!!s,onClose:a,size:"sm",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",children:[e(Se,{pt:6,children:e(ke,{color:"blue",children:e(Ml,{})})}),e(Ce,{mt:3}),r(we,{children:[e(b,{fontWeight:"semibold",fontSize:"lg",children:l("resetUserUsage.title")}),s&&e(b,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ye,{components:{b:e("b",{})},children:l("resetUserUsage.prompt",{username:s.username})})})]}),r(Ee,{display:"flex",children:[e(Y,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:"blue",onClick:f,leftIcon:t?e(Re,{size:"xs"}):void 0,children:l("reset")})]})]})]})},Wl=v(Wt,{baseStyle:{w:5,h:5}}),Ol=()=>{const[t,n]=m.exports.useState(!1),{revokeSubscriptionUser:s,revokeSubscription:o}=W(),{t:l}=X(),i=De(),a=()=>{W.setState({revokeSubscriptionUser:null})},f=()=>{s&&(n(!0),o(s).then(()=>{i({title:l("revokeUserSub.success",{username:s.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:l("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return r(be,{isCentered:!0,isOpen:!!s,onClose:a,size:"sm",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",children:[e(Se,{pt:6,children:e(ke,{color:"blue",children:e(Wl,{})})}),e(Ce,{mt:3}),r(we,{children:[e(b,{fontWeight:"semibold",fontSize:"lg",children:l("revokeUserSub.title")}),s&&e(b,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ye,{components:{b:e("b",{})},children:l("revokeUserSub.prompt",{username:s.username})})})]}),r(Ee,{display:"flex",children:[e(Y,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:"blue",onClick:f,leftIcon:t?e(Re,{size:"xs"}):void 0,children:l("userDialog.revoke")})]})]})]})},$l=t=>m.exports.createElement("svg",{height:60,width:60,viewBox:"0 0 60 60",xmlns:"http://www.w3.org/2000/svg",...t},m.exports.createElement("path",{fill:"#ccc",d:"M30 60a30 30 0 1130-30 30 30 0 01-30 30zm14-34H34V16a4 4 0 00-8 0v10H16a4 4 0 000 8h10v10a4 4 0 008 0V34h10a4 4 0 000-8z"})),ge=Nt((t,n)=>({loading:!1,sublink:null,setSublink:s=>t({sublink:s}),settings:[],editingSetting:null,onEditingSetting:s=>t({editingSetting:s}),fetchSettings:()=>(t({loading:!0}),B("/clash/settings").then(s=>(t({settings:s.data}),s.data)).finally(()=>{t({loading:!1})})),editSetting:s=>B(`/clash/setting/${s.name}`,{method:"PUT",body:s}).then(()=>{t({editingSetting:null}),n().fetchSettings()}),alert:null,onAlert:s=>t({alert:s}),rules:[],totalRules:0,rulesets:[],ruleFilter:{value:"",sort:"-modified_at",limit:10},fetchRules:()=>{var s=n().ruleFilter;for(const o in s)s[o]||delete s[o];return t({loading:!0}),B("/clash/rules",{query:s}).then(o=>(t({rules:o.data,totalRules:o.total}),o.data)).finally(()=>{t({loading:!1})})},fetchRulesets:()=>B("/clash/rulesets").then(s=>(ge.setState({rulesets:s.data}),s.data)),onRuleFilterChange:s=>{t({ruleFilter:{...n().ruleFilter,...s}}),n().fetchRules()},isCreatingRule:!1,editingRule:null,onCreateRule:s=>t({isCreatingRule:s}),onEditingRule:s=>t({editingRule:s}),createRule:s=>B("/clash/rule",{method:"POST",body:s}).then(()=>{t({editingRule:null}),n().fetchRules()}),editRule:s=>B(`/clash/rule/${s.id}`,{method:"PUT",body:s}).then(()=>{t({editingRule:null}),n().fetchRules()}),deleteRule:s=>B(`/clash/rule/${s.id}`,{method:"DELETE"}).then(()=>{t({editingRule:null}),n().fetchRules()}),isCreatingRuleset:!1,editingRuleset:null,onCreateRuleset:s=>t({isCreatingRuleset:s}),onEditingRuleset:s=>t({editingRuleset:s}),createRuleset:s=>B("/clash/ruleset",{method:"POST",body:s}).then(()=>{t({editingRuleset:null}),n().fetchRulesets()}),editRuleset:s=>B(`/clash/ruleset/${s.id}`,{method:"PUT",body:s}).then(()=>{t({editingRuleset:null}),n().fetchRulesets()}),deleteRuleset:s=>B(`/clash/ruleset/${s.id}`,{method:"DELETE"}).then(()=>{t({editingRuleset:null}),n().ruleFilter.ruleset="",n().fetchRulesets(),n().fetchRules()}),proxyTags:[],proxyInbounds:[],proxyBriefs:[],proxies:[],totalProxies:0,proxyFilter:{search:"",sort:"id",limit:10},fetchProxies:()=>{var s=n().proxyFilter;for(const o in s)s[o]||delete s[o];return t({loading:!0}),B("/clash/proxies",{query:s}).then(o=>(t({proxies:o.data,totalProxies:o.total}),o.data)).finally(()=>{t({loading:!1})})},fetchProxyTags:()=>B("/clash/proxy/tags").then(s=>(t({proxyTags:s.data}),s.data)),fetchProxyInbounds:()=>B("/clash/proxy/inbounds").then(s=>(t({proxyInbounds:s.data}),s.data)),fetchProxyBriefs:()=>B("/clash/proxy/briefs").then(s=>(t({proxyBriefs:s.data}),s.data)),onProxyFilterChange:s=>{t({proxyFilter:{...n().proxyFilter,...s}}),n().fetchProxies()},isCreatingProxy:!1,editingProxy:null,duplicatingProxy:null,onCreateProxy:s=>t({isCreatingProxy:s}),onEditingProxy:s=>t({editingProxy:s}),onDuplicatingProxy:s=>{s?(n().onEditingProxy(null),t({duplicatingProxy:s}),n().onCreateProxy(!0)):t({duplicatingProxy:s})},createProxy:s=>B("/clash/proxy",{method:"POST",body:s}).then(()=>{t({editingProxy:null}),n().fetchProxyBriefs(),n().fetchProxyTags(),n().fetchProxies()}),editProxy:s=>B(`/clash/proxy/${s.id}`,{method:"PUT",body:s}).then(()=>{W.getState().refetchUsers(),t({editingProxy:null}),n().fetchProxyBriefs(),n().fetchProxyTags(),n().fetchProxies()}),deleteProxy:s=>B(`/clash/proxy/${s.id}`,{method:"DELETE"}).then(()=>{t({editingProxy:null}),W.getState().refetchUsers(),n().fetchProxyBriefs(),n().fetchProxyTags(),n().fetchProxies()}),proxyGroups:[],totalProxyGroups:0,proxyGroupFilter:{search:"",sort:"id",limit:10},fetchProxyGroups:()=>{var s=n().proxyGroupFilter;for(const o in s)s[o]||delete s[o];return t({loading:!0}),B("/clash/proxy/groups",{query:s}).then(o=>(t({proxyGroups:o.data,totalProxyGroups:o.total}),o.data)).finally(()=>{t({loading:!1})})},onProxyGroupFilterChange:s=>{t({proxyGroupFilter:{...n().proxyGroupFilter,...s}}),n().fetchProxyGroups()},isCreatingProxyGroup:!1,editingProxyGroup:null,duplicatingProxyGroup:null,onCreateProxyGroup:s=>t({isCreatingProxyGroup:s}),onEditingProxyGroup:s=>t({editingProxyGroup:s}),onDuplicatingProxyGroup:s=>{s?(n().onEditingProxyGroup(null),t({duplicatingProxyGroup:s}),n().onCreateProxyGroup(!0)):t({duplicatingProxyGroup:s})},createProxyGroup:s=>B("/clash/proxy/group",{method:"POST",body:s}).then(()=>{t({editingProxyGroup:null}),n().fetchProxyTags(),n().fetchProxyGroups(),n().fetchProxyBriefs()}),editProxyGroup:s=>B(`/clash/proxy/group/${s.id}`,{method:"PUT",body:s}).then(()=>{W.getState().refetchUsers(),t({editingProxyGroup:null}),n().fetchProxyTags(),n().fetchProxyGroups(),n().fetchProxyBriefs()}),deleteProxyGroup:s=>B(`/clash/proxy/group/${s.id}`,{method:"DELETE"}).then(()=>{const o=n().editingProxyGroup;o!=null&&o.tag&&W.getState().refetchUsers(),t({editingProxyGroup:null}),n().fetchProxyTags(),n().fetchProxyGroups(),n().fetchProxyBriefs()})})),Gt=t=>{if(typeof t=="string")try{t=JSON.parse(t)}catch{}return t},jl=v(Gn,{baseStyle:{strokeWidth:"2px",w:5,h:5}}),Bl=({inbound:t,...n})=>{const{getCheckboxProps:s,getInputProps:o,getLabelProps:l,htmlProps:i}=_s(n),a=o();return r(j,{as:"label",children:[e("input",{...a}),r(j,{w:"fll",position:"relative",...i,cursor:"pointer",borderRadius:"sm",border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"gray.600"},display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden",_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent",fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& p":{opacity:1}},__css:{"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...s(),children:[e(xs,{size:"sm",w:"full",maxW:"full",color:"gray.700",_dark:{color:"gray.300"},textTransform:"uppercase",colorScheme:"primary",className:"inbound-item",isChecked:a.checked,pointerEvents:"none",flexGrow:1,children:e(g,{justify:"space-between",w:"full",maxW:"calc(100% - 20px)",spacing:0,gap:2,overflow:"hidden",children:r(b,{isTruncated:!0,...l(),fontSize:"xs",children:[t.tag," ",r(b,{as:"span",children:["(",t.network,")"]})]})})}),t.tls&&t.tls!="none"&&e(le,{fontSize:"xs",opacity:".8",size:"xs",children:t.tls})]})]})},Gl=({disabled:t,title:n,description:s,toggleAccordion:o,isSelected:l,...i})=>{const a=vr(),{inbounds:f}=W(),{getCheckboxProps:x,getInputProps:w,getLabelProps:d,htmlProps:h}=_s(i),_=w(),[I]=Rs({name:[`inbounds.${n}`],control:a.control}),{getCheckboxProps:y}=Is({value:I,onChange:z=>{if(a.setValue(`inbounds.${n}`,z),z.length===0){const P=a.getValues("selected_proxies");a.setValue("selected_proxies",P.filter(N=>N!==n)),o()}}}),R=I&&l&&(W.getState().inbounds.get(n)||[]).length!==I.length,c=(W.getState().inbounds.get(n)||[]).length>0,u=!l&&!c;return r(Je,{isDisabled:!c,borderRadius:"md",borderStyle:"solid",border:"1px",borderColor:"gray.200",bg:u?"gray.100":"transparent",_dark:{borderColor:"gray.600",bg:u?"#364154":"transparent"},_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent"},...x(),children:[r(j,{as:u?"span":"label",position:"relative",children:[R&&e(j,{position:"absolute",w:"2",h:"2",bg:"yellow.500",top:"-1",right:"-1",rounded:"full",zIndex:999}),e("input",{..._}),r(j,{w:"fll",position:"relative",...h,borderRadius:"md",cursor:u?"not-allowed":"pointer",_checked:{fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& > svg":{opacity:1,"&.checked":{display:"block"},"&.unchecked":{display:"none"}},"& p":{opacity:1}},__css:{"& > svg":{opacity:.3,"&.checked":{display:"none"},"&.unchecked":{display:"block"}},"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...x(),children:[e(Ke,{display:_.checked&&c?"block":"none",as:"span",className:"checked",color:"primary.200",position:"absolute",right:"3",top:"3",w:"auto",p:0,onClick:o,children:e(q,{size:"sm","aria-label":"inbound settings",children:e(jl,{})})}),e(b,{fontSize:"sm",color:u?"gray.400":"gray.700",_dark:{color:u?"gray.500":"gray.300"},...d(),children:n}),e(b,{fontWeight:"medium",color:u?"gray.400":"gray.600",_dark:{color:u?"gray.500":"gray.400"},fontSize:"xs",children:s})]})]}),e(et,{px:2,pb:3,roundedBottom:"5px",pt:3,_dark:{bg:_.checked&&"gray.750"},children:r(O,{w:"full",rowGap:2,borderStyle:"solid",borderWidth:"1px",borderRadius:"md",pl:3,pr:3,pt:1.5,_dark:{bg:"gray.700"},children:[r(O,{alignItems:"flex-start",w:"full",children:[e(b,{fontSize:"sm",children:Ie("inbound")}),e(pt,{gap:2,alignItems:"flex-start",w:"full",columns:1,spacing:1,children:(f.get(n)||[]).map(z=>e(Bl,{...y({value:z.tag}),inbound:z},z.tag))})]}),n==="vmess"&&l&&e(O,{alignItems:"flex-start",w:"full",children:r(E,{height:"66px",children:[e(b,{fontSize:"sm",pb:1,children:"ID"}),e(Z,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ie("userDialog.generatedByDefault"),...a.register("proxies.vmess.id")})]})}),n==="vless"&&l&&r(O,{alignItems:"flex-start",w:"full",children:[r(E,{height:"66px",children:[e(b,{fontSize:"sm",pb:1,children:"ID"}),e(Z,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ie("userDialog.generatedByDefault"),...a.register("proxies.vless.id")})]}),r(E,{height:"66px",children:[e(b,{fontSize:"sm",pb:1,children:"Flow"}),e(pe,{fontSize:"xs",size:"sm",borderRadius:"6px",...a.register("proxies.vless.flow"),children:al.map(z=>e("option",{value:z.value,children:z.title},z.title))})]})]}),n==="trojan"&&l&&e(O,{alignItems:"flex-start",w:"full",children:r(E,{height:"66px",children:[e(b,{fontSize:"sm",pb:1,children:Ie("password")}),e(Z,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ie("userDialog.generatedByDefault"),...a.register("proxies.trojan.password")})]})}),n==="shadowsocks"&&l&&r(O,{alignItems:"flex-start",w:"full",children:[r(E,{height:"66px",children:[e(b,{fontSize:"sm",pb:1,children:Ie("password")}),e(Z,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Ie("userDialog.generatedByDefault"),...a.register("proxies.shadowsocks.password")})]}),r(E,{height:"66px",children:[e(b,{fontSize:"sm",pb:1,children:Ie("userDialog.method")}),e(pe,{fontSize:"xs",size:"sm",borderRadius:"6px",...a.register("proxies.shadowsocks.method"),children:cl.map(z=>e("option",{value:z,children:z},z))})]})]})]})})]})},Hl=m.exports.forwardRef(({name:t,list:n,onChange:s,disabled:o,...l},i)=>{const a=vr(),[f,x]=m.exports.useState([]),w=h=>{f.includes(h)?f.splice(f.indexOf(h),1):f.push(h),x([...f])},{getCheckboxProps:d}=Is({value:l.value,onChange:h=>{var I;const _=h.filter(y=>!l.value.includes(y));_[0]&&a.setValue(`inbounds.${_[0]}`,(I=W.getState().inbounds.get(_[0]))==null?void 0:I.map(y=>y.tag)),x(f.filter(y=>h.find(R=>R===n[y].title))),s(h)}});return e(at,{allowToggle:!0,index:f,children:e(pt,{ref:i,gap:2,alignItems:"flex-start",columns:1,spacing:1,children:n.map((h,_)=>e(Gl,{toggleAccordion:w.bind(null,_),disabled:o,title:h.title,description:h.description,isSelected:!!l.value.find(I=>I===h.title),...d({value:h.title})},h.title))})})}),rt={baseStyle:{w:5,h:5}},Vl=v(Hn,rt),ql=v(It,rt),Yl=v(er,rt),Zl=v(kr,rt),Ql=v(Ds,rt),Xl=v(wr,rt),Jl=v($t,rt),Kl=v(jt,rt),ei=v(Cr,rt),ti=v(rr,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),ri=v($l),si=T.object({username:T.string().min(1,{message:"fieldRequired"}),selected_proxies:T.array(T.string()).refine(t=>t.length>0,{message:"userDialog.selectOneProtocol"}),proxies:T.record(T.string(),T.record(T.string(),T.any())).transform(t=>{const n=(s,o)=>{s&&s[o]===""&&delete s[o]};return n(t.vmess,"id"),n(t.vless,"id"),n(t.trojan,"password"),n(t.shadowsocks,"password"),n(t.shadowsocks,"method"),t}),data_limit:T.string().min(0,"The minimum number is 0").or(T.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:T.number().nullable(),data_limit_reset_strategy:T.string(),status:T.string(),inbounds:T.record(T.string(),T.array(T.string())).transform(t=>(Object.keys(t).forEach(n=>{var s;Array.isArray(t[n])&&!((s=t[n])!=null&&s.length)&&delete t[n]}),t)),sub_url_prefix:T.any(),sub_tags:T.any(),sub_revoked_at:T.string()}),ni=t=>({...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,selected_proxies:Object.keys(t.proxies),sub_tags:t.sub_tags||""}),ur=()=>{const t=Object.fromEntries(W.getState().inbounds),n={};for(const s in t)n[s]=t[s].map(o=>o.tag);return{selected_proxies:Object.keys(t),data_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",inbounds:n,proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-poly1305"}},sub_url_prefix:"",sub_tags:"",sub_revoked_at:""}},oi=(t,n)=>{const s=t.reduce((o,l)=>({...o,[l]:{}}),{});return n&&t.forEach(o=>{n[o]&&(s[o]=n[o])}),s},li=()=>{var je,st,nt;const{editingUser:t,isCreatingNewUser:n,onCreateUser:s,editUser:o,revokeUserSubscription:l,fetchUserUsage:i,onEditingUser:a,createUser:f,onDeletingUser:x}=W(),{onAlert:w}=ge(),d=!!t,h=n||d,[_,I]=m.exports.useState(!1),[y,R]=m.exports.useState(""),[c,u]=m.exports.useState("hidden"),[z,P]=m.exports.useState(""),N=De(),{t:k,i18n:S}=X(),{colorMode:p}=kt(),[C,U]=m.exports.useState(!1),J=()=>{U(F=>!F)},{isOpen:H,onToggle:G,onClose:re}=ys(),A=qe({defaultValues:ur(),resolver:it(si)});m.exports.useEffect(()=>W.subscribe(F=>F.inbounds,()=>{A.reset(ur())}),[]);const[ne]=Rs({control:A.control,name:["data_limit"]}),V=k("userDialog.total"),[ce,ve]=m.exports.useState(Xt(p,V)),[K,Pe]=m.exports.useState("1m"),M=F=>{i(t,F).then(te=>{const de=[],ze=[];for(const oe in te.usages)ze.push(te.usages[oe].used_traffic),de.push(te.usages[oe].node_name);ve(Xt(p,V,ze,de))})};m.exports.useEffect(()=>{t&&(A.reset(ni(t)),P(t.sub_url_prefix),M({start:ae().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}))},[t]);const D=F=>{const{selected_proxies:te,...de}=F;return{...de,data_limit:F.data_limit,proxies:oi(te,F.proxies),data_limit_reset_strategy:F.data_limit&&F.data_limit>0?F.data_limit_reset_strategy:"no_reset",status:F.status==="active"||F.status==="disabled"?F.status:"active"}},ee=F=>{I(!0);const te={edited:o,created:f},de=d?"edited":"created";R(null);const ze=D(F);te[de](ze).then(()=>{N({title:k(d?"userDialog.userEdited":"userDialog.userCreated",{username:F.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),$()}).catch(oe=>{var ct,Pr,Tr,Ar,Lr;if(((ct=oe==null?void 0:oe.response)==null?void 0:ct.status)===409||((Pr=oe==null?void 0:oe.response)==null?void 0:Pr.status)===400){let dt=(Ar=(Tr=oe==null?void 0:oe.response)==null?void 0:Tr._data)==null?void 0:Ar.detail;dt.err&&(dt=k(`error.${dt.err}`)),R(dt)}((Lr=oe==null?void 0:oe.response)==null?void 0:Lr.status)===422&&Object.keys(oe.response._data.detail).forEach(dt=>{let Rt=Gt(oe.response._data.detail[dt]),ir=Rt;Rt.err&&(ir=`error.${Rt.err}`,Rt=k(ir)),R(Rt),A.setError(dt,{type:"custom",message:ir})})}).finally(()=>{I(!1)})},$=()=>{A.reset(ur()),s(!1),a(null),R(null),U(!1),Pe("1m"),re()},fe=()=>{W.setState({resetUsageUser:t})},Q=F=>F&&k(F),se=()=>{const F=D(A.getValues());w({title:k("userDialog.revoke.title"),content:k("userDialog.revoke.prompt",{username:t==null?void 0:t.username}),type:"warning",yes:k("userDialog.revoke"),onConfirm:()=>{l(F).then(()=>{N({title:k("userDialog.revoke.success",{username:t==null?void 0:t.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(te=>{N({title:k("userDialog.revoke.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{w(null)})}})},he=_;return r(be,{isOpen:h,onClose:$,size:"2xl",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(zt,{...A,children:e(ye,{mx:"3",children:r("form",{onSubmit:A.handleSubmit(ee),children:[e(Se,{pt:6,children:r(g,{gap:2,children:[e(ke,{color:"primary",children:d?e(ql,{color:"white"}):e(Vl,{color:"white"})}),e(b,{fontWeight:"semibold",fontSize:"lg",children:k(d?"userDialog.editUserTitle":"createNewUser")})]})}),e(Ce,{mt:3,disabled:he}),r(we,{children:[r(cs,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:[e(xt,{children:r(O,{justifyContent:"space-between",children:[r(Pt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[r(E,{mb:"10px",children:[e(L,{children:k("username")}),r(g,{children:[e(Ze,{size:"sm",type:"text",borderRadius:"6px",error:Q((je=A.formState.errors.username)==null?void 0:je.message),disabled:he||d,...A.register("username")}),d&&e(g,{px:1,children:e(Be,{name:"status",control:A.control,render:({field:F})=>e(me,{placement:"top",label:"status: "+F.value,textTransform:"capitalize",children:e(j,{children:e(Qe,{colorScheme:"primary",disabled:F.value!=="active"&&F.value!=="disabled",isChecked:F.value==="active",onChange:te=>{te.target.checked?F.onChange("active"):F.onChange("disabled")}})})})})})]})]}),r(E,{mb:"10px",children:[e(L,{children:k("userDialog.dataLimit")}),e(Be,{control:A.control,name:"data_limit",render:({field:F})=>{var te;return e(Ze,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:F.onChange,disabled:he,error:(te=A.formState.errors.data_limit)==null?void 0:te.message,value:F.value?String(F.value):""})}})]}),e(Wr,{in:!!(ne&&ne>0),animateOpacity:!0,style:{width:"100%"},children:r(E,{height:"66px",children:[e(L,{children:k("userDialog.periodicUsageReset")}),e(Be,{control:A.control,name:"data_limit_reset_strategy",render:({field:F})=>e(pe,{size:"sm",...F,children:br.map(te=>e("option",{value:te.value,children:k("userDialog.resetStrategy"+te.title)},te.value))})})]})}),r(E,{mb:"10px",children:[e(L,{children:k("userDialog.expiryDate")}),e(Be,{name:"expire",control:A.control,render:({field:F})=>{var oe;function te(ct){return ae(ae(ct*1e3).utc()).toDate()}const{status:de,time:ze}=Js(F.value);return r(Xe,{children:[e(vs,{locale:S.language.toLocaleLowerCase(),dateFormat:k("dateFormat"),minDate:new Date,selected:F.value?te(F.value):void 0,onChange:ct=>{F.onChange(ct?ae(ae(ct).set("hour",23).set("minute",59).set("second",59)).utc().valueOf()/1e3:0)},customInput:e(Ze,{size:"sm",type:"text",borderRadius:"6px",clearable:!0,disabled:he,error:(oe=A.formState.errors.expire)==null?void 0:oe.message})}),F.value?e(Es,{children:k(de,{time:ze})}):""]})}})]})]}),y&&r(ot,{status:"error",display:{base:"none",md:"flex"},children:[e(lt,{}),y]})]})}),e(xt,{children:r(E,{isInvalid:!!((st=A.formState.errors.selected_proxies)!=null&&st.message),children:[e(L,{children:k("userDialog.protocols")}),e(Be,{control:A.control,name:"selected_proxies",render:({field:F})=>e(Hl,{list:[{title:"vmess",description:k("userDialog.vmessDesc")},{title:"vless",description:k("userDialog.vlessDesc")},{title:"trojan",description:k("userDialog.trojanDesc")},{title:"shadowsocks",description:k("userDialog.shadowsocksDesc")}],disabled:he,...F})}),e(Te,{children:k((nt=A.formState.errors.selected_proxies)==null?void 0:nt.message)})]})}),e(xt,{colSpan:{base:1,md:2},children:e(Wr,{in:H,style:{overflow:c},onAnimationComplete:()=>u("unset"),animateOpacity:!0,children:r(pt,{columns:{base:1,md:2},spacing:3,children:[r(Pt,{pt:"15px",flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[r(E,{mb:"10px",children:[e(L,{children:k("userDialog.issuedAt")}),e(Be,{name:"sub_revoked_at",control:A.control,render:({field:F})=>r(g,{children:[e(Z,{size:"sm",borderRadius:"6px",disabled:!0,value:ae.utc(F.value).local().format("YYYY-MM-DD HH:mm:ss")}),e(me,{label:k("userDialog.revoke.tip"),placement:"top",children:e(q,{size:"sm","aria-label":"Revoke subscription",isDisabled:he,icon:e(Ql,{}),onClick:se})})]})})]}),r(E,{mb:"10px",isInvalid:!!A.formState.errors.sub_url_prefix,children:[e(L,{children:k("userDialog.urlPrefix")}),e(Ze,{size:"sm",type:"text",borderRadius:"6px",placeholder:"Domain (e.g. https://example.com)",disabled:he,...A.register("sub_url_prefix",{onChange:F=>P(F.target.value)})}),z&&r(b,{maxW:"300px",pt:"1",fontSize:"xs",color:"gray.500",w:"inherit",noOfLines:1,children:[z,"/sub/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"]})]})]}),e(Pt,{pt:"15px",flexDirection:"column",gridAutoRows:"min-content",w:"full",children:r(E,{mb:"10px",isInvalid:!!A.formState.errors.sub_url_prefix,children:[r(g,{mb:"1",children:[e(L,{mr:"0",mb:"0",children:k("tags")}),r(Ae,{isLazy:!0,placement:"top",children:[e(Le,{children:e(ti,{})}),r(Ue,{w:"300px",children:[e(Fe,{}),e(b,{fontSize:"xs",p:"2",children:k("userDialog.tags.info")})]})]})]}),e(Be,{name:"sub_tags",control:A.control,render:({field:F})=>e(ai,{tags:F.value,onChange:F.onChange})})]})})]})})}),d&&C&&e(xt,{pt:6,colSpan:{base:1,md:2},children:r(O,{gap:4,children:[e(en,{defaultValue:K,onChange:(F,te)=>{Pe(F),M(te)}}),e(j,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(zs,{options:ce.options,series:ce.series,type:"donut"})})]})})]}),y&&r(ot,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(lt,{}),y]})]}),e(Ee,{mt:"3",children:r(g,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(g,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:d&&r(Xe,{children:[e(me,{label:k("delete"),placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",onClick:()=>{x(t),$()},children:e(tt,{})})}),e(me,{label:k("userDialog.subscription"),placement:"top",children:e(q,{"aria-label":"usage",size:"sm",onClick:()=>{u("hidden"),G()},children:e(Zl,{})})}),e(me,{label:k("userDialog.usage"),placement:"top",children:e(q,{"aria-label":"usage",size:"sm",onClick:J,children:e(Yl,{})})}),e(Y,{onClick:fe,size:"sm",children:k("userDialog.resetUsage")})]})}),r(g,{w:"full",maxW:{md:"50%",base:"full"},children:[e(Y,{onClick:$,size:"sm",variant:"outline",w:"full",disabled:he,children:k("cancel")}),e(Y,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:_?e(Re,{size:"xs"}):void 0,w:"full",disabled:he,children:k(d?"userDialog.editUser":"createUser")})]})]})})]})})})]})},ii=({children:t,...n})=>{const[s,o]=m.exports.useState(!1);return m.exports.useEffect(()=>{const l=requestAnimationFrame(()=>o(!0));return()=>{cancelAnimationFrame(l),o(!1)}},[]),s?e(Ns,{...n,children:t}):null},ai=({tags:t,onChange:n})=>{const{proxyTags:s,onCreateProxy:o}=ge(),{onEditingSubscription:l}=W(),{t:i}=X(),a=t.split(",").filter(I=>I.length>0),f=s.reduce((I,y)=>({...I,[y.tag]:y}),{}),x=!s.every(I=>I.tag=="built-in"),w=m.exports.useRef(null),[d,h]=m.exports.useState(""),_=I=>{h(I.target.value)};return r(O,{children:[e(Ps,{onDragEnd:I=>{if(!I.destination)return;const y=Array.from(a),[R]=y.splice(I.source.index,1);y.splice(I.destination.index,0,R),n(y.join(","))},children:e(ii,{droppableId:"droppable",children:I=>{const y=a,R=y.length==0,c=R?["built-in"]:y;return r(pt,{w:"full",...I.droppableProps,ref:I.innerRef,children:[c.map((u,z)=>{const P=f[u]||{tag:u,servers:["Not Found"]},N=P.servers[0].split("->")[0].trimEnd()+(P.servers.length>1?"...":"");let k="primary";return R?k="gray":f[u]||(k="red"),e(Ts,{index:z,draggableId:P.tag,isDragDisabled:R,children:S=>r(As,{ref:S.innerRef,...S.draggableProps,...S.dragHandleProps,w:"fit-content",size:"md",pl:"3",pr:"3",mb:"1",borderRadius:"full",variant:"solid",cursor:"default",colorScheme:k,children:[!R&&e(Ls,{boxSize:"18px",as:Xl}),r(Ae,{isLazy:!0,trigger:"hover",placement:"top",children:[e(Le,{children:e(Us,{height:"full",cursor:"default",children:r(Fs,{children:[P.tag," -> ",N]})})}),r(Ue,{w:"full",children:[e(Fe,{}),e(pt,{p:"2",spacingY:"1",pl:"3",pr:"3",w:"full",alignItems:"flex-start",color:"gray.800",_dark:{color:"whiteAlpha.900"},children:P.servers.map((p,C)=>e(b,{fontSize:"sm",children:p},C))})]})]}),!R&&e(Ms,{onClick:()=>{const p=y.filter(C=>C!==u);n(p.join(","))}})]})},P.tag)}),I.placeholder]})}})}),!x&&r(O,{mt:3,children:[e(b,{children:i("userDialog.noTags")}),e(ri,{onClick:()=>{l(!0),o(!0)},cursor:"pointer",boxSize:"32px",_dark:{'path[fill="#ccc"]':{fill:"primary.300"}},_light:{'path[fill="#ccc"]':{fill:"primary.500"}}})]}),x&&r(O,{w:"full",children:[r(g,{w:"full",children:[r(He,{children:[e(vt,{height:"8",pointerEvents:"none",children:e(ei,{})}),e(Ze,{pl:10,size:"sm",borderRadius:"md",placeholder:i("search"),value:d,borderColor:"light-border",onChange:_}),e(Ve,{height:"8",children:d.length>0&&e(q,{onClick:()=>h(""),"aria-label":"clear",size:"xs",variant:"ghost",children:e(Jl,{})})})]}),e(j,{w:"36px"})]}),r(g,{w:"full",children:[e(pe,{ref:w,size:"sm",children:s.map(I=>{const R=a.some(z=>z===I.tag),c=I.tag==="built-in",u=d&&I.tag.toLowerCase().indexOf(d.toLowerCase())<0;return R||c||u?null:e("option",{value:I.tag,children:I.tag},I.tag)})}),e(q,{size:"sm","aria-label":"Add Tags",icon:e(Kl,{}),onClick:()=>{const I=a,y=w.current.value;n([...I,y].join(","))}})]})]})]})},ci=t=>m.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},m.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),m.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),m.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),m.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),m.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),m.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),m.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),m.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),m.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),m.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),m.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),m.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),m.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),m.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),m.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),di=v(Vn,{baseStyle:{w:4,h:4}}),ui=v(qn,{baseStyle:{w:4,h:4}}),Qr=5;function hi(t,n,s){if(s<Qr)throw new Error(`Must allow at least ${Qr} page items`);if(s%2===0)throw new Error("Must allow odd number of page items");if(t<s)return[...new Array(t).keys()];const o=Math.max(0,Math.min(t-s,n-Math.floor(s/2))),l=new Array(s);for(let i=0;i<s;i+=1)l[i]=i+o;return l[0]>0&&(l[0]=0,l[1]="prev-more"),l[l.length-1]<t-1&&(l[l.length-1]=t-1,l[l.length-2]="next-more"),l}const nr=({onChange:t,total:n,limit:s,offset:o})=>{const l=(o||0)/(s||1),i=Math.ceil(n/(s||1)),a=hi(i,l,7),f=d=>{t(d,s)},x=d=>{t(l,parseInt(d.target.value))},{t:w}=X();return r(g,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(j,{order:{base:2,md:1},children:r(g,{children:[r(pe,{minW:"60px",value:s,onChange:x,size:"sm",rounded:"md",children:[e("option",{children:"10"}),e("option",{children:"20"}),e("option",{children:"30"})]}),e(b,{whiteSpace:"nowrap",fontSize:"sm",children:w("itemsPerPage")})]})}),r(Yn,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(Y,{leftIcon:e(di,{}),onClick:f.bind(null,l-1),isDisabled:l===0||i===0,children:w("previous")}),a.map(d=>typeof d=="string"?e(Y,{children:"..."},d):e(Y,{variant:d===l?"solid":"outline",onClick:f.bind(null,d),children:d+1},d)),e(Y,{rightIcon:e(ui,{}),onClick:f.bind(null,l+1),isDisabled:l+1===i||i===0,children:w("next")})]})]})},pi=v(ci),_t={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},mi=v(Zn,_t),gi=v(Ws,_t),Xr=v(Os,_t),fi=v(tr,_t),bi=v(Ir,_t),xi=v(It,_t),yi=v(Ws,{baseStyle:{width:"15px",height:"15px"}}),Si=t=>{for(var n=0;n<br.length;n++){const s=br[n];if(s.value==t)return s.title}return"No"},Ci=t=>{const{used:n,total:s,dataLimitResetStrategy:o,totalUsedTraffic:l}=t,i=s===0||s===null;return e(g,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:r(b,{children:[We(n)," /"," ",i?e(b,{as:"span",fontFamily:"system-ui",children:"\u221E"}):We(s)]})})},Jr=t=>{const{used:n,total:s,dataLimitResetStrategy:o,totalUsedTraffic:l,...i}=t,a=s===0||s===null,f=!a&&n/s*100>=100;return r(Xe,{children:[e(Qn,{orientation:"horizontal",value:a?100:Math.min(n/s*100,100),colorScheme:f?"red":"primary",...i,children:e(Xn,{h:"6px",borderRadius:"full",children:e(Jn,{borderRadius:"full"})})}),r(g,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[r(b,{children:[We(n)," /"," ",a?e(b,{as:"span",fontFamily:"system-ui",children:"\u221E"}):We(s)+(o&&o!=="no_reset"?" "+Ie("userDialog.resetStrategy"+Si(o)):"")]}),r(b,{children:[Ie("usersTable.total"),": ",We(l)]})]})]})},_e=({sort:t,column:n})=>t.includes(n)?e(yi,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,wi=t=>{const{filters:n,users:{users:s},users:o,onEditingUser:l,onFilterChange:i}=W(),{t:a}=X(),[f,x]=m.exports.useState(void 0),w=ht({base:120,lg:72})||72,[d,h]=m.exports.useState(`${w}px`),_=ht({base:!1,md:!0});m.exports.useEffect(()=>{const u=document.querySelectorAll("#filters")[0];h(`${u.offsetHeight}px`)});const I=s.length!==o.total,y=u=>{let z=n.sort;z.includes(u)?z.startsWith("-")?z="-created_at":z="-"+u:z=u,i({sort:z})},R=u=>{i({status:u.target.value.length>0?u.target.value:void 0})},c=u=>{x(u===f?void 0:u)};return r(j,{id:"users-table",overflowX:{base:"auto",md:"unset"},children:[e(at,{allowMultiple:!0,display:{base:"block",md:"none"},index:f,children:r(Lt,{orientation:"vertical",...t,children:[e(Ut,{zIndex:"docked",position:"relative",children:r(Ne,{children:[e(ue,{position:"sticky",top:{base:"unset",md:d},minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:y.bind(null,"username"),children:r(g,{children:[e("span",{children:a("users")}),e(_e,{sort:n.sort,column:"username"})]})}),e(ue,{position:"sticky",top:{base:"unset",md:d},minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:r(g,{spacing:0,position:"relative",children:[r(b,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[a("usersTable.status"),n.status?": "+n.status:""]}),r(pe,{value:n.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Xe,{}),_focusVisible:{border:"0 !important"},onChange:R,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(ue,{position:"sticky",top:{base:"unset",md:d},minW:"100px",cursor:"pointer",pr:0,onClick:y.bind(null,"used_traffic"),children:r(g,{children:[e("span",{children:a("usersTable.dataUsage")}),e(_e,{sort:n.sort,column:"used_traffic"})]})}),e(ue,{position:"sticky",top:{base:"unset",md:d},minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(Ft,{children:!_&&(s==null?void 0:s.map((u,z)=>r(m.exports.Fragment,{children:[r(Ne,{onClick:c.bind(null,z),cursor:"pointer",children:[e(ie,{borderBottom:0,minW:"100px",pl:4,pr:4,children:u.username}),e(ie,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(qt,{compact:!0,showDetail:!1,expiryDate:u.expire,status:u.status})}),e(ie,{borderBottom:0,minW:"100px",pr:0,children:e(Ci,{totalUsedTraffic:u.lifetime_used_traffic,dataLimitResetStrategy:u.data_limit_reset_strategy,used:u.used_traffic,total:u.data_limit,colorScheme:Tt[u.status].bandWidthColor})}),e(ie,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(gi,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:f===z?"rotate(180deg)":"0deg"})})]}),e(Ne,{className:"collapsible",onClick:c.bind(null,z),children:e(ie,{p:0,colSpan:4,children:r(Je,{border:0,children:[e(Ke,{display:"none"}),e(et,{border:0,cursor:"pointer",px:6,py:3,children:r(O,{justifyContent:"space-between",spacing:"4",children:[r(O,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(b,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:a("usersTable.dataUsage")}),e(j,{width:"full",minW:"230px",children:e(Jr,{totalUsedTraffic:u.lifetime_used_traffic,dataLimitResetStrategy:u.data_limit_reset_strategy,used:u.used_traffic,total:u.data_limit,colorScheme:Tt[u.status].bandWidthColor})})]}),r(g,{w:"full",justifyContent:"space-between",children:[e(j,{width:"full",children:e(qt,{compact:!0,expiryDate:u.expire,status:u.status})}),r(g,{children:[e(Kr,{user:u}),e(me,{label:a("userDialog.editUser"),placement:"top",children:e(q,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:P=>{P.stopPropagation(),l(u)},children:e(xi,{})})})]})]})]})})]})})})]},u.username)))})]})}),r(Lt,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(Ut,{zIndex:"docked",position:"relative",children:r(Ne,{children:[e(ue,{position:"sticky",top:{base:"unset",md:d},minW:"140px",cursor:"pointer",onClick:y.bind(null,"username"),children:r(g,{children:[e("span",{children:a("username")}),e(_e,{sort:n.sort,column:"username"})]})}),e(ue,{position:"sticky",top:{base:"unset",md:d},width:"400px",minW:"150px",cursor:"pointer",children:r(g,{spacing:0,position:"relative",children:[r(b,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[a("usersTable.status"),n.status?": "+n.status:""]}),r(pe,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Xe,{}),_focusVisible:{border:"0 !important"},value:n.sort,onChange:R,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(ue,{position:"sticky",top:{base:"unset",md:d},width:"350px",minW:"230px",cursor:"pointer",onClick:y.bind(null,"used_traffic"),children:r(g,{children:[e("span",{children:a("usersTable.dataUsage")}),e(_e,{sort:n.sort,column:"used_traffic"})]})}),e(ue,{position:"sticky",top:{base:"unset",md:d},width:"200px",minW:"180px"})]})}),r(Ft,{children:[_&&(s==null?void 0:s.map((u,z)=>r(Ne,{className:Oe("interactive",{"last-row":z===s.length-1}),onClick:()=>l(u),children:[e(ie,{minW:"140px",children:u.username}),e(ie,{width:"400px",minW:"150px",children:e(qt,{expiryDate:u.expire,status:u.status})}),e(ie,{width:"350px",minW:"230px",children:e(Jr,{totalUsedTraffic:u.lifetime_used_traffic,dataLimitResetStrategy:u.data_limit_reset_strategy,used:u.used_traffic,total:u.data_limit,colorScheme:Tt[u.status].bandWidthColor})}),e(ie,{width:"200px",minW:"180px",children:e(Kr,{user:u})})]},u.username))),s.length==0&&e(Ne,{children:e(ie,{colSpan:4,children:e(ki,{isFiltered:I})})})]})]}),e(nr,{onChange:(u,z)=>{i({...n,limit:z,offset:u*z})},total:o.total,limit:n.limit,offset:n.offset})]})},Kr=({user:t})=>{const{setQRCode:n,setSubLink:s}=W(),o=t.links.join(`\r
`),[l,i]=m.exports.useState([-1,!1]);return m.exports.useEffect(()=>{l[1]&&setTimeout(()=>{i([-1,!1])},1e3)},[l]),r(g,{justifyContent:"flex-end",onClick:a=>{a.preventDefault(),a.stopPropagation()},children:[e(Or,{text:t.subscription_url.startsWith("/")?window.location.origin+t.subscription_url:t.subscription_url,onCopy:()=>{i([0,!0])},children:e("div",{children:e(me,{label:l[0]==0&&l[1]?Ie("usersTable.copied"):Ie("usersTable.copyLink"),placement:"top",children:e(q,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:l[0]==0&&l[1]?e(Xr,{}):e(fi,{})})})})}),e(Or,{text:o,onCopy:()=>{i([1,!0])},children:e("div",{children:e(me,{label:l[0]==1&&l[1]?Ie("usersTable.copied"):Ie("usersTable.copyConfigs"),placement:"top",children:e(q,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:l[0]==1&&l[1]?e(Xr,{}):e(mi,{})})})})}),e(me,{label:"QR Code",placement:"top",children:e(q,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{n(t.links),s(t.subscription_url)},children:e(bi,{})})})]})},ki=({isFiltered:t})=>{const{onCreateUser:n}=W();return r(j,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(pi,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(b,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?Ie("usersTable.noUserMatched"):Ie("usersTable.noUser")}),!t&&e(Y,{size:"sm",colorScheme:"primary",onClick:()=>n(!0),children:Ie("createUser")})]})},tn={baseStyle:{w:5,h:5}},vi=v(jt,tn),zi=v(It,tn),Ii=T.object({name:T.string().min(1,{message:"fieldRequired"}),server:T.string().min(1,{message:"fieldRequired"}),port:T.string().min(1,{message:"fieldRequired"}),tag:T.string().min(1,{message:"fieldRequired"}),inbound:T.string().min(1,{message:"fieldRequired"}),settings:T.record(T.string(),T.any())}),_i=t=>({...t}),hr=()=>({id:0,name:"",server:"",builtin:!1,inbound:"",tag:"",port:"",settings:{trojan:{security:"tls",fingerprint:"chrome",udp:!0,alpn:"",sni:"",allow_insecure:!1},vless:{security:"tls",fingerprint:"chrome",servername:"",alpn:"",udp:!0,allow_insecure:!1},vmess:{security:"tls",fingerprint:"chrome",servername:"",alpn:"",udp:!0,allow_insecure:!1},shadowsocks:{udp:!0}}}),Ri=()=>{var ce,ve,K,Pe,M;const{proxyInbounds:t,editingProxy:n,isCreatingProxy:s,duplicatingProxy:o,onEditingProxy:l,onDuplicatingProxy:i,onCreateProxy:a,deleteProxy:f,editProxy:x,createProxy:w,onAlert:d}=ge(),h=!!n,_=s||h,I=h?"clash.proxy.edited":"clash.proxy.created",[y,R]=m.exports.useState(!1),[c,u]=m.exports.useState(null),[z,P]=m.exports.useState(""),[N,k]=m.exports.useState(""),S=De(),{t:p}=X(),C=qe({defaultValues:hr(),resolver:it(Ii)}),U=D=>t.find(ee=>ee.name===D)||null,J=D=>{if(D){const ee=U(D.inbound);C.reset(_i(D)),u(ee),P(D.port)}else C.reset(hr()),u(null),P("")};m.exports.useEffect(()=>{n&&J(n)},[n,t]),m.exports.useEffect(()=>{s&&J(o||null)},[s,t]);const H=(D,ee)=>{Object.keys(D).map($=>{ee[$]===void 0&&delete D[$]})},G=D=>{R(!0),k(null);const ee=hr().settings;let $={};D.settings.icon&&($.icon=D.settings.icon),(c==null?void 0:c.type)=="trojan"?($.trojan=D.settings.trojan,H($.trojan,ee.trojan)):(c==null?void 0:c.type)=="vless"?($.vless=D.settings.vless,H($.vless,ee.vless)):(c==null?void 0:c.type)=="vmess"?($.vmess=D.settings.vmess,H($.vmess,ee.vmess)):(c==null?void 0:c.type)=="shadowsocks"&&($.shadowsocks=D.settings.shadowsocks,H($.shadowsocks,ee.shadowsocks));const{...fe}=D;let Q={...fe,id:n==null?void 0:n.id,builtin:!1,settings:$};(h?x:w)(Q).then(()=>{S({title:p(I,{name:D.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),re()}).catch(se=>{var he,je,st,nt,F,te;if(((he=se==null?void 0:se.response)==null?void 0:he.status)===409||((je=se==null?void 0:se.response)==null?void 0:je.status)===400||((st=se==null?void 0:se.response)==null?void 0:st.status)===404){let de=(F=(nt=se==null?void 0:se.response)==null?void 0:nt._data)==null?void 0:F.detail;de.err&&(de=p(`error.${de.err}`)),k(de)}((te=se==null?void 0:se.response)==null?void 0:te.status)===422&&Object.keys(se.response._data.detail).forEach(de=>{let ze=Gt(se.response._data.detail[de]),oe=ze;ze.err&&(oe=`error.${ze.err}`,ze=p(oe)),k(ze),C.setError(de,{type:"custom",message:oe})})}).finally(()=>{R(!1)})},re=()=>{J(null),a(!1),l(null),i(null),k(null),d(null)},A=()=>{let D={};n!=null&&n.builtin?(D.title="clash.proxy.deleteOrReset",D.prompt="clash.proxy.deleteBuiltinPrompt",D.yes="confirm",D.success="clash.proxy.resetSuccess"):(D.title="clash.proxy.delete",D.prompt="clash.proxy.deletePrompt",D.yes="delete",D.success="clash.proxy.deleteSuccess"),d({title:p(D.title),content:p(D.prompt,{name:n==null?void 0:n.name}),type:"error",yes:p(D.yes),onConfirm:()=>{f(n).then(()=>{S({title:p(D.success,{name:n==null?void 0:n.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),re()}).catch(ee=>{S({title:p("clash.proxy.deleteFail",{name:n==null?void 0:n.name}),status:"warning",isClosable:!0,position:"top",duration:3e3}),re()})}})},ne=D=>D&&p(D),V=y;return r(be,{isOpen:_,onClose:re,size:"lg",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(zt,{...C,children:e(ye,{mx:"3",children:r("form",{onSubmit:C.handleSubmit(G),children:[e(Se,{pt:6,children:r(g,{gap:2,children:[e(ke,{color:"primary",children:h?e(zi,{color:"white"}):e(vi,{color:"white"})}),e(b,{fontWeight:"semibold",fontSize:"lg",children:p(h?"clash.proxy.edit":"clash.proxy.add")})]})}),e(Ce,{mt:3,disabled:V}),e(we,{children:r(O,{children:[e(g,{w:"full",children:r(E,{isInvalid:!!C.formState.errors.name,children:[r(g,{mb:"1",children:[e(L,{mr:"0",mb:"0",children:p("clash.name")}),r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(Kt,{})}),r(Ue,{children:[e(Fe,{}),e(b,{fontSize:"xs",p:"2",children:p("clash.proxy.uniqueInfo")})]})]})]}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:(c==null?void 0:c.name)||"us bwh|01",disabled:V,...C.register("name")}),e(Te,{children:ne((ce=C.formState.errors.name)==null?void 0:ce.message)})]})}),r(g,{w:"full",alignItems:"baseline",children:[r(E,{isInvalid:!!C.formState.errors.server,children:[e(L,{children:p("clash.server")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:(c==null?void 0:c.server)||"bwh-aws.example.com",disabled:V,...C.register("server")}),e(Te,{children:ne((ve=C.formState.errors.server)==null?void 0:ve.message)})]}),r(E,{w:"50%",isInvalid:!!C.formState.errors.port,children:[e(L,{children:p("clash.port")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:(c==null?void 0:c.port)||"1080 | 1080:1081",disabled:V,...C.register("port",{onChange:D=>P(D.target.value)})}),e(Te,{children:ne((K=C.formState.errors.port)==null?void 0:K.message)})]})]}),r(g,{w:"full",alignItems:"baseline",children:[r(E,{isInvalid:!!C.formState.errors.inbound,children:[e(L,{children:p("clash.inbound")}),e(pe,{disabled:V||(n==null?void 0:n.builtin),size:"sm",placeholder:"Select inbound",...C.register("inbound",{onChange:D=>{const ee=U(D.target.value),$=C.getValues();ee.type=="trojan"&&C.setValue("settings.trojan.security","tls"),(!$.name||(c==null?void 0:c.name)==$.name)&&C.setValue("name",ee.name),(!$.server||(c==null?void 0:c.server)==$.server)&&C.setValue("server",ee.server),(!$.port||(c==null?void 0:c.port)==$.port)&&C.setValue("port",ee.port),C.clearErrors("port"),C.clearErrors("inbound"),u(ee)}}),children:t.map(D=>e("option",{value:D.name,children:D.name},D.name))}),e(Te,{children:ne((Pe=C.formState.errors.inbound)==null?void 0:Pe.message)})]}),r(E,{isInvalid:!!C.formState.errors.tag,children:[r(g,{mb:"1",children:[e(L,{mr:"0",mb:"0",children:p("tag")}),r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(Kt,{})}),r(Ue,{children:[e(Fe,{}),e(b,{fontSize:"xs",p:"2",children:p("clash.proxy.tag.info")})]})]})]}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:"bwh-aws",disabled:V||(n==null?void 0:n.builtin),...C.register("tag")}),e(Te,{children:ne((M=C.formState.errors.tag)==null?void 0:M.message)})]})]}),r(g,{w:"full",children:[r(Pt,{w:"full",flexDirection:"column",gap:"1",children:[e(b,{fontSize:"sm",children:p("clash.type")}),e(Z,{size:"sm",borderRadius:"6px",disabled:!0,value:(c==null?void 0:c.type)||""})]}),r(Pt,{w:"full",flexDirection:"column",gap:"1",children:[e(b,{fontSize:"sm",children:p("clash.proxy.network")}),e(Z,{size:"sm",borderRadius:"6px",disabled:!0,value:(c==null?void 0:c.network)||""})]}),c&&c.type!="shadowsocks"&&r(E,{w:"full",children:[e(L,{children:p("clash.proxy.security")}),c.security=="none"&&r(pe,{disabled:V,size:"sm",placeholder:"Select security",...C.register(`settings.${c.type}.security`),children:[e("option",{value:"none",children:"none"},"none"),e("option",{value:"tls",children:"tls"},"tls")]}),c.security!="none"&&e(Z,{size:"sm",borderRadius:"6px",disabled:!0,value:c==null?void 0:c.security})]})]}),e(at,{w:"full",allowToggle:!0,children:r(Je,{border:"0",children:[e(Ke,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:r(g,{pt:"4",pb:"2",w:"full",children:[e(wt,{}),r(b,{whiteSpace:"nowrap",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[p("clash.advanceOption"),e(Ct,{fontSize:"sm",ml:1})]}),e(wt,{})]})}),e(et,{w:"full",p:1,children:r(O,{w:"full",children:[z.indexOf(":")>0&&r(E,{children:[e(L,{children:p("clash.icon")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:V,...C.register("settings.icon")})]}),c&&c.type!="shadowsocks"&&r(O,{w:"full",children:[c.type=="trojan"&&r(E,{children:[e(L,{children:"SNI"}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:V,...C.register(`settings.${c.type}.sni`)})]}),(c.type=="vmess"||c.type=="vless")&&r(E,{children:[e(L,{children:p("clash.proxy.serverName")}),c.security=="reality"&&e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:!0,value:c.servername}),c.security!="reality"&&e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:V,...C.register(`settings.${c.type}.servername`)})]}),r(g,{w:"full",children:[r(E,{children:[e(L,{children:"ALPN"}),e(pe,{disabled:V,size:"sm",...C.register(`settings.${c.type}.alpn`),children:Zs.map(D=>e("option",{value:D.value,children:D.title},D.value))})]}),r(E,{children:[e(L,{children:p("clash.proxy.fingerprint")}),e(pe,{disabled:V,size:"sm",...C.register(`settings.${c.type}.fingerprint`),children:Qs.map(D=>e("option",{value:D.value,children:D.title},D.value))})]})]}),r(g,{pt:1,w:"full",gap:"4",children:[r(E,{w:"fit-content",display:"flex",alignItems:"center",children:[e(L,{mb:"0",children:"UDP"}),e(Qe,{colorScheme:"primary",...C.register(`settings.${c.type}.udp`)})]}),r(E,{w:"fit-content",display:"flex",alignItems:"center",children:[e(L,{mb:"0",children:p("clash.proxy.allowInsecure")}),e(Qe,{colorScheme:"primary",...C.register(`settings.${c.type}.allow_insecure`)})]})]})]}),(c==null?void 0:c.type)=="shadowsocks"&&e(g,{pt:1,w:"full",gap:"4",children:r(E,{w:"fit-content",display:"flex",alignItems:"center",children:[e(L,{mb:"0",children:"UDP"}),e(Qe,{colorScheme:"primary",...C.register(`settings.${c.type}.udp`)})]})})]})})]})}),N&&r(ot,{status:"error",children:[e(lt,{}),N]})]})}),e(Ee,{children:r(g,{justifyContent:"space-between",w:"full",gap:3,children:[h&&r(g,{spacing:2,pr:10,children:[e(me,{label:p("delete"),placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",onClick:A,children:e(tt,{})})}),e(me,{isDisabled:n.builtin,label:p("duplicate"),placement:"top",children:e(q,{"aria-label":"duplicate proxy",size:"sm",isDisabled:n.builtin,onClick:()=>i(n),children:e(nn,{})})})]}),r(g,{w:"full",justifyItems:"flex-end",children:[e(Y,{onClick:re,size:"sm",variant:"outline",w:"full",disabled:V,children:p("cancel")}),e(Y,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:y?e(Re,{size:"xs"}):void 0,w:"full",isDisabled:V||!C.formState.isDirty,children:p(h?"update":"create")})]})]})})]})})})]})},es=["select","load-balance","relay","url-test","fallback"],Di=["consistent-hashing","round-robin"],Ei=T.object({name:T.string().min(1,{message:"fieldRequired"}),tag:T.string().min(1,{message:"fieldRequired"}),type:T.string().min(1,{message:"fieldRequired"}),selected_proxies:T.array(T.string()),settings:T.record(T.string(),T.any())}),pr=()=>({id:0,name:"",tag:"",type:"select",builtin:!1,proxies:"",selected_proxies:[],settings:{relay:{},url_test:{tolerance:150,lazy:!0,url:"http://cp.cloudflare.com/generate_204",interval:300},fallback:{url:"http://cp.cloudflare.com/generate_204",interval:300},load_balance:{strategy:"consistent-hashing",url:"http://cp.cloudflare.com/generate_204",interval:300},select:{disable_udp:!0,filter:""}}}),ts=t=>({...t,selected_proxies:t.proxies.split(",").filter(n=>n.length>0)}),Pi=()=>{var ve,K,Pe;const{editingProxyGroup:t,duplicatingProxyGroup:n,isCreatingProxyGroup:s,onEditingProxyGroup:o,onCreateProxyGroup:l,onDuplicatingProxyGroup:i,deleteProxyGroup:a,editProxyGroup:f,createProxyGroup:x,onAlert:w,proxyBriefs:d}=ge(),h=!!t,_=s||h,I=h?"clash.proxyGroup.edited":"clash.proxyGroup.created",[y,R]=m.exports.useState(!1),[c,u]=m.exports.useState(""),[z,P]=m.exports.useState(""),N=m.exports.useRef(null),k=De(),{t:S}=X(),p=qe({defaultValues:pr(),resolver:it(Ei)}),C=d.reduce((M,D)=>({...M,[D.id]:D}),{});m.exports.useEffect(()=>{t&&(p.reset(ts(t)),P(t.type))},[t]),m.exports.useEffect(()=>{s&&(n?(p.reset(ts(n)),P(n.type)):(p.reset(pr()),P(es[0])))},[s]);const[U,J]=m.exports.useState(""),H=M=>{J(M.target.value)},G=()=>{J("")},re=M=>{R(!0),u(null);const{selected_proxies:D,...ee}=M;let $={};$.icon=M.settings.icon,M.type=="select"?$.select=M.settings.select:M.type=="url-test"?$.url_test=M.settings.url_test:M.type=="fallback"?$.fallback=M.settings.fallback:M.type=="load-balance"&&($.load_balance=M.settings.load_balance);let fe={...ee,id:t==null?void 0:t.id,builtin:(t==null?void 0:t.builtin)||!1,proxies:D.join(","),settings:$};(h?f:x)(fe).then(()=>{k({title:S(I,{name:M.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),A()}).catch(Q=>{var se,he,je,st,nt,F;if(((se=Q==null?void 0:Q.response)==null?void 0:se.status)===409||((he=Q==null?void 0:Q.response)==null?void 0:he.status)===400||((je=Q==null?void 0:Q.response)==null?void 0:je.status)===404){let te=(nt=(st=Q==null?void 0:Q.response)==null?void 0:st._data)==null?void 0:nt.detail;te.err&&(te=S(`error.${te.err}`)),u(te)}((F=Q==null?void 0:Q.response)==null?void 0:F.status)===422&&Object.keys(Q.response._data.detail).forEach(te=>{let de=Gt(Q.response._data.detail[te]),ze=de;de.err&&(ze=`error.${de.err}`,de=S(ze)),u(de),p.setError(te,{type:"custom",message:ze})})}).finally(()=>{R(!1)})},A=()=>{p.reset(pr()),l(!1),o(null),i(null),u(null),R(!1),w(null),G()},ne=()=>{w({title:S("clash.proxyGroup.delete"),content:S("clash.proxyGroup.deletePrompt",{name:t==null?void 0:t.name}),type:"error",yes:S("delete"),onConfirm:()=>{a(t).then(()=>{k({title:S("clash.proxyGroup.deleteSuccess",{name:t==null?void 0:t.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),A()}).catch(M=>{k({title:S("clash.proxyGroup.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{w(null)})}})},V=M=>M&&S(M),ce=y;return r(be,{isOpen:_,onClose:A,size:"md",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(zt,{...p,children:e(ye,{mx:"3",children:r("form",{onSubmit:p.handleSubmit(re),children:[e(Se,{pt:6,children:r(g,{gap:2,children:[e(ke,{color:"primary",children:h?e(rn,{color:"white"}):e(Jt,{color:"white"})}),e(b,{fontWeight:"semibold",fontSize:"lg",children:S(h?"clash.proxyGroup.edit":"clash.proxyGroup.add")})]})}),e(Ce,{mt:3,disabled:ce}),e(we,{children:r(O,{justifyContent:"space-between",children:[e(g,{w:"full",children:r(E,{isInvalid:!!p.formState.errors.name,children:[r(g,{mb:"1",children:[e(L,{mr:"0",mb:"0",children:S("clash.name")}),r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(Kt,{})}),r(Ue,{children:[e(Fe,{}),e(b,{fontSize:"xs",p:"2",children:S("clash.proxyGroup.uniqueInfo")})]})]})]}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:ce,...p.register("name")}),e(Te,{children:V((ve=p.formState.errors.name)==null?void 0:ve.message)})]})}),r(g,{w:"full",alignItems:"baseline",children:[r(E,{w:"60%",children:[e(L,{children:S("clash.type")}),e(pe,{disabled:ce||(t==null?void 0:t.builtin),size:"sm",...p.register("type",{onChange:M=>P(M.target.value)}),children:es.map(M=>e("option",{value:M,children:M},M))}),e(Te,{children:V((K=p.formState.errors.type)==null?void 0:K.message)})]}),r(E,{isInvalid:!!p.formState.errors.tag,children:[e(L,{children:S("tag")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:ce||(t==null?void 0:t.builtin),...p.register("tag")}),e(Te,{children:V((Pe=p.formState.errors.tag)==null?void 0:Pe.message)})]})]}),r(E,{pt:"2",children:[r(g,{mb:"1",children:[e(L,{mr:"0",mb:"0",children:S("clash.proxies")}),r(Ae,{isLazy:!0,placement:"right",children:[e(Le,{children:e(Kt,{})}),r(Ue,{children:[e(Fe,{}),e(b,{fontSize:"xs",p:"2",children:S("clash.proxyGroup.proxiesInfo")})]})]})]}),r(O,{w:"full",children:[e(Ps,{onDragEnd:M=>{if(!M.destination)return;const D=Array.from(p.getValues().selected_proxies),[ee]=D.splice(M.source.index,1);D.splice(M.destination.index,0,ee),p.setValue("selected_proxies",D,{shouldDirty:!0})},children:e(Qi,{droppableId:"droppable",children:M=>r(pt,{w:"full",...M.droppableProps,ref:M.innerRef,children:[p.getValues().selected_proxies.map((D,ee)=>{const $=C[D]||{id:D,name:`(${D})`,server:"Not Found",tag:"<Not Found>",builtin:!1};let fe="primary";return C[D]?$.id.startsWith("#")?fe="green":$.builtin&&$.id!=="..."&&(fe="purple"):fe="red",e(Ts,{index:ee,draggableId:$.id,isDragDisabled:t==null?void 0:t.builtin,children:Q=>r(As,{ref:Q.innerRef,...Q.draggableProps,...Q.dragHandleProps,pl:"3",pr:"3",mb:"1",w:"fit-content",size:"md",borderRadius:"full",variant:"solid",cursor:"default",colorScheme:fe,children:[!(t!=null&&t.builtin)&&e(Ls,{boxSize:"18px",as:$i}),r(Ae,{isLazy:!0,trigger:"hover",placement:"top",children:[e(Le,{children:e(Us,{height:"full",cursor:"default",children:r(Fs,{children:[$.name," -> ",$.tag]})})}),!!$.server&&r(Ue,{w:"full",children:[e(Fe,{}),e(b,{p:"2",pl:"3",pr:"3",color:"gray.800",_dark:{color:"whiteAlpha.900"},children:$.server})]})]}),!(t!=null&&t.builtin)&&e(Ms,{onClick:()=>{const he=p.getValues().selected_proxies.filter(je=>je!==D);p.setValue("selected_proxies",he,{shouldDirty:!0,shouldValidate:!0})}})]})},$.id)}),M.placeholder]})})}),r(O,{w:"full",children:[r(g,{w:"full",children:[r(He,{children:[e(vt,{height:"8",pointerEvents:"none",children:e(q,{"aria-label":"clear",size:"xs",bgColor:"unset",isDisabled:ce||(t==null?void 0:t.builtin),children:e(or,{})})}),e(Z,{disabled:ce||(t==null?void 0:t.builtin),size:"sm",borderRadius:"md",placeholder:S("search"),value:U,borderColor:"light-border",onChange:H}),r(Ve,{height:"8",children:[y&&e(Re,{size:"xs"}),U.length>0&&e(q,{onClick:G,"aria-label":"clear",size:"xs",variant:"ghost",children:e(lr,{})})]})]}),e(j,{w:"36px"})]}),r(g,{w:"full",children:[e(pe,{ref:N,disabled:ce||(t==null?void 0:t.builtin),size:"sm",children:d.map(M=>{const ee=p.getValues().selected_proxies.some(se=>M.id===se),$=`#${t==null?void 0:t.id}`,fe=`${M.name} -> ${M.tag}`,Q=U&&fe.toLowerCase().indexOf(U.toLowerCase())<0;return ee||M.builtin||M.id==$||Q?null:e("option",{value:M.id,children:fe},M.id)})}),e(q,{size:"sm","aria-label":"Add Proxy",isDisabled:ce||(t==null?void 0:t.builtin),icon:e(Jt,{}),onClick:()=>{const M=p.getValues().selected_proxies,D=N.current.value,ee=C[D];M.some(fe=>{var Q;return ee.name===((Q=C[fe])==null?void 0:Q.name)})?k({title:S("clash.proxy.exists",{name:C[D].name}),status:"error",isClosable:!0,position:"top",duration:3e3}):(p.clearErrors("proxies"),p.setValue("selected_proxies",[...M,D],{shouldDirty:!0}))}})]})]})]})]}),e(at,{w:"full",allowToggle:!0,children:r(Je,{border:"0",children:[e(Ke,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:r(g,{pt:"4",pb:"2",w:"full",children:[e(wt,{}),r(b,{whiteSpace:"nowrap",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[S("clash.advanceOption"),e(Ct,{fontSize:"sm",ml:1})]}),e(wt,{})]})}),e(et,{w:"full",p:1,children:r(O,{w:"full",children:[r(E,{children:[e(L,{children:S("clash.icon")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:ce,...p.register("settings.icon")})]}),z=="load-balance"&&r(O,{w:"full",children:[r(E,{children:[e(L,{children:S("clash.strategy")}),e(pe,{size:"sm",...p.register("settings.load_balance.strategy"),children:Di.map(M=>e("option",{value:M,children:M},M))})]}),r(E,{children:[e(L,{children:S("clash.url")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...p.register("settings.load_balance.url")})]}),r(E,{children:[e(L,{children:S("clash.interval")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...p.register("settings.load_balance.interval")})]})]}),z=="url-test"&&r(O,{w:"full",children:[r(E,{children:[e(L,{children:S("clash.url")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...p.register("settings.url_test.url")})]}),r(E,{children:[e(L,{children:S("clash.interval")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...p.register("settings.url_test.interval")})]}),r(E,{children:[e(L,{children:S("clash.tolerance")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...p.register("settings.url_test.tolerance")})]}),r(E,{pt:"1",display:"flex",alignItems:"center",children:[e(L,{mb:"0",children:"lazy"}),e(Qe,{colorScheme:"primary",...p.register("settings.url_test.lazy")})]})]}),z=="fallback"&&r(O,{w:"full",children:[r(E,{children:[e(L,{children:S("clash.url")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...p.register("settings.fallback.url")})]}),r(E,{children:[e(L,{children:S("clash.interval")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...p.register("settings.fallback.interval")})]})]}),z=="select"&&r(O,{w:"full",children:[r(E,{children:[e(L,{children:S("clash.filter")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:t==null?void 0:t.builtin,...p.register("settings.select.filter")})]}),r(E,{pt:2,display:"flex",alignItems:"center",children:[e(L,{mb:"0",children:"disable-udp"}),e(Qe,{colorScheme:"primary",disabled:t==null?void 0:t.builtin,...p.register("settings.select.disable_udp")})]})]})]})})]})}),c&&r(ot,{status:"error",children:[e(lt,{}),c]})]})}),e(Ee,{children:r(g,{justifyContent:"space-between",w:"full",gap:3,children:[h&&r(g,{spacing:2,pr:5,children:[e(me,{isDisabled:t.builtin,label:S("delete"),placement:"top",children:e(q,{isDisabled:t.builtin,"aria-label":"Delete",size:"sm",onClick:ne,children:e(tt,{})})}),e(me,{isDisabled:t.builtin,label:S("duplicate"),placement:"top",children:e(q,{isDisabled:t.builtin,"aria-label":"Duplicate proxy group",size:"sm",onClick:()=>i(t),children:e(nn,{})})})]}),r(g,{w:"full",justifyItems:"flex-end",children:[e(Y,{onClick:A,size:"sm",variant:"outline",w:"full",disabled:ce,children:S("cancel")}),e(Y,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:y?e(Re,{size:"xs"}):void 0,w:"full",isDisabled:ce||!p.formState.isDirty,children:S(h?"update":"create")})]})]})})]})})})]})},xr=[{name:"DOMAIN",example:"www.google.com"},{name:"DOMAIN-SUFFIX",example:"google.com"},{name:"DOMAIN-KEYWORD",example:"google"},{name:"GEOIP",noResolve:!0,example:"cn"},{name:"GEOSITE",message:"clash.rule.supportGEOSITE",example:"google"},{name:"IP-CIDR",noResolve:!0,example:"127.0.0.0/8"},{name:"IP-CIDR6",noResolve:!0,example:"2620:0:2d0:200::7/32"},{name:"RULE-SET",example:"providername"},{name:"SRC-IP-CIDR",example:"192.168.1.201/32"},{name:"SRC-PORT",example:"80"},{name:"DST-PORT",example:"8080"},{name:"PROCESS-NAME",example:"onedrive"},{name:"PROCESS-PATH",example:"/usr/bin/curl"},{name:"NETWORK",message:"clash.rule.supportNETWORK",example:"tcp udp"},{name:"SCRIPT",message:"clash.rule.supportSCRIPT",example:"script shortcut"},{name:"AND",message:"clash.rule.supportLOGIC",example:"((DOMAIN,google.com),(NETWORK,UDP))"},{name:"OR",message:"clash.rule.supportLOGIC",example:"((NETWORK,UDP),(DOMAIN,google.com))"},{name:"NOT",message:"clash.rule.supportLOGIC",example:"((DOMAIN,google.com))"}],Ti=T.object({content:T.string().min(1,{message:"fieldRequired"}),type:T.string().min(1,{message:"fieldRequired"}),ruleset:T.string().min(1,{message:"fieldRequired"}),policy:T.string(),priority:T.boolean(),no_resolve:T.boolean()}),mr=t=>({id:0,type:"DOMAIN-SUFFIX",content:"",option:"",policy:"",priority:!1,no_resolve:!1,ruleset:t||"DIRECT"}),Ai=t=>{var n;return{...t,no_resolve:((n=t.option)==null?void 0:n.includes("no-resolve"))||!1,priority:t.priority==1}},bt=t=>xr.filter(n=>n.name===t)[0]||xr[0],Li=()=>{var re;const{ruleFilter:t,editingRule:n,isCreatingRule:s,onEditingRule:o,onCreateRule:l,onEditingRuleset:i,deleteRule:a,editRule:f,createRule:x,rulesets:w,onAlert:d}=ge(),h=!!n,_=s||h,I=h?"clash.rule.edited":"clash.rule.created",[y,R]=m.exports.useState(!1),[c,u]=m.exports.useState(""),[z,P]=m.exports.useState(bt("DOMAIN-SUFFIX")),N=De(),{t:k}=X(),S=qe({defaultValues:mr(null),resolver:it(Ti)});m.exports.useEffect(()=>{n&&(S.reset(Ai(n)),P(bt(n.type)))},[n]),m.exports.useEffect(()=>{s&&(P(bt("DOMAIN-SUFFIX")),S.reset(mr(t.ruleset)))},[s,t]);const p=A=>{R(!0),u(null);const{no_resolve:ne,priority:V,...ce}=A;let ve={...ce,id:n==null?void 0:n.id,priority:V?1:0,option:ne&&bt(A.type).noResolve?"no-resolve":""};(h?f:x)(ve).then(()=>{N({title:k(I,{name:A.content}),status:"success",isClosable:!0,position:"top",duration:3e3}),C()}).catch(K=>{var Pe,M,D,ee,$,fe;if(((Pe=K==null?void 0:K.response)==null?void 0:Pe.status)===409||((M=K==null?void 0:K.response)==null?void 0:M.status)===400||((D=K==null?void 0:K.response)==null?void 0:D.status)===404){let Q=($=(ee=K==null?void 0:K.response)==null?void 0:ee._data)==null?void 0:$.detail;Q.err&&(Q=k(`error.${Q.err}`)),u(Q)}((fe=K==null?void 0:K.response)==null?void 0:fe.status)===422&&Object.keys(K.response._data.detail).forEach(Q=>{let se=Gt(K.response._data.detail[Q]),he=se;se.err&&(he=`error.${se.err}`,se=k(he)),u(se),S.setError(Q,{type:"custom",message:he})})}).finally(()=>{R(!1)})},C=()=>{S.reset(mr(t.ruleset)),l(!1),o(null),u(null),P(bt("DOMAIN-SUFFIX"))},U=()=>{d({title:k("clash.rule.delete"),content:k("clash.rule.deletePrompt",{name:n==null?void 0:n.content}),type:"error",yes:k("delete"),onConfirm:()=>{a(n).then(()=>{N({title:k("clash.rule.deleteSuccess",{name:n==null?void 0:n.content}),status:"success",isClosable:!0,position:"top",duration:3e3}),C()}).catch(A=>{N({title:k("clash.rule.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{d(null)})}})},J=()=>{const A=S.getValues().ruleset,ne=w.filter(V=>V.name==A)[0];ne&&(C(),i(ne))},H=A=>A&&k(A),G=y;return r(be,{isOpen:_,onClose:C,size:"md",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(zt,{...S,children:e(ye,{mx:"3",children:r("form",{onSubmit:S.handleSubmit(p),children:[e(Se,{pt:6,children:r(g,{gap:2,children:[e(ke,{color:"primary",children:h?e(rn,{color:"white"}):e(Jt,{color:"white"})}),e(b,{fontWeight:"semibold",fontSize:"lg",children:k(h?"clash.rule.edit":"clash.rule.add")})]})}),e(Ce,{mt:3,disabled:G}),e(we,{children:r(O,{justifyContent:"space-between",children:[r(E,{height:"66px",children:[e(L,{children:k("clash.ruleset")}),r(g,{children:[e(pe,{disabled:G,size:"sm",...S.register("ruleset"),children:w.map(A=>r("option",{value:A.name,children:[A.name," (",A.policy,")"]},A.id))}),e(q,{"aria-label":"Edit",size:"sm",onClick:J,children:e(sn,{})})]})]}),r(E,{height:"66px",mb:z.message?4:0,children:[e(L,{children:k("clash.type")}),e(pe,{disabled:G,size:"sm",...S.register("type",{onChange:A=>P(bt(A.target.value))}),children:xr.map(A=>e("option",{value:A.name,children:A.name},A.name))}),z.message&&e(Es,{fontSize:"xs",mt:1,children:k(z.message)})]}),r(E,{isInvalid:!!S.formState.errors.content,children:[e(L,{children:k("clash.content")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",placeholder:z.example,disabled:G,...S.register("content")}),e(Te,{children:H((re=S.formState.errors.content)==null?void 0:re.message)})]}),r(E,{mb:"0px",pt:"10px",children:[e(L,{children:k("clash.policy")}),e(Be,{control:S.control,name:"policy",render:({field:A})=>e($s,{isDisabled:G,...A,children:e(js,{direction:"row",spacing:"6",children:["","DIRECT","PROXY","REJECT"].map(ne=>e(Bs,{value:ne,size:"md",colorScheme:"primary",children:e(b,{fontSize:"sm",children:ne||"RULESET"})},ne||"RULESET"))})})})]}),r(g,{w:"full",pt:"2",children:[z.noResolve&&r(E,{display:"flex",alignItems:"center",children:[e(L,{mb:"0",children:k("clash.rule.noResolve")}),e(Qe,{colorScheme:"primary",...S.register("no_resolve")})]}),r(E,{display:"flex",alignItems:"center",children:[e(L,{mb:"0",children:k("clash.rule.priority")}),e(Qe,{disabled:G,colorScheme:"primary",...S.register("priority")})]})]}),c&&r(ot,{status:"error",children:[e(lt,{}),c]})]})}),e(Ee,{mt:"3",children:r(g,{justifyContent:"space-between",w:"full",gap:3,children:[h&&e(me,{label:k("delete"),placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",onClick:U,children:e(tt,{})})}),r(g,{w:"full",justifyItems:"flex-end",children:[e(Y,{onClick:C,size:"sm",variant:"outline",w:"full",disabled:G,children:k("cancel")}),e(Y,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:y?e(Re,{size:"xs"}):void 0,w:"full",isDisabled:G||!S.formState.isDirty,children:k(h?"update":"create")})]})]})})]})})})]})},Ui=v(jt,{baseStyle:{w:5,h:5}}),Fi=v(It,{baseStyle:{w:5,h:5}}),rs=()=>({id:0,name:"",builtin:!1,policy:"PROXY",settings:{as_provider:!1,type:"http",behavior:"classical",format:"yaml",interval:3600}}),Mi=()=>{const{editingRuleset:t,isCreatingRuleset:n,onEditingRuleset:s,onCreateRuleset:o,deleteRuleset:l,editRuleset:i,createRuleset:a,onRuleFilterChange:f,onAlert:x}=ge(),w=!!t,d=n||w,h=w?"clash.ruleset.edited":"clash.ruleset.created",[_,I]=m.exports.useState(!1),[y,R]=m.exports.useState(""),[c,u]=m.exports.useState(!1),z=De(),{t:P}=X(),N=qe({defaultValues:rs()});m.exports.useEffect(()=>{var U;t&&(N.reset(t),u((U=t.settings.as_provider)!=null?U:!1))},[t]);const k=U=>{I(!0),R(null);let J=U;(w?i:a)(J).then(()=>{z({title:P(h,{name:U.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),f({ruleset:J.name,offset:0}),S()}).catch(H=>{var G,re,A,ne,V,ce;if(((G=H==null?void 0:H.response)==null?void 0:G.status)===409||((re=H==null?void 0:H.response)==null?void 0:re.status)===400||((A=H==null?void 0:H.response)==null?void 0:A.status)===404){let ve=(V=(ne=H==null?void 0:H.response)==null?void 0:ne._data)==null?void 0:V.detail;ve.err&&(ve=P(`error.${ve.err}`)),R(ve)}((ce=H==null?void 0:H.response)==null?void 0:ce.status)===422&&Object.keys(H.response._data.detail).forEach(ve=>{let K=Gt(H.response._data.detail[ve]),Pe=K;K.err&&(Pe=`error.${K.err}`,K=P(Pe)),R(K),N.setError(ve,{type:"custom",message:K})})}).finally(()=>{I(!1)})},S=()=>{N.reset(rs()),o(!1),u(!1),s(null),R(null),x(null)},p=()=>{x({title:P("clash.ruleset.delete"),content:P("clash.ruleset.deletePrompt",{name:t==null?void 0:t.name}),type:"error",yes:P("delete"),onConfirm:()=>{l(t).then(()=>{z({title:P("clash.ruleset.deleteSuccess",{name:t==null?void 0:t.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),S()}).catch(U=>{z({title:P("clash.ruleset.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{x(null)})}})},C=_;return r(be,{isOpen:d,onClose:S,size:"md",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(zt,{...N,children:e(ye,{mx:"3",children:r("form",{onSubmit:N.handleSubmit(k),children:[e(Se,{pt:6,children:r(g,{gap:2,children:[e(ke,{color:"primary",children:w?e(Fi,{color:"white"}):e(Ui,{color:"white"})}),e(b,{fontWeight:"semibold",fontSize:"lg",children:P(w?"clash.ruleset.edit":"clash.ruleset.add")})]})}),e(Ce,{mt:3,disabled:C}),e(we,{children:r(O,{justifyContent:"space-between",children:[r(E,{mb:"0",isInvalid:!!N.formState.errors.name,children:[e(L,{children:P("clash.name")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:C||(t==null?void 0:t.builtin),...N.register("name")})]}),r(E,{mb:"0px",pt:"10px",children:[e(L,{children:P("clash.policy")}),e(Be,{control:N.control,name:"policy",render:({field:U})=>e($s,{isDisabled:C||(t==null?void 0:t.builtin),...U,children:e(js,{direction:"row",spacing:"6",children:["DIRECT","PROXY","REJECT"].map(J=>e(Bs,{value:J,size:"md",colorScheme:"primary",children:e(b,{fontSize:"sm",children:J})},J))})})})]}),e(at,{w:"full",allowToggle:!0,children:r(Je,{border:"0",children:[e(Ke,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:r(g,{pt:"4",pb:"2",w:"full",children:[e(wt,{}),r(b,{whiteSpace:"nowrap",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[P("clash.advanceOption"),e(Ct,{fontSize:"sm",ml:1})]}),e(wt,{})]})}),e(et,{w:"full",p:1,children:r(O,{w:"full",children:[r(E,{mb:"10px",children:[e(L,{children:P("clash.icon")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",disabled:C,...N.register("settings.icon")})]}),r(E,{display:"flex",alignItems:"center",children:[e(L,{mb:"0",children:P("clash.ruleset.asRuleProvider")}),e(Qe,{disabled:C||(t==null?void 0:t.builtin),colorScheme:"primary",...N.register("settings.as_provider",{onChange:U=>u(U.target.checked)})})]}),c&&r(O,{w:"full",children:[r(g,{w:"full",children:[r(E,{children:[e(L,{children:P("clash.behavior")}),e(pe,{size:"sm",...N.register("settings.behavior"),children:["classical","domain","ipcidr"].map(U=>e("option",{value:U,children:U},U))})]}),r(E,{children:[e(L,{children:P("clash.type")}),e(pe,{size:"sm",...N.register("settings.type"),children:["http","file"].map(U=>e("option",{value:U,children:U},U))})]})]}),r(g,{w:"full",children:[r(E,{children:[e(L,{children:P("clash.format")}),e(pe,{size:"sm",...N.register("settings.format"),children:["yaml","text"].map(U=>e("option",{value:U,children:U},U))})]}),r(E,{children:[e(L,{children:P("clash.interval")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...N.register("settings.interval")})]})]}),r(E,{children:[e(L,{children:P("clash.url")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...N.register("settings.url")})]}),r(E,{children:[e(L,{children:P("clash.path")}),e(Z,{size:"sm",type:"text",borderRadius:"6px",...N.register("settings.path")})]})]})]})})]})}),y&&r(ot,{status:"error",children:[e(lt,{}),y]})]})}),e(Ee,{mt:"3",children:r(g,{justifyContent:"space-between",w:"full",gap:3,children:[w&&e(me,{label:P("delete"),placement:"top",children:e(q,{"aria-label":"Delete",size:"sm",onClick:p,children:e(tt,{})})}),r(g,{w:"full",justifyItems:"flex-end",children:[e(Y,{onClick:S,size:"sm",variant:"outline",w:"full",disabled:C,children:P("cancel")}),e(Y,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:_?e(Re,{size:"xs"}):void 0,w:"full",isDisabled:C||!N.formState.isDirty,children:P(w?"update":"create")})]})]})})]})})})]})},Ni=v(It,{baseStyle:{w:5,h:5}}),Wi=()=>{const{loading:t,editingSetting:n,onEditingSetting:s,editSetting:o}=ge(),l=n!==null,{colorMode:i}=kt(),{t:a}=X(),f=De(),[x,w]=m.exports.useState((n==null?void 0:n.content)||""),d=()=>{s(null)},h=()=>{o({name:n.name,content:x}).then(()=>{f({title:a("clash.setting.savedSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})})};return m.exports.useEffect(()=>{n&&w(n.content)},[n]),r(be,{isOpen:l,onClose:d,size:"4xl",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",children:[e(Se,{pt:6,children:r(g,{gap:2,children:[e(ke,{color:"primary",children:e(Ni,{color:"white"})}),e(b,{fontWeight:"semibold",fontSize:"lg",children:a("clash.setting.edit")})]})}),e(Ce,{mt:3}),e(we,{children:e(O,{w:"full",children:e(Kn,{value:x,height:"500px",theme:i,extensions:[eo.define(to)],onChange:_=>w(_)})})}),e(Ee,{children:e(g,{w:"full",justifyContent:"flex-end",children:e(Y,{colorScheme:"primary",size:"sm",minW:40,isDisabled:t||x==(n==null?void 0:n.content),onClick:h,px:5,children:a("clash.save")})})})]})]})},Me={baseStyle:{w:5,h:5}},rn=v(It,Me),Jt=v(jt,Me),or=v(Cr,Me),lr=v($t,Me);v(Os,Me);v(tr,Me);const Oi=v(kr,Me),sn=v(Sr,Me);v(Ir,Me);const Er=v(Wt,Me);v(Ds,Me);const nn=v(ro,Me),$i=v(wr,Me),Kt=v(rr,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),ji=()=>{const{isEditingSubscription:t,onEditingSubscription:n}=W(),{t:s}=X();return e(Cs,{isLazy:!0,colorScheme:"primary",lazyBehavior:"keepMounted",children:r(be,{isOpen:t,onClose:()=>{n(!1)},size:"5xl",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",w:"full",children:[e(Se,{pt:6,children:r(g,{gap:2,children:[e(ke,{color:"primary",children:e(Oi,{color:"white"})}),r(ws,{children:[e(yt,{fontSize:"lg",children:s("clash.proxies")}),e(yt,{fontSize:"lg",children:s("clash.proxyGroups")}),e(yt,{fontSize:"lg",children:s("clash.rules")}),e(yt,{fontSize:"lg",children:s("clash.setting")})]})]})}),e(Ce,{mt:3}),r(we,{children:[r(ks,{children:[e(St,{children:e(Hi,{})}),e(St,{children:e(qi,{})}),e(St,{children:e(Zi,{})}),e(St,{children:e(Bi,{})})]}),e(Li,{}),e(Mi,{}),e(Pi,{}),e(Ri,{}),e(Wi,{})]}),e(Ee,{mt:"3"})]})]})})},Bi=()=>{const{fetchSettings:t,settings:n,onEditingSetting:s}=ge(),{isEditingSubscription:o}=W();m.exports.useEffect(()=>{o&&t()},[o]);const l=i=>yr(["/dashboard/",`images/${i}.png`]);return e(g,{spacing:6,minH:"sm",alignItems:"baseline",children:n.map(i=>r(is,{p:6,pl:10,pr:10,borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{borderColor:"gray.600",bg:"gray.750"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",onClick:()=>s(i),children:[e(j,{w:"48px",children:e(so,{src:l(i.name),alt:i.name})}),e(j,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:i.name})]},i.name))})},Gi=Ot(t=>{ge.getState().onProxyFilterChange({...ge.getState().proxyFilter,offset:0,search:t})},300),Hi=()=>{const{isEditingSubscription:t}=W(),{t:n}=X(),{proxyFilter:s,onProxyFilterChange:o,onCreateProxy:l,onEditingProxy:i,fetchProxies:a,fetchProxyInbounds:f,proxies:x,totalProxies:w,loading:d}=ge(),[h,_]=m.exports.useState(""),I=c=>{_(c.target.value),Gi(c.target.value)},y=()=>{_(""),o({...s,offset:0,search:""})},R=c=>{let u=s.sort;u.includes(c)?u.startsWith("-")?u="-modified_at":u="-"+c:u=c,o({sort:u,offset:0})};return m.exports.useEffect(()=>{t&&(s.search="",a(),f())},[t]),r(O,{w:"full",children:[r(g,{w:"full",justifyContent:"space-between",children:[e(g,{children:r(He,{children:[e(vt,{height:"8",pointerEvents:"none",children:e(or,{})}),e(Z,{size:"sm",borderRadius:"md",placeholder:n("search"),value:h,borderColor:"light-border",onChange:I}),r(Ve,{height:"8",children:[d&&e(Re,{size:"xs"}),h.length>0&&e(q,{onClick:y,"aria-label":"clear",size:"xs",variant:"ghost",children:e(lr,{})})]})]})}),r(g,{children:[e(q,{"aria-label":"refresh proxies",disabled:d,onClick:a,size:"sm",variant:"outline",children:e(Er,{className:Oe({"animate-spin":d})})}),e(Y,{colorScheme:"primary",size:"sm",onClick:()=>l(!0),px:5,children:n("clash.proxy.add")})]})]}),r(j,{overflowX:"auto",w:"full",children:[r(Lt,{orientation:"vertical",children:[e(Ut,{zIndex:"docked",position:"relative",children:r(Ne,{children:[e(ue,{minW:"30px",pr:"0",cursor:"pointer",onClick:R.bind(null,"id"),children:r(g,{children:[e("span",{children:"id"}),e(_e,{sort:s.sort,column:"id"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:R.bind(null,"name"),children:r(g,{children:[e("span",{children:n("clash.name")}),e(_e,{sort:s.sort,column:"name"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:R.bind(null,"server"),children:r(g,{children:[e("span",{children:n("clash.server")}),e(_e,{sort:s.sort,column:"server"})]})}),e(ue,{minW:"100px",cursor:"pointer",onClick:R.bind(null,"inbound"),children:r(g,{children:[e("span",{children:n("clash.inbound")}),e(_e,{sort:s.sort,column:"inbound"})]})}),e(ue,{minW:"100px",cursor:"pointer",onClick:R.bind(null,"tag"),children:r(g,{children:[e("span",{children:n("tag")}),e(_e,{sort:s.sort,column:"tag"})]})})]})}),e(Ft,{children:x==null?void 0:x.map((c,u)=>r(Ne,{className:Oe("interactive",{"last-row":u===x.length-1}),onClick:()=>i(c),children:[e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.id}),e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.name}),r(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:[c.server,":",c.port]}),e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.inbound}),e(ie,{pt:"2.5",pb:"2.5",fontSize:"sm",children:c.tag})]},c.id))})]}),e(nr,{onChange:(c,u)=>{o({...s,limit:u,offset:c*u})},total:w,limit:s.limit,offset:s.offset})]})]})},Vi=Ot(t=>{ge.getState().onProxyGroupFilterChange({...ge.getState().proxyGroupFilter,offset:0,search:t})},300),qi=()=>{const{isEditingSubscription:t}=W(),{t:n}=X(),{proxyGroupFilter:s,onProxyGroupFilterChange:o,fetchProxyGroups:l,fetchProxyBriefs:i,proxyGroups:a,totalProxyGroups:f,loading:x,onEditingProxyGroup:w,onCreateProxyGroup:d}=ge(),[h,_]=m.exports.useState(""),I=c=>{_(c.target.value),Vi(c.target.value)},y=()=>{_(""),o({...s,offset:0,search:""})},R=c=>{let u=s.sort;u.includes(c)?u.startsWith("-")?u="-modified_at":u="-"+c:u=c,o({sort:u,offset:0})};return m.exports.useEffect(()=>{t&&(s.search="",l(),i())},[t]),r(O,{w:"full",children:[r(g,{w:"full",justifyContent:"space-between",children:[e(g,{children:r(He,{children:[e(vt,{height:"8",pointerEvents:"none",children:e(or,{})}),e(Z,{size:"sm",borderRadius:"md",placeholder:n("search"),value:h,borderColor:"light-border",onChange:I}),r(Ve,{height:"8",children:[x&&e(Re,{size:"xs"}),h.length>0&&e(q,{onClick:y,"aria-label":"clear",size:"xs",variant:"ghost",children:e(lr,{})})]})]})}),r(g,{children:[e(q,{"aria-label":"refresh proxy groups",disabled:x,onClick:l,size:"sm",variant:"outline",children:e(Er,{className:Oe({"animate-spin":x})})}),e(Y,{colorScheme:"primary",size:"sm",onClick:()=>d(!0),px:5,children:n("clash.proxyGroup.add")})]})]}),r(j,{overflowX:"auto",w:"full",children:[r(Lt,{orientation:"vertical",children:[e(Ut,{zIndex:"docked",position:"relative",children:r(Ne,{children:[e(ue,{minW:"30px",pr:"0",cursor:"pointer",onClick:R.bind(null,"id"),children:r(g,{children:[e("span",{children:"id"}),e(_e,{sort:s.sort,column:"id"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:R.bind(null,"name"),children:r(g,{children:[e("span",{children:n("clash.name")}),e(_e,{sort:s.sort,column:"name"})]})}),e(ue,{minW:"100px",cursor:"pointer",onClick:R.bind(null,"type"),children:r(g,{children:[e("span",{children:n("clash.type")}),e(_e,{sort:s.sort,column:"type"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:R.bind(null,"tag"),children:r(g,{children:[e("span",{children:n("tag")}),e(_e,{sort:s.sort,column:"tag"})]})}),e(ue,{minW:"140px",cursor:"pointer",children:e(g,{children:e("span",{children:n("clash.proxies")})})})]})}),e(Ft,{children:a==null?void 0:a.map((c,u)=>r(Ne,{className:Oe("interactive",{"last-row":u===a.length-1}),onClick:()=>w(c),children:[e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.id}),e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.name}),e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.type}),e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.tag}),e(ie,{pt:"2.5",pb:"2.5",fontSize:"sm",children:c.proxies})]},c.id))})]}),e(nr,{onChange:(c,u)=>{o({...s,limit:u,offset:c*u})},total:f,limit:s.limit,offset:s.offset})]})]})},Yi=Ot(t=>{ge.getState().onRuleFilterChange({...ge.getState().ruleFilter,offset:0,search:t})},300),Zi=()=>{const{isEditingSubscription:t}=W(),{t:n}=X(),{ruleFilter:s,onRuleFilterChange:o,fetchRules:l,fetchRulesets:i,onEditingRule:a,onCreateRule:f,onEditingRuleset:x,onCreateRuleset:w,rules:d,totalRules:h,rulesets:_,loading:I}=ge(),[y,R]=m.exports.useState(""),c=_.reduce((p,C)=>({...p,[C.name]:C}),{}),u=p=>{R(p.target.value),Yi(p.target.value)},z=()=>{R(""),o({...s,offset:0,search:""})},P=p=>{const C=_.filter(U=>U.name===p);return C.length?C[0]:null},N=p=>{o(p==="All"?{ruleset:"",offset:0}:{ruleset:p,offset:0})},k=()=>{x(P(s.ruleset))},S=p=>{let C=s.sort;C.includes(p)?C.startsWith("-")?C="-modified_at":C="-"+p:C=p,o({sort:C,offset:0})};return m.exports.useEffect(()=>{s.ruleset&&!P(s.ruleset)&&o({ruleset:"",offset:0})},[_]),m.exports.useEffect(()=>{t&&(s.search="",l(),i())},[t]),r(O,{w:"full",children:[r(g,{w:"full",justifyContent:"space-between",children:[r(g,{children:[e(me,{placement:"top",label:n("clash.ruleset.add"),children:e(q,{"aria-label":"Add ruleset",size:"sm",onClick:()=>w(!0),children:e(Jt,{})})}),e(me,{isDisabled:!s.ruleset,label:n("clash.ruleset.edit"),placement:"top",children:e(q,{"aria-label":"Ruleset setting",size:"sm",isDisabled:!s.ruleset,onClick:k,children:e(sn,{})})}),r(pe,{size:"sm",value:s.ruleset||"All",onChange:p=>N(p.target.value),children:[e("option",{value:"All",children:"All"},"All"),_.map(p=>r("option",{value:p.name,children:[p.name," (",p.policy,")"]},p.name))]}),r(He,{children:[e(vt,{height:"8",pointerEvents:"none",children:e(or,{})}),e(Z,{size:"sm",borderRadius:"md",placeholder:n("search"),value:y,borderColor:"light-border",onChange:u}),r(Ve,{height:"8",children:[I&&e(Re,{size:"xs"}),y.length>0&&e(q,{onClick:z,"aria-label":"clear",size:"xs",variant:"ghost",children:e(lr,{})})]})]})]}),r(g,{children:[e(q,{"aria-label":"refresh rules",disabled:I,onClick:l,size:"sm",variant:"outline",children:e(Er,{className:Oe({"animate-spin":I})})}),e(Y,{colorScheme:"primary",size:"sm",onClick:()=>f(!0),px:5,children:n("clash.rule.add")})]})]}),r(j,{overflowX:"auto",w:"full",children:[r(Lt,{orientation:"vertical",children:[e(Ut,{zIndex:"docked",position:"relative",children:r(Ne,{children:[e(ue,{minW:"170px",cursor:"pointer",onClick:S.bind(null,"type"),children:r(g,{children:[e("span",{children:n("clash.type")}),e(_e,{sort:s.sort,column:"type"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:S.bind(null,"content"),children:r(g,{children:[e("span",{children:n("clash.content")}),e(_e,{sort:s.sort,column:"content"})]})}),e(ue,{minW:"140px",cursor:"pointer",onClick:S.bind(null,"option"),children:r(g,{children:[e("span",{children:n("clash.option")}),e(_e,{sort:s.sort,column:"option"})]})}),e(ue,{minW:"140px",children:e(g,{children:e("span",{children:n("clash.ruleset")})})})]})}),e(Ft,{children:d==null?void 0:d.map((p,C)=>{var U;return r(Ne,{className:Oe("interactive",{"last-row":C===d.length-1}),onClick:()=>a(p),children:[e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:p.type}),e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:e(b,{noOfLines:1,children:p.content})}),e(ie,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:p.option}),e(ie,{pt:"2.5",pb:"2.5",fontSize:"sm",children:r(b,{whiteSpace:"nowrap",children:[p.ruleset," (",p.policy||((U=c[p.ruleset])==null?void 0:U.policy),")"]})})]},p.content)})})]}),e(nr,{onChange:(p,C)=>{o({...s,limit:C,offset:p*C})},total:h,limit:s.limit,offset:s.offset})]})]})},Qi=({children:t,...n})=>{const[s,o]=m.exports.useState(!1);return m.exports.useEffect(()=>{const l=requestAnimationFrame(()=>o(!0));return()=>{cancelAnimationFrame(l),o(!1)}},[]),s?e(Ns,{...n,children:t}):null},Xi={baseStyle:{w:5,h:5}},ss={error:"red",success:"green",warning:"yellow",info:"blue"},Ji=v(bs,Xi),Ki=()=>{const[t,n]=m.exports.useState(!1),{alert:s,onAlert:o}=ge(),{t:l}=X(),i=()=>{o(null)},a=()=>{n(!0),s==null||s.onConfirm()};return m.exports.useEffect(()=>{n(!1)},[s]),r(be,{isOpen:!!s,onClose:i,size:"sm",children:[e(xe,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(ye,{mx:"3",mt:150,children:[e(Se,{pt:6,children:r(g,{spacing:4,children:[e(ke,{color:ss[(s==null?void 0:s.type)||"error"],children:e(Ji,{w:10})}),e(b,{fontWeight:"semibold",fontSize:"lg",children:s==null?void 0:s.title})]})}),e(Ce,{mt:3}),e(we,{children:s&&e(b,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ye,{components:{b:e("b",{})},children:s.content})})}),r(Ee,{display:"flex",children:[e(Y,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:ss[(s==null?void 0:s.type)||"error"],onClick:a,leftIcon:t?e(Re,{size:"xs"}):void 0,children:s==null?void 0:s.yes})]})]})]})},ea=()=>(m.exports.useEffect(()=>{W.getState().refetchUsers(),ge.getState().fetchProxyTags(),Po()},[]),r(O,{justifyContent:"space-between",minH:"100vh",p:"6",rowGap:4,children:[r(j,{w:"full",children:[e(ll,{}),e(Do,{mt:"4"}),e(Ho,{}),e(wi,{}),e(li,{}),e($o,{}),e(Ll,{}),e(gl,{}),e(Nl,{}),e(Ol,{}),e(Il,{}),e(El,{}),e(Fl,{}),e(Oo,{}),e(Ki,{}),e(ji,{})]}),e(qs,{})]})),ta=t=>m.exports.createElement("svg",{viewBox:"0 0 747 747",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},m.exports.createElement("path",{d:"M746.671 209.652V77.6572C746.671 72.9384 743.827 68.6832 739.468 66.8811C735.108 65.0738 730.093 66.0739 726.754 69.4072L579.354 216.807C577.453 202.386 570.203 189.203 559.037 179.87C547.875 170.542 533.615 165.744 519.083 166.432C504.551 167.12 490.807 173.24 480.573 183.583L414.375 249.776C412.417 235.391 405.141 222.25 393.985 212.959C382.823 203.662 368.594 198.88 354.083 199.552C339.578 200.224 325.849 206.302 315.594 216.588L274.343 257.828L19.9167 3.41515C16.5781 0.0818157 11.5625 -0.918184 7.20306 0.889149C2.84373 2.69648 0 6.94648 0 11.6651V143.649C0 146.743 1.22917 149.712 3.41667 151.899L191.843 340.339L3.41667 528.753C1.2292 530.94 0 533.909 0 537.003V668.997C0 673.716 2.84373 677.971 7.20306 679.773C11.5624 681.581 16.578 680.58 19.9167 677.247L167.317 529.847C169.285 544.233 176.561 557.358 187.718 566.65C198.869 575.947 213.098 580.728 227.603 580.066C242.103 579.404 255.838 573.342 266.098 563.071L332.295 496.874V496.879C334.259 511.264 341.535 524.395 352.691 533.686C363.853 542.977 378.082 547.759 392.587 547.092C407.093 546.421 420.822 540.348 431.077 530.066L472.327 488.826L726.754 743.239C728.941 745.427 731.91 746.656 735.004 746.656C736.535 746.661 738.056 746.359 739.473 745.77C743.832 743.963 746.671 739.708 746.671 734.989V602.994C746.671 599.901 745.442 596.932 743.254 594.744L554.827 406.318L743.254 217.904H743.259C745.447 215.717 746.676 212.748 746.676 209.654L746.671 209.652ZM23.3373 39.8118L257.844 274.318L208.328 323.818L23.3413 138.818L23.3373 39.8118ZM723.337 706.825L488.831 472.318L538.347 422.818L723.333 607.818L723.337 706.825ZM23.3373 541.825L332.097 233.078C338.764 226.719 347.624 223.172 356.843 223.172C366.056 223.172 374.916 226.719 381.588 233.078C388.151 239.641 391.838 248.548 391.838 257.828C391.838 267.114 388.151 276.016 381.588 282.577L23.3347 640.831L23.3373 541.825ZM249.604 546.575C240.755 555.419 227.864 558.872 215.781 555.638C203.703 552.398 194.265 542.961 191.027 530.883C187.792 518.8 191.245 505.91 200.089 497.06L497.076 200.074C505.92 191.23 518.811 187.772 530.893 191.011C542.971 194.246 552.409 203.678 555.648 215.76C558.888 227.839 555.434 240.73 546.591 249.572L249.604 546.575ZM723.337 204.815L414.577 513.562C407.911 519.926 399.051 523.473 389.832 523.473C380.618 523.473 371.753 519.926 365.087 513.562C358.529 506.999 354.842 498.098 354.842 488.816C354.842 479.535 358.529 470.634 365.087 464.071L723.34 105.818L723.337 204.815Z",fill:"currentColor"})),ra=T.object({username:T.string().min(1,"fieldRequired"),password:T.string().min(1,"fieldRequired")}),sa=v(ta,{baseStyle:{strokeWidth:"10px",w:12,h:12}}),na=v(no,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),ns=()=>{var h,_;const[t,n]=m.exports.useState(""),[s,o]=m.exports.useState(!1),l=oo(),{t:i}=X();let a=lo();const{register:f,formState:{errors:x},handleSubmit:w}=qe({resolver:it(ra)});m.exports.useEffect(()=>{wo(),a.pathname!=="/login"&&l("/login",{replace:!0})},[]);const d=I=>{n("");const y=new FormData;y.append("username",I.username),y.append("password",I.password),y.append("grant_type","password"),o(!0),B("/admin/token",{method:"post",body:y}).then(({access_token:R})=>{Co(R),l("/")}).catch(R=>{n(R.response._data.detail)}).finally(o.bind(null,!1))};return r(O,{justifyContent:"space-between",minH:"100vh",p:"6",w:"full",children:[r(j,{w:"full",children:[e(g,{justifyContent:"end",w:"full",children:e(Ys,{})}),e(g,{w:"full",justifyContent:"center",alignItems:"center",children:r(j,{w:"full",maxW:"340px",mt:"6",children:[r(O,{alignItems:"center",w:"full",children:[e(sa,{}),e(b,{fontSize:"2xl",fontWeight:"semibold",children:i("login.loginYourAccount")}),e(b,{color:"gray.600",_dark:{color:"gray.400"},children:i("login.welcomeBack")})]}),e(j,{w:"full",maxW:"300px",m:"auto",pt:"4",children:e("form",{onSubmit:w(d),children:r(O,{mt:4,rowGap:2,children:[e(E,{children:e(Ze,{w:"full",placeholder:i("username"),...f("username"),error:i((h=x==null?void 0:x.username)==null?void 0:h.message)})}),e(E,{children:e(Ze,{w:"full",type:"password",placeholder:i("password"),...f("password"),error:i((_=x==null?void 0:x.password)==null?void 0:_.message)})}),t&&r(ot,{status:"error",rounded:"md",children:[e(lt,{}),e(io,{children:t})]}),r(Y,{isLoading:s,type:"submit",w:"full",colorScheme:"primary",children:[e(na,{marginRight:1}),i("login")]})]})})})]})})]}),e(qs,{})]})},oa=()=>B("/admin",{headers:{Authorization:`Bearer ${Qt()}`}}),la=ao([{path:"/",element:e(ea,{}),errorElement:e(ns,{}),loader:oa},{path:"/login/",element:e(ns,{})}],{basename:"/dashboard/"});function ia(){return e("main",{className:"p-8",children:e(co,{router:la})})}ae.extend(uo);ae.extend(ho);ae.extend(po);ae.extend(mo);ae.extend(go);Gs(fo.get()||"light");bo.createRoot(document.getElementById("root")).render(e(Zt.StrictMode,{children:e(xo,{theme:So,children:e(yo,{client:gr,children:e(ia,{})})})}));
